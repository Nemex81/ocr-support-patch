######################################################
# WINDOW FAITH - DUAL MODE (OCR + Vanilla)
# Compatibilit√†: CK3 1.17.1 / OCR Support
# Patch: ocr_support_compatibility_patch
######################################################

### TYPES SECTION ###

## Vanilla Types ##
types FaithCreationWindow {
    type name_entry_big = editbox_standard_with_label {
        layoutpolicy_horizontal = expanding
        
        blockoverride "editbox_label" {
            block "label" {
                text = "DEFAULT_TEXT"
            }
        }
        
        size = { 380 30 }
    }
}

types FaithShared {
    type container_tenet_item = container {
        using = tooltip_se
        
        highlight_icon = {
            name = "doctrine_group_bg"
            texture = "[Faith.GetDoctrineBackgroundIcon]"
            size = { 130 200 }
        }
        
        highlight_icon = {
            name = "doctrine_group_icon"
            texture = "[FaithDoctrine.GetIcon]"
            size = { 130 200 }
            alpha = 0.85
            position = { 0 0 }
        }
        
        text_label_center = {
            name = "doctrine_name"
            parentanchor = bottom|hcenter
            widgetanchor = center
            position = { 0 -24 }
            maximumsize = { 130 44 }
            fontsize_min = 12
            multiline = yes
            align = center
            elide = right
            text = "[FaithDoctrine.GetNameNoTooltip(Faith.Self)]"
            default_format = "#high"
            using = Font_Size_Medium
        }
    }
    
    type fervor_container_vbox = vbox {
        name = "fervor_container"
        tooltip = "FERVOR_TT"
        spacing = -6
        
        hbox = {
            icon = {
                texture = "gfx/interface/icons/icon_fervor.dds"
                size = { 22 22 }
            }
            
            text_single = {
                text = "FAITH_WINDOW_FERVOR"
                default_format = "#high"
                align = nobaseline
            }
        }
        
        hbox = {
            layoutpolicy_horizontal = expanding
            margin_right = 1
            expand = {}
            
            text_single = {
                name = "fervor_trend"
                text = "[Faith.GetYearlyFervorChange|2]"
                max_width = 110
                default_format = "#low"
                fontsize = 13
                size = { 0 12 }
            }
        }
    }
}

types FaithWindow {
    type widget_doctrine_item = margin_widget {
        size = { 210 53 }
        margin = { 5 5 }
        
        block "wdi_context" {
            datacontext = "[GuiFaithDoctrineItem.GetDoctrine]"
            datacontext = "[GuiFaithDoctrineItem.GetFaith]"
        }
        
        block "background" {
            background = {
                using = Background_Area
                margin = { 5 5 }
            }
        }
        
        hbox = {
            parentanchor = center
            name = "faith_list_item"
            
            block "tooltip" {
                tooltip = "FAITH_WINDOW_DOCTRINE_TOOLTIP_WITH_FAITH"
            }
            
            spacing = 8
            using = tooltip_ne
            
            block "doctrine_icon" {
                icon_doctrine = {
                    name = "doctrine_group_icon"
                    size = { 50 50 }
                    texture = "[FaithDoctrine.GetGroup.GetIcon]"
                }
            }
            
            vbox = {
                layoutpolicy_horizontal = expanding
                
                text_single = {
                    name = "doctrine_group_name"
                    layoutpolicy_horizontal = expanding
                    align = left
                    autoresize = no
                    fontsize_min = 12
                    
                    block "text_title" {
                        text = "[FaithDoctrine.GetGroup.GetName(Faith.Self)]"
                    }
                }
                
                text_single = {
                    name = "faith_name"
                    layoutpolicy_horizontal = expanding
                    elide = right
                    autoresize = no
                    fontsize_min = 12
                    align = left
                    default_format = "#high"
                    
                    block "text_desc" {
                        text = "[FaithDoctrine.GetNameNoTooltip(Faith.Self)]"
                    }
                }
            }
        }
    }
}

## OCR Types ##
types OCR {
    type container_tenet_item_ocr = flowcontainer {
        layoutpolicy_horizontal = expanding
        direction = vertical
        ignoreinvisible = yes
        
        name = "doctrine_name"
        
        flowcontainer = {
            ignoreinvisible = yes
            spacing = 3
            
            text_single = {
                block "num" {
                    visible = no
                }
                raw_text = "[IndexNumber],"
            }
            
            text_single = {
                raw_text = "[FaithDoctrine.GetNameNoTooltip(Faith.Self)]."
                visible = "[Not(Has('doctrine', FaithDoctrine.GetNameNoTooltip(Faith.Self)))]"
            }
            
            text_multi = {
                max_width = 590
                visible = "[Has('doctrine', FaithDoctrine.GetNameNoTooltip(Faith.Self))]"
                autoresize = yes
                raw_text = "FAITH_WINDOW_DOCTRINE_TOOLTIP"
            }
        }
    }
    
    type widget_doctrine_item_ocr = vbox {
        block "wdi_context" {
            datacontext = "[GuiFaithDoctrineItem.GetDoctrine]"
            datacontext = "[GuiFaithDoctrineItem.GetFaith]"
        }
        
        block "tooltip" {
            tooltip = "FAITH_WINDOW_DOCTRINE_TOOLTIP_WITH_FAITH"
            tooltip_offset = { 0 25 }
        }
        
        layoutpolicy_horizontal = expanding
        spacing = 3
        visible = "[Or(IsNot('doctrine'), Has('doctrine', FaithDoctrine.GetGroup.GetName(Faith.Self)))]"
        
        button_text = {
            layoutpolicy_horizontal = expanding
            alwaystransparent = "[IsGameViewOpen('faith_creation')]"
            
            block "y" {
                visible = "[Is('doctrines')]"
            }
            
            block "sclick" {
                onclick = "[Set('doctrine', FaithDoctrine.GetGroup.GetName(Faith.Self))]"
                shortcuts_list = {}
                visible = "[Is('doctrines')]"
            }
            
            raw_text = "[FaithDoctrine.GetGroup.GetName(Faith.Self)]:"
            max_width = 300
        }
        
        expand = {}
    }
    
    type vbox_doctrine_group = vbox {
        layoutpolicy_horizontal = expanding
        
        button_text = {
            visible = "[IsNot('doctrine')]"
            block "set" { }
            layoutpolicy_horizontal = expanding
            
            blockoverride "text" {
                raw_text = "[PdxGuiWidget.AccessParent.AccessParent.AccessParent.FindChild('items').CountVisibleChildren]"
            }
            
            blockoverride "extra" {
                text_single = {
                    block "doctrine" {
                        raw_text = "FAITH_DOCTRINES_SPECIAL"
                    }
                }
                text_single = {
                    margin_left = -3
                    raw_text = ":"
                }
                text_single = {
                    visible = "[And(Is('doctrines'), HasNot('doctrines', 'special'))]"
                    raw_text = "select for details."
                }
            }
        }
        
        vbox = {
            name = "items"
            block "datamodel" {
                datamodel = "[FaithWindow.GetGroupingHelper('special').GetGrouping]"
            }
            layoutpolicy_horizontal = expanding
            
            item = {
                block "item" {
                    widget_doctrine_item_ocr = {}
                }
            }
        }
    }
    
    type vbox_holy_sites_ocr = vbox {
        layoutpolicy_horizontal = expanding
        datamodel = "[FaithWindow.GetHolySites]"
        
        item = {
            vbox = {
                datacontext = "[GuiHolySiteItem.GetHolySite]"
                datacontext = "[HolySite.GetBarony]"
                
                block "visible" {
                    visible = "[GuiHolySiteItem.IsHeldByFaith]"
                }
                
                layoutpolicy_horizontal = expanding
                
                vbox = {
                    layoutpolicy_horizontal = expanding
                    
                    hbox = {
                        layoutpolicy_horizontal = expanding
                        spacing = 3
                        
                        button_text = {
                            blockoverride "num" {}
                            blockoverride "sclick" {
                                using = prov_click
                            }
                            shortcuts_list = {}
                            blockoverride "text" {
                                raw_text = "[HolySite.GetName],"
                            }
                            datacontext = "[HolySite.GetBarony.GetProvince]"
                            blockoverride "extra" {
                                text_single = {
                                    raw_text = "[DistanceTo(MyCapital, Province)|0] [DaysTo(MyCapital, Province)] [Direction(MyCapital, Province)],"
                                }
                                text_single = {
                                    raw_text = "inside"
                                }
                                text_single = {
                                    raw_text = "[HolySite.GetBarony.GetHolder.GetTopLiege.GetPrimaryTitle.GetNameNoTierNoTooltip],"
                                }
                                text_single = {
                                    raw_text = "[HolySite.GetBarony.GetHolder.GetTopLiege.GetMilitaryStrengthText] strong."
                                }
                            }
                        }
                        
                        expand = {}
                    }
                }
            }
        }
    }
}

### END TYPES ###

### MAIN WINDOW ###

window = {
    name = "faith_window"
    widgetid = "faith_window"
    datacontext = "[FaithWindow.GetFaith]"
    datacontext = "[GetVariableSystem]"
    movable = no
    layer = windows_layer
    size = { 700 100% }
    
    ### STATES (SHARED) ###
    
    state = {
        name = "_show"
        position = { 0 0 }
        on_start = "[GetVariableSystem.Set('hide_bottom_left_HUD', 'true')]"
        using = Animation_FadeIn_Quick
        using = Sound_WindowShow_Standard
        on_finish = "[GetScriptedGui('faith_closest_county_ocr').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
    }
    
    state = {
        name = "closest"
        trigger_when = "[Not(Faith.MakeScope.Var('closest_county').IsSet)]"
        on_finish = "[GetScriptedGui('faith_closest_county_ocr').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
    }
    
    state = {
        name = "_hide"
        position = { -60 0 }
        on_start = "[GetVariableSystem.Clear('hide_bottom_left_HUD')]"
        using = Animation_FadeOut_Quick
        using = Sound_WindowHide_Standard
        on_finish = "[Click('clear_last_view')]"
        on_finish = "[Set('holy_site_tip', 'yes')]"
    }
    
    ### OCR MODE WIDGET ###
    
    window_ocr = {
        visible = "[Not(GetVariableSystem.Exists('ocr'))]"
        
        blockoverride "ocr_header" {
            button = {
                using = close_window_ocr
                onclick = "[FaithWindow.Close]"
            }
            
            button = {
                using = close_window_ocr
                onclick = "[Clear('faith_view_tabs')]"
                visible = "[Is('faith_view_tabs')]"
            }
            
            button_text = {
                layoutpolicy_horizontal = expanding
                onclick = "[FaithWindow.ToggleReligionWindow]"
                shortcut = "map_mode_diplomatic_relations"
                blockoverride "text" {
                    raw_text = "FAITH_VIEW_HEADING"
                }
                blockoverride "extra" {
                    text = ","
                    flowcontainer = {
                        ignoreinvisible = yes
                        spacing = 3
                        visible = "[IsNot('faith_view_tabs')]"
                        text_single = {
                            visible = "[ObjectsEqual(GetPlayer.GetFaith, Faith.Self)]"
                            raw_text = "Your"
                        }
                        text_single = {
                            visible = "[Not(Faith.IsUnreformed)]"
                            raw_text = "organized"
                        }
                        text_single = {
                            visible = "[Faith.IsUnreformed]"
                            text = "[GetFaithDoctrine('unreformed_faith_doctrine').GetBaseName]"
                        }
                        text_single = {
                            raw_text = "[Faith.GetReligion.GetAdjective]"
                        }
                        text_single = {
                            raw_text = "faith,"
                        }
                        text_single = {
                            visible = "[EqualTo_int32(GetDataModelSize(Faith.GetReligion.GetFaiths), (int32)1)]"
                            raw_text = "only one,"
                        }
                        text_single = {
                            visible = "[GreaterThan_int32(GetDataModelSize(Faith.GetReligion.GetFaiths), (int32)1)]"
                            raw_text = "one of [GetDataModelSize(Faith.GetReligion.GetFaiths)],"
                        }
                        text_single = {
                            raw_text = "Shift+F."
                        }
                    }
                    text_single = {
                        visible = "[Is('faith_view_tabs')]"
                        raw_text = "[Get('faith_view_tabs')]."
                    }
                }
            }
            
            hbox = {
                layoutpolicy_horizontal = expanding
                name = "tabs"
                visible = "[IsNot('faith_view_tabs')]"
                text_single = {
                    raw_text = "Menus:"
                }
                button_text = {
                    blockoverride "pre" {
                        text_single = { raw_text = "1," }
                    }
                    blockoverride "text" {
                        raw_text = "FAITH_BELIEFS"
                    }
                    blockoverride "dot" {}
                    onclick = "[Set('faith_view_tabs', 'beliefs')]"
                    shortcut = "speed_1"
                }
                button_text = {
                    blockoverride "pre" {
                        text_single = { raw_text = "2," }
                    }
                    blockoverride "text" {
                        raw_text = "FAITH_HOLY_SITES"
                    }
                    blockoverride "dot" {}
                    onclick = "[GetVariableSystem.Set('faith_view_tabs', 'holy sites')]"
                    shortcut = "speed_2"
                }
                button_text = {
                    blockoverride "pre" {
                        text_single = { raw_text = "3," }
                    }
                    blockoverride "text" {
                        raw_text = "Followers."
                    }
                    shortcut = "speed_3"
                    onclick = "[GetScriptedGui('faith_followers').Execute(GuiScope.SetRoot(FaithWindow.GetFaith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
                    onclick = "[Set('faith_view_tabs', 'followers')]"
                }
                button_text = {
                    shortcut = "editor_autosave"
                    blockoverride "text" {
                        raw_text = "A, Adjacent faiths."
                    }
                    onclick = "[GetScriptedGui('adjacent_faiths_ocr').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
                    onclick = "[Set('faith_view_tabs', 'adjacent faiths')]"
                }
                agot_patron_tab_button = {}
                expand = {}
            }
            spacer = { size = { 0 5 } }
        }
        
        blockoverride "ocr_content" {
            vbox = {
                layoutpolicy_horizontal = expanding
                visible = "[Is('faith_view_tabs')]"
                
                ### Fervor Detail Tab ###
                flowcontainer = {
                    ignoreinvisible = yes
                    direction = vertical
                    layoutpolicy_horizontal = expanding
                    visible = "[Has('faith_view_tabs', 'fervor')]"
                    flowcontainer = {
                        ignoreinvisible = yes
                        spacing = 3
                        text_single = {
                            raw_text = "FAITH_WINDOW_FERVOR"
                        }
                    }
                    text_multi_wide = {
                        raw_text = "[Faith.GetYearlyFervorChangeDesc]"
                    }
                    text_multi_wide = {
                        raw_text = "game_concept_fervor_desc"
                    }
                }
                
                ### BELIEFS TAB ###
                vbox = {
                    name = "tab_beliefs"
                    visible = "[Has('faith_view_tabs', 'beliefs')]"
                    layoutpolicy_horizontal = expanding
                    spacing = 10
                    
                    hbox = {
                        layoutpolicy_horizontal = expanding
                        visible = "[And(IsNot('doctrines'), IsNot('doctrine'))]"
                        spacing = -1
                        text_single = {
                            raw_text = "Links:"
                        }
                        button_text = {
                            shortcut = "speed_1"
                            onclick = "[Set('doctrines', 'tenets')]"
                            blockoverride "text" {
                                raw_text = "Tenets (1)."
                            }
                        }
                        button_text = {
                            shortcut = "speed_2"
                            onclick = "[Set('doctrines', 'main')]"
                            blockoverride "text" {
                                raw_text = "Main (2)."
                            }
                        }
                        button_text = {
                            shortcut = "speed_3"
                            onclick = "[Set('doctrines', 'marriage')]"
                            blockoverride "text" {
                                raw_text = "Marriage (3)."
                            }
                        }
                        button_text = {
                            shortcut = "speed_4"
                            onclick = "[Set('doctrines', 'crime')]"
                            blockoverride "text" {
                                raw_text = "Crimes (4)."
                            }
                        }
                        button_text = {
                            shortcut = "speed_5"
                            onclick = "[Set('doctrines', 'clergy')]"
                            blockoverride "text" {
                                raw_text = "Clergy (5)."
                            }
                        }
                        button_text = {
                            visible = "[DataModelHasItems(FaithWindow.GetGroupingHelper('special').GetGrouping)]"
                            shortcut = "character_finder"
                            onclick = "[Set('doctrines', 'special')]"
                            blockoverride "text" {
                                raw_text = "special (C)."
                            }
                        }
                        expand = {}
                    }
                    
                    button = {
                        using = close_window_ocr
                        visible = "[Is('doctrines')]"
                        onclick = "[Clear('doctrines')]"
                    }
                    
                    button = {
                        using = close_window_ocr
                        visible = "[Is('doctrine')]"
                        onclick = "[Clear('doctrine')]"
                    }
                    
                    vbox_doctrine_group = {
                        blockoverride "set" {
                            onclick = "[Set('doctrines', 'tenets')]"
                        }
                        visible = "[Or(IsNot('doctrines'), Has('doctrines', 'tenets'))]"
                        blockoverride "datamodel" {
                            datamodel = "[FaithWindow.GetGroupingHelper('core_tenets').GetGrouping]"
                        }
                        blockoverride "doctrine" {
                            raw_text = "FAITH_CORE_TENETS_HEADING"
                        }
                        blockoverride "item" {
                            button = {
                                visible = "[Or(IsNot('doctrine'), Has('doctrine', FaithDoctrine.GetNameNoTooltip(Faith.Self)))]"
                                onclick = "[Set('doctrine', FaithDoctrine.GetNameNoTooltip(Faith.Self))]"
                                layoutpolicy_horizontal = expanding
                                datacontext = "[GuiFaithDoctrineItem.GetDoctrine]"
                                datacontext = "[GuiFaithDoctrineItem.GetFaith]"
                                shortcuts_list = {
                                    visible = "[Has('doctrines', 'tenets')]"
                                    blockoverride "click" {
                                        onclick = "[Set('doctrine', FaithDoctrine.GetNameNoTooltip(Faith.Self))]"
                                    }
                                }
                                container_tenet_item_ocr = {
                                    blockoverride "num" {
                                        visible = "[Has('doctrines', 'tenets')]"
                                    }
                                    resize_parent = yes
                                    margin = { 3 1 }
                                    tooltip = "FAITH_WINDOW_DOCTRINE_TOOLTIP"
                                }
                            }
                        }
                    }
                    
                    vbox_doctrine_group = {
                        visible = "[And(DataModelHasItems(FaithWindow.GetGroupingHelper('special').GetGrouping), Or(IsNot('doctrines'), Has('doctrines', 'special')))]"
                        blockoverride "set" {
                            onclick = "[Set('doctrines', 'special')]"
                        }
                        blockoverride "datamodel" {
                            datamodel = "[FaithWindow.GetGroupingHelper('special').GetGrouping]"
                        }
                        blockoverride "doctrine" {
                            raw_text = "FAITH_DOCTRINES_SPECIAL"
                        }
                        blockoverride "item" {
                            flowcontainer = {
                                layoutpolicy_horizontal = expanding
                                ignoreinvisible = yes
                                direction = vertical
                                datacontext = "[GuiFaithDoctrineItem.GetDoctrine]"
                                datacontext = "[GuiFaithDoctrineItem.GetFaith]"
                                text_single = {
                                    raw_text = "[FaithDoctrine.GetNameNoTooltip(GuiFaithDoctrineItem.GetFaith)]."
                                    tooltip = "FAITH_WINDOW_DOCTRINE_TOOLTIP_WITH_FAITH"
                                    visible = "[Not(Has('doctrines', 'special'))]"
                                }
                                text_multi_wide = {
                                    visible = "[Has('doctrines', 'special')]"
                                    raw_text = "FAITH_WINDOW_DOCTRINE_TOOLTIP_WITH_FAITH"
                                }
                            }
                        }
                    }
                    
                    vbox_doctrine_group = {
                        blockoverride "set" {
                            onclick = "[Set('doctrines', 'main')]"
                        }
                        visible = "[Or(IsNot('doctrines'), Has('doctrines', 'main'))]"
                        blockoverride "datamodel" {
                            datamodel = "[FaithWindow.GetGroupingHelper('main_group').GetGrouping]"
                        }
                        blockoverride "doctrine" {
                            raw_text = "FAITH_DOCTRINES_IMPORTANT"
                        }
                    }
                    
                    vbox_agot_extra_doctrines = {}
                    
                    vbox_doctrine_group = {
                        blockoverride "set" {
                            onclick = "[Set('doctrines', 'marriage')]"
                        }
                        visible = "[Or(IsNot('doctrines'), Has('doctrines', 'marriage'))]"
                        blockoverride "datamodel" {
                            datamodel = "[FaithWindow.GetGroupingHelper('marriage').GetGrouping]"
                        }
                        blockoverride "doctrine" {
                            raw_text = "FAITH_DOCTRINES_MARRIAGE"
                        }
                    }
                    
                    vbox_doctrine_group = {
                        blockoverride "set" {
                            onclick = "[Set('doctrines', 'crime')]"
                        }
                        visible = "[Or(IsNot('doctrines'), Has('doctrines', 'crime'))]"
                        blockoverride "datamodel" {
                            datamodel = "[FaithWindow.GetGroupingHelper('crimes').GetGrouping]"
                        }
                        blockoverride "doctrine" {
                            raw_text = "FAITH_DOCTRINES_CRIMES"
                        }
                    }
                    
                    vbox_doctrine_group = {
                        blockoverride "set" {
                            onclick = "[Set('doctrines', 'clergy')]"
                        }
                        visible = "[Or(IsNot('doctrines'), Has('doctrines', 'clergy'))]"
                        blockoverride "datamodel" {
                            datamodel = "[FaithWindow.GetGroupingHelper('clergy').GetGrouping]"
                        }
                        blockoverride "doctrine" {
                            raw_text = "FAITH_DOCTRINES_CLERGY"
                        }
                    }
                }
                
                ### MAP EXTENTS TAB ###
                vbox = {
                    layoutpolicy_horizontal = expanding
                    layoutpolicy_vertical = expanding
                    visible = "[Has('faith_view_tabs', 'map extents')]"
                    state = {
                        name = "_hide"
                        on_finish = "[Set('map_extent_de_jure_tip', 'yes')]"
                    }
                    blockoverride "name" {
                        raw_text = "[Faith.GetNameNoTooltip]"
                    }
                    blockoverride "refresh" {
                        onclick = "[GetScriptedGui('faith_map_extents').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
                    }
                    flow_map_extents = {
                        layoutpolicy_horizontal = expanding
                        datacontext = "[Faith.MakeScope]"
                    }
                    spacer = { size = { 0 5 } }
                    flow_map_areas = {
                        datacontext = "[Faith.MakeScope]"
                        blockoverride "center" {
                            datacontext = "[Faith.MakeScope.Var('center').Title.GetCountyData]"
                            visible = "[Faith.MakeScope.Var('center').IsSet]"
                        }
                        layoutpolicy_horizontal = expanding
                    }
                    expand = {}
                }
                
                ### HOLY SITES TAB ###
                vbox = {
                    name = "holy_sites"
                    visible = "[GetVariableSystem.HasValue('faith_view_tabs', 'holy sites')]"
                    layoutpolicy_horizontal = expanding
                    flowcontainer = {
                        layoutpolicy_horizontal = expanding
                        ignoreinvisible = yes
                        spacing = 3
                        text_single = {
                            raw_text = "[GetDataModelSize(FaithWindow.GetHolySites)] holy sites,"
                        }
                        text_single = {
                            visible = "[GetScriptedGui('all_holy_sites_held_by_faith').IsShown(GuiScope.SetRoot(Faith.MakeScope).End)]"
                            raw_text = "all"
                        }
                        text_single = {
                            raw_text = "[Faith.MakeScope.ScriptValue('faith_holy_sites_held')] held by [Faith.GetAdherentNamePlural]."
                        }
                    }
                    flowcontainer = {
                        layoutpolicy_horizontal = expanding
                        visible = "[IsNot('holy_site_tip')]"
                        text_single = {
                            datacontext = "[FaithWindow.GetFaith]"
                            text = "FAITH_HOLY_SITE_EXPLANATION"
                        }
                        dot = {}
                    }
                    button_text = {
                        shortcut = "army_split_half"
                        blockoverride "text" {
                            raw_text = "[Select_CString(GetVariableSystem.Exists('holy_site_effects'), 'Show', 'Hide')] effects, F."
                        }
                        layoutpolicy_horizontal = expanding
                        onclick = "[GetVariableSystem.Toggle('holy_site_effects')]"
                    }
                    spacer = { size = { 0 5 } }
                    button_text = {
                        layoutpolicy_horizontal = expanding
                        visible = "[GreaterThan_CFixedPoint(Faith.MakeScope.ScriptValue('faith_holy_sites_held'), CFixedPoint('0'))]"
                        blockoverride "text" {
                            raw_text = "[Faith.MakeScope.ScriptValue('faith_holy_sites_held')] holy sites held by [Faith.GetAdherentNamePlural]:"
                        }
                    }
                    vbox_holy_sites_ocr = {}
                    button_text = {
                        visible = "[GreaterThan_CFixedPoint(Faith.MakeScope.ScriptValue('faith_holy_sites_not_held'), CFixedPoint('0'))]"
                        layoutpolicy_horizontal = expanding
                        blockoverride "text" {
                            raw_text = "[Faith.MakeScope.ScriptValue('faith_holy_sites_not_held')] holy sites not held by [Faith.GetAdherentNamePlural]:"
                        }
                    }
                    vbox_holy_sites_ocr = {
                        blockoverride "visible" {
                            visible = "[Not(GuiHolySiteItem.IsHeldByFaith)]"
                        }
                    }
                }
                
                ### FOLLOWERS TAB ###
                vbox = {
                    layoutpolicy_horizontal = expanding
                    visible = "[Has('faith_view_tabs', 'followers')]"
                    flowcontainer = {
                        ignoreinvisible = yes
                        layoutpolicy_horizontal = expanding
                        visible = "[IsNot('faith_followers_sort')]"
                        button_text = {
                            shortcut = "army_split_half"
                            onclick = "[GetScriptedGui('faith_followers_filter').Execute(GuiScope.SetRoot(GetPlayer.MakeScope).End)]"
                            onclick = "[GetScriptedGui('faith_followers').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
                            blockoverride "pre" {
                                text_single = {
                                    raw_text = "[GetDataModelSize(FaithWindow.GetFaith.MakeScope.GetList('followers'))] [FaithWindow.GetFaith.GetAdjectiveNoTooltip] [Select_CString(GetPlayer.MakeScope.Var('faith_followers_filter').IsSet, 'followers', 'rulers')],"
                                }
                            }
                            blockoverride "text" {
                                raw_text = "show [Select_CString(GetPlayer.MakeScope.Var('faith_followers_filter').IsSet, 'rulers only', 'all followers')], F."
                            }
                        }
                    }
                    flowcontainer = {
                        ignoreinvisible = yes
                        visible = "[IsNot('faith_followers_sort')]"
                        layoutpolicy_horizontal = expanding
                        button_text = {
                            shortcut = "map_mode_2"
                            onclick = "[Set('faith_followers_sort', 'yes')]"
                            blockoverride "text" {
                                raw_text = "Sorted by:"
                            }
                            blockoverride "extra" {
                                text_single = {
                                    visible = "[Not(GetPlayer.MakeScope.Var('faith_followers_sort').IsSet)]"
                                    raw_text = "realm size,"
                                }
                                text_single = {
                                    visible = "[GetPlayer.MakeScope.Var('faith_followers_sort').IsSet]"
                                    raw_text = "[GetPlayer.MakeScope.Var('faith_followers_sort').GetFlagName],"
                                }
                                text_single = {
                                    raw_text = "T."
                                }
                            }
                        }
                        button_text = {
                            visible = "[IsNot('faith_followers_sort')]"
                            shortcut = "map_mode_18"
                            onclick = "[GetScriptedGui('faith_followers').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
                            blockoverride "extra" {
                                text_single = {
                                    raw_text = "Refresh, Control R."
                                }
                            }
                        }
                    }
                    flowcontainer = {
                        ignoreinvisible = yes
                        direction = vertical
                        layoutpolicy_horizontal = expanding
                        visible = "[Is('faith_followers_sort')]"
                        datamodel = "[GetGlobalList('faith_followers_sort')]"
                        button = {
                            using = close_window_ocr
                            onclick = "[Clear('faith_followers_sort')]"
                        }
                        text_single = {
                            raw_text = "Sort by:"
                        }
                        item = {
                            button_text = {
                                blockoverride "y" {}
                                blockoverride "sclick" {
                                    onclick = "[GetScriptedGui('faith_followers').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).AddScope('sorting', MakeScopeFlag(Scope.GetFlagName)).End)]"
                                    onclick = "[Clear('faith_followers_sort')]"
                                }
                                shortcuts_list = {}
                                blockoverride "text" {
                                    raw_text = "[Scope.GetFlagName]"
                                }
                            }
                        }
                    }
                    fixedgridbox = {
                        layoutpolicy_horizontal = expanding
                        addrow = 20
                        addcolumn = 690
                        datamodel = "[FaithWindow.GetFaith.MakeScope.GetList('followers')]"
                        visible = "[IsNot('faith_followers_sort')]"
                        item = {
                            button_text = {
                                blockoverride "sclick" {
                                    using = char_click
                                }
                                shortcuts_list = {}
                                blockoverride "num" {}
                                datacontext = "[Scope.GetCharacter]"
                                blockoverride "pre" {
                                    text_single = {
                                        raw_text = "[Character.GetFirstNameNoTooltip]"
                                    }
                                    text_single = {
                                        margin_right = -3
                                        visible = "[Character.HasLandedTitles]"
                                        raw_text = "of [Character.GetPrimaryTitle.GetNameNoTierNoTooltip]"
                                    }
                                }
                                blockoverride "extra" {
                                    text = ","
                                    flowcontainer = {
                                        ignoreinvisible = yes
                                        spacing = 3
                                        visible = "[GetPlayer.MakeScope.Var('faith_followers_sort').IsSet]"
                                        text_single = {
                                            visible = "[EqualTo_string(GetPlayer.MakeScope.Var('faith_followers_sort').GetFlagName, 'piety')]"
                                            raw_text = "[Character.GetPiety] piety."
                                        }
                                        text_single = {
                                            visible = "[EqualTo_string(GetPlayer.MakeScope.Var('faith_followers_sort').GetFlagName, 'devotion')]"
                                            raw_text = "[GetPietyLevelName(Character.GetPietyLevel)]."
                                        }
                                        text_single = {
                                            visible = "[EqualTo_string(GetPlayer.MakeScope.Var('faith_followers_sort').GetFlagName, 'strength')]"
                                            raw_text = "[Character.GetMilitaryStrengthText] men,"
                                        }
                                        text_single = {
                                            visible = "[EqualTo_string(GetPlayer.MakeScope.Var('faith_followers_sort').GetFlagName, 'sins')]"
                                            raw_text = "[Character.MakeScope.ScriptValue('num_of_sins')] sins,"
                                        }
                                        text_single = {
                                            visible = "[EqualTo_string(GetPlayer.MakeScope.Var('faith_followers_sort').GetFlagName, 'virtues')]"
                                            raw_text = "[Character.MakeScope.ScriptValue('num_of_virtues')] virtues,"
                                        }
                                        text_single = {
                                            raw_text = "[Character.RealmSize] counties,"
                                        }
                                    }
                                    text_single = {
                                        visible = "[Not(ObjectsEqual(Province.Self, MyCapital))]"
                                        datacontext = "[Character.GetCurrentLocation]"
                                        raw_text = "[DistanceTo(MyCapital, Province)|0] [DaysTo(MyCapital, Province)] [Direction(MyCapital, Province)]."
                                    }
                                }
                            }
                        }
                    }
                }
                
                ### COUNTIES TAB ###
                vbox = {
                    layoutpolicy_horizontal = expanding
                    visible = "[Has('faith_view_tabs', 'counties')]"
                    flowcontainer = {
                        ignoreinvisible = yes
                        spacing = 3
                        layoutpolicy_horizontal = expanding
                        button_text = {
                            shortcut = "army_split_half"
                            onclick = "[GetScriptedGui('faith_counties_filter').Execute(GuiScope.SetRoot(GetPlayer.MakeScope).End)]"
                            onclick = "[GetScriptedGui('faith_counties_ocr').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
                            blockoverride "extra" {
                                text_single = {
                                    raw_text = "[GetDataModelSize(Faith.MakeScope.GetList('faith_counties'))] counties[AddTextIf(GetPlayer.MakeScope.Var('faith_counties_filter').IsSet, ' held by non-believers')]."
                                }
                                text_single = {
                                    raw_text = "Show [Select_CString(GetPlayer.MakeScope.Var('faith_counties_filter').IsSet, 'all', 'held by non-believers')] F,"
                                }
                            }
                        }
                        button_text = {
                            onclick = "[GetScriptedGui('faith_counties_ocr').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
                            shortcut = "map_mode_18"
                            blockoverride "text" {
                                raw_text = "Refresh, Control R."
                            }
                        }
                    }
                    fixedgridbox = {
                        layoutpolicy_horizontal = expanding
                        addrow = 20
                        addcolumn = 690
                        datamodel = "[Faith.MakeScope.GetList('faith_counties')]"
                        item = {
                            button_county_ocr = {
                                shortcuts_list = {
                                    blockoverride "click" {
                                        using = prov_click
                                    }
                                }
                                blockoverride "num" {}
                                blockoverride "extra" {
                                    text_single = {
                                        visible = "[Not(ObjectsEqual(Faith.Self, Title.GetHolder.GetFaith))]"
                                        raw_text = "Holder is [Title.GetHolder.GetFaith.GetAdjectiveNoTooltip]."
                                    }
                                }
                            }
                        }
                    }
                }
                
                vbox = {
                    layoutpolicy_horizontal = expanding
                    visible = "[Has('faith_view_tabs', 'counties of other faiths')]"
                    button_text = {
                        layoutpolicy_horizontal = expanding
                        shortcut = "map_mode_18"
                        blockoverride "text" {
                            raw_text = "[GetDataModelSize(Faith.MakeScope.GetList('wrong_counties'))] counties. refresh, Control R."
                        }
                    }
                    fixedgridbox = {
                        layoutpolicy_horizontal = expanding
                        addrow = 20
                        addcolumn = 600
                        datamodel = "[Faith.MakeScope.GetList('wrong_counties')]"
                        item = {
                            button_county_ocr = {
                                blockoverride "num" {}
                                shortcuts_list = {}
                                blockoverride "faith" {}
                                blockoverride "sclick" {
                                    using = prov_click
                                }
                            }
                        }
                    }
                }
                
                ### ADJACENT FAITHS TAB ###
                vbox = {
                    layoutpolicy_horizontal = expanding
                    visible = "[Has('faith_view_tabs', 'adjacent faiths')]"
                    button_text = {
                        layoutpolicy_horizontal = expanding
                        shortcut = "map_mode_18"
                        onclick = "[GetScriptedGui('adjacent_faiths_ocr').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
                        blockoverride "text" {
                            raw_text = "[GetDataModelSize(Faith.MakeScope.GetList('adjacent_faiths'))] faiths, Refresh Control R."
                        }
                    }
                    fixedgridbox = {
                        layoutpolicy_horizontal = expanding
                        addrow = 20
                        addcolumn = 690
                        datamodel = "[FaithWindow.GetFaith.MakeScope.GetList('adjacent_faiths')]"
                        item = {
                            button_text = {
                                datacontext = "[Scope.Faith]"
                                datacontext = "[Scope.Var('closest_county').Title.GetCountyData.GetCapital]"
                                blockoverride "sclick" {
                                    onclick = "[OpenGameViewData('faith', Faith.GetID)]"
                                    onclick = "[Clear('faith_view_tabs')]"
                                }
                                shortcuts_list = {}
                                blockoverride "num" {}
                                blockoverride "text" {
                                    raw_text = "[Faith.GetNameNoTooltip],"
                                }
                                blockoverride "extra" {
                                    text_single = {
                                        raw_text = "[Faith.GetReligion.GetNameNoTooltip],"
                                    }
                                    text_single = {
                                        raw_text = "[Faith.GetNumberOfCountiesOfFaith] counties,"
                                    }
                                    text_distance_capital = {}
                                }
                            }
                        }
                    }
                }
            }
            
            ### BOTTOM SECTION (Always visible in OCR when no tabs) ###
            vbox = {
                layoutpolicy_horizontal = expanding
                visible = "[IsNot('faith_view_tabs')]"
                
                flowcontainer = {
                    layoutpolicy_horizontal = expanding
                    direction = vertical
                    ignoreinvisible = yes
                    button_text = {
                        blockoverride "text" {
                            text = "FAITH_CONVERSION_CONVERT"
                        }
                        blockoverride "dot" {}
                        visible = "[NotEqualTo_uint32(Faith.GetID, GetPlayer.GetFaith.GetID)]"
                        onclick = "[ToggleGameViewData('faith_conversion', Faith.GetID)]"
                    }
                    button_text = {
                        shortcut = "map_mode_15"
                        blockoverride "text" {
                            text = "CREATE_REFORM_FAITH_TEXT"
                        }
                        blockoverride "extra" {
                            text = ","
                            text_single = {
                                raw_text = "Control F."
                            }
                        }
                        visible = "[ObjectsEqual(Faith.Self, GetPlayer.GetFaith)]"
                        onclick = "[OpenGameViewData('faith_creation', Faith.GetID)]"
                    }
                    button_text = {
                        blockoverride "text" {
                            text = "CREATE_TEMPORAL_HEAD_OF_FAITH_TITLE"
                        }
                        blockoverride "disabled" {
                            visible = "[Not(ScriptedGui.IsValid(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End))]"
                        }
                        blockoverride "dot" {}
                        visible = "[And(And(Not(Faith.HasDoctrineByKey('doctrine_no_head')), Not(Faith.GetReligiousHeadTitle.IsValid)), ObjectsEqual(GetPlayer.GetFaith, Faith.Self))]"
                        datacontext = "[GetScriptedGui('create_head_of_faith')]"
                        enabled = "[ScriptedGui.IsValid(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End)]"
                        onclick = "[ScriptedGui.Execute(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End)]"
                        tooltip = "[ScriptedGui.BuildTooltip(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End)]"
                    }
                    button_text = {
                        blockoverride "text" {
                            text = "RECREATE_TEMPORAL_HEAD_OF_FAITH_TITLE"
                        }
                        blockoverride "disabled" {
                            visible = "[Not(ScriptedGui.IsValid(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End))]"
                        }
                        blockoverride "dot" {}
                        visible = "[And(And(Not(Faith.HasDoctrineByKey('doctrine_no_head')), And(Faith.GetReligiousHeadTitle.IsValid, Not(Faith.GetReligiousHeadTitle.HasHolder))), ObjectsEqual(GetPlayer.GetFaith, Faith.Self))]"
                        datacontext = "[GetScriptedGui('recreate_head_of_faith')]"
                        enabled = "[ScriptedGui.IsValid(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End)]"
                        onclick = "[ScriptedGui.Execute(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End)]"
                        tooltip = "[ScriptedGui.BuildTooltip(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End)]"
                    }
                }
                
                spacer = { size = { 0 5 } }
                
                button_text = {
                    layoutpolicy_horizontal = expanding
                    using = prov_click
                    datacontext = "[Faith.MakeScope.Var('closest_county')]"
                    visible = "[And(Scope.IsSet, Not(ObjectsEqual(Faith.Self, GetPlayer.GetFaith)))]"
                    datacontext = "[Scope.Title.GetCountyData.GetCapital]"
                    datacontext = "[Scope.Title]"
                    blockoverride "extra" {
                        text_distance_capital = {}
                        text_single = {
                            raw_text = "Closest county: [Title.GetNameNoTierNoTooltip],"
                        }
                        text_single = {
                            visible = "[Not(ObjectsEqual(Title.Self, Title.GetHolder.GetTopLiege.GetPrimaryTitle))]"
                            raw_text = "in [Title.GetHolder.GetTopLiege.GetPrimaryTitle.GetNameNoTierNoTooltip]"
                        }
                    }
                }
                
                hbox = {
                    layoutpolicy_horizontal = expanding
                    button_text = {
                        shortcut = "character_finder"
                        onclick = "[Set('faith_view_tabs', 'counties')]"
                        onclick = "[GetScriptedGui('faith_counties_ocr').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
                        blockoverride "extra" {
                            text_single = {
                                raw_text = "[Faith.GetNumberOfCountiesOfFaith] counties, C."
                            }
                            text_single = {
                                raw_text = "[Faith.MakeScope.ScriptValue('faith_held_by_enemies')] held by non-believers."
                            }
                        }
                    }
                    button_map_extents = {
                        layoutpolicy_horizontal = expanding
                        onclick = "[GetScriptedGui('faith_map_extents').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
                        onclick = "[Set('faith_view_tabs', 'map extents')]"
                        expand = {}
                    }
                }
                
                button_text = {
                    layoutpolicy_horizontal = expanding
                    onclick = "[GetScriptedGui('faith_followers').Execute(GuiScope.SetRoot(FaithWindow.GetFaith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
                    onclick = "[Set('faith_view_tabs', 'followers')]"
                    blockoverride "extra" {
                        text_single = {
                            raw_text = "[Faith.MakeScope.ScriptValue('num_faith_rulers')] rulers,"
                        }
                        flowcontainer = {
                            ignoreinvisible = yes
                            spacing = 3
                            visible = "[GetScriptedGui('faith_has_rulers').IsShown(GuiScope.SetRoot(Faith.MakeScope).End)]"
                            text_single = {
                                raw_text = "of them"
                            }
                            text_single = {
                                raw_text = "[Faith.MakeScope.ScriptValue('num_faith_sinners')] sinners,"
                            }
                            text_single = {
                                raw_text = "[Faith.MakeScope.ScriptValue('num_faith_virtuous')] virtuous,"
                            }
                            text_single = {
                                visible = "[GetScriptedGui('has_excommunication').IsShown(GuiScope.SetRoot(Faith.MakeScope).End)]"
                                raw_text = "[Faith.MakeScope.ScriptValue('num_faith_excommunicated')] excommunicated,"
                            }
                        }
                        text_single = {
                            visible = "[Not(GetScriptedGui('faith_has_rulers').IsShown(GuiScope.SetRoot(Faith.MakeScope).End))]"
                            raw_text = "[Faith.MakeScope.ScriptValue('faith_followers')] followers."
                        }
                    }
                }
                
                button_text = {
                    layoutpolicy_horizontal = expanding
                    shortcut = "court_scene_editor_toolset_translate"
                    onclick = "[GetScriptedGui('faith_holders_wrong_counties').Execute(GuiScope.SetRoot(Faith.MakeScope).AddScope('player', GetPlayer.MakeScope).End)]"
                    onclick = "[Set('faith_view_tabs', 'counties of other faiths')]"
                    blockoverride "extra" {
                        text_single = {
                            raw_text = "[Faith.GetAdherentNamePluralNoTooltip] hold [Faith.MakeScope.ScriptValue('faith_holders_wrong_counties')] counties of other faiths"
                        }
                        text_single = {
                            raw_text = "and converting [Faith.MakeScope.ScriptValue('faith_holders_convert_counties')]."
                        }
                        text_single = {
                            raw_text = "W."
                        }
                    }
                }
                
                button_text = {
                    layoutpolicy_horizontal = expanding
                    onclick = "[Set('faith_view_tabs', 'holy sites')]"
                    blockoverride "text" {
                        raw_text = "[GetDataModelSize(FaithWindow.GetHolySites)] holy sites,"
                    }
                    blockoverride "extra" {
                        text_single = {
                            visible = "[GetScriptedGui('all_holy_sites_held_by_faith').IsShown(GuiScope.SetRoot(Faith.MakeScope).End)]"
                            raw_text = "all"
                        }
                        text_single = {
                            raw_text = "[Faith.MakeScope.ScriptValue('faith_holy_sites_held')] held by [Faith.GetAdherentNamePlural]."
                        }
                    }
                }
                
                spacer = { size = { 0 5 } }
                
                vbox = {
                    datacontext = "[FaithWindow.GetFaith]"
                    layoutpolicy_horizontal = expanding
                    visible = "[IsNot('faith_view_tabs')]"
                    button_text = {
                        layoutpolicy_horizontal = expanding
                        shortcut = "army_split_half"
                        onclick = "[Set('faith_view_tabs', 'fervor')]"
                        blockoverride "extra" {
                            text_single = {
                                raw_text = "FAITH_WINDOW_FERVOR:"
                            }
                            text_single = {
                                raw_text = "[Faith.GetYearlyFervorChange|2] per year. F."
                                tooltip = "FERVOR_TT"
                            }
                        }
                    }
                    flowcontainer = {
                        ignoreinvisible = yes
                        spacing = 3
                        layoutpolicy_horizontal = expanding
                        flowcontainer = {
                            ignoreinvisible = yes
                            visible = "[Not(ObjectsEqual(GetPlayer.GetFaith, Faith.Self))]"
                            text_single = {
                                name = "our_view"
                                text = "FAITH_VIEW_OUR_VIEW"
                            }
                            dot = {}
                        }
                        flowcontainer = {
                            ignoreinvisible = yes
                            visible = "[Not(ObjectsEqual(GetPlayer.GetFaith, Faith.Self))]"
                            text_single = {
                                name = "their_view"
                                text = "FAITH_VIEW_THEIR_VIEW"
                            }
                            dot = {}
                        }
                    }
                }
                
                vbox = {
                    layoutpolicy_horizontal = expanding
                    visible = "[IsNot('faith_view_tabs')]"
                    button_text = {
                        layoutpolicy_horizontal = expanding
                        onclick = "[Set('faith_view_tabs', 'beliefs')]"
                        onclick = "[Set('doctrines', 'tenets')]"
                        blockoverride "text" {
                            raw_text = "Core tenets:"
                        }
                        blockoverride "extra" {
                            flowcontainer = {
                                ignoreinvisible = yes
                                spacing = 3
                                datamodel = "[FaithWindow.GetGroupingHelper('core_tenets').GetGrouping]"
                                item = {
                                    text_single = {
                                        datacontext = "[GuiFaithDoctrineItem.GetDoctrine]"
                                        datacontext = "[GuiFaithDoctrineItem.GetFaith]"
                                        raw_text = "[FaithDoctrine.GetNameNoTooltip(Faith.Self)]."
                                    }
                                }
                            }
                        }
                    }
                    vbox = {
                        name = "sins_and_virtues"
                        layoutpolicy_horizontal = expanding
                        hbox = {
                            name = "sins"
                            layoutpolicy_horizontal = expanding
                            flowcontainer = {
                                ignoreinvisible = yes
                                text_single = {
                                    raw_text = "FAITH_WINDOW_SINS"
                                }
                                space = {}
                                text_single = {
                                    raw_text = "[GetDataModelSize(FaithWindow.GetSins)]"
                                }
                                text_single = {
                                    raw_text = ":"
                                }
                                space = {}
                            }
                            dynamicgridbox = {
                                name = "virtues_grid"
                                datamodel = "[FaithWindow.GetSins]"
                                flipdirection = yes
                                datamodel_wrap = 7
                                item = {
                                    text_single = {
                                        margin_right = 3
                                        datacontext = "[GuiVirtueOrSinItem.GetTrait]"
                                        raw_text = "[Trait.GetNameNoTooltip(GetPlayer)],"
                                        tooltipwidget = {
                                            using = faith_window_trait_tooltip
                                        }
                                    }
                                }
                            }
                            expand = {}
                        }
                        hbox = {
                            name = "virtues"
                            layoutpolicy_horizontal = expanding
                            flowcontainer = {
                                ignoreinvisible = yes
                                text_single = {
                                    raw_text = "FAITH_WINDOW_VIRTUES"
                                }
                                space = {}
                                text_single = {
                                    raw_text = "[GetDataModelSize(FaithWindow.GetVirtues)]"
                                }
                                text_single = {
                                    raw_text = ":"
                                }
                                space = {}
                            }
                            dynamicgridbox = {
                                name = "virtues_grid"
                                datamodel = "[FaithWindow.GetVirtues]"
                                flipdirection = yes
                                item = {
                                    text_single = {
                                        margin_right = 3
                                        datacontext = "[GuiVirtueOrSinItem.GetTrait]"
                                        raw_text = "[Trait.GetNameNoTooltip(GetPlayer)],"
                                        tooltipwidget = {
                                            using = faith_window_trait_tooltip
                                        }
                                    }
                                }
                            }
                            expand = {}
                        }
                    }
                    flowcontainer = {
                        ignoreinvisible = yes
                        spacing = 3
                        layoutpolicy_horizontal = expanding
                        text_single = {
                            raw_text = "Crimes [PdxGuiWidget.AccessParent.FindChild('crimes').CountVisibleChildren]:"
                        }
                        flowcontainer = {
                            datamodel = "[FaithWindow.GetGroupingHelper('crimes').GetGrouping]"
                            ignoreinvisible = yes
                            name = "crimes"
                            spacing = 3
                            item = {
                                text_single = {
                                    datacontext = "[GuiFaithDoctrineItem.GetDoctrine]"
                                    datacontext = "[GuiFaithDoctrineItem.GetFaith]"
                                    raw_text = "[FaithDoctrine.GetGroup.GetName(Faith.Self)],"
                                    visible = "[EqualTo_string(FaithDoctrine.GetNameNoTooltip(Faith.Self), Localize('game_concept_criminal'))]"
                                }
                            }
                        }
                    }
                    spacer = { size = { 0 5 } }
                    button_text = {
                        shortcut = "mapmode_house_secondary"
                        blockoverride "text" {
                            raw_text = "Show faith description, Shift D."
                        }
                        layoutpolicy_horizontal = expanding
                        onclick = "[Set('faith_view_tabs', 'description')]"
                    }
                    vbox = {
                        layoutpolicy_horizontal = expanding
                        flowcontainer = {
                            direction = vertical
                            layoutpolicy_horizontal = expanding
                            char_name = {
                                shortcut = "army_create_new"
                                blockoverride "pre" {
                                    text_single = {
                                        raw_text = "RELIGIOUS_HEAD"
                                    }
                                    text = ","
                                }
                                blockoverride "extra" {
                                    text_single = {
                                        raw_text = "H."
                                    }
                                }
                                blockoverride "width" {
                                    max_width = 600
                                }
                                datacontext = "[Faith.GetReligiousHead]"
                                visible = "[Faith.GetReligiousHead.IsValid]"
                            }
                            button_text = {
                                datacontext = "[Faith.GetReligiousHead]"
                                visible = "[Faith.GetReligiousHead.IsValid]"
                                shortcut = "decrease_speed_2"
                                onclick = "[ToggleFilteredCharacterInteractionMenu(Character.Self, 'interaction_category_religion')]"
                                onclick = "[Set('filtered_actions', 'yes')]"
                                blockoverride "text" {
                                    raw_text = "[GetNumberOfValidInteractionsWithFilter(Character.Self, 'interaction_category_religion')] head_of_faith Interactions, Z."
                                }
                            }
                            flowcontainer = {
                                ignoreinvisible = yes
                                visible = "[Not(Faith.GetReligiousHead.IsValid)]"
                                text_single = {
                                    text = "RELIGIOUS_HEAD_EMPTY_DESC"
                                    max_width = 600
                                    autoresize = yes
                                }
                                dot = {}
                            }
                        }
                        vbox = {
                            layoutpolicy_horizontal = expanding
                            widget_doctrine_item_ocr = {
                                visible = "[Faith.HasDoctrineByKey('doctrine_spiritual_head')]"
                                blockoverride "background" {}
                                blockoverride "doctrine_icon" {
                                    texture = "[GetDoctrine('doctrine_spiritual_head').GetIcon]"
                                }
                                blockoverride "wdi_context" {
                                    datacontext = "[GetDoctrine('doctrine_spiritual_head')]"
                                    datacontext = "[Faith]"
                                }
                            }
                            widget_doctrine_item_ocr = {
                                visible = "[Faith.HasDoctrineByKey('doctrine_temporal_head')]"
                                blockoverride "background" {}
                                blockoverride "doctrine_icon" {
                                    texture = "[GetDoctrine('doctrine_temporal_head').GetIcon]"
                                }
                                blockoverride "wdi_context" {
                                    datacontext = "[GetDoctrine('doctrine_temporal_head')]"
                                    datacontext = "[Faith]"
                                }
                            }
                            button_text = {
                                shortcut = "map_mode_2"
                                blockoverride "text" {
                                    raw_text = "Title: [Title.GetNameNoTooltip|U], T."
                                }
                                layoutpolicy_horizontal = expanding
                                using = title_click
                                datacontext = "[Faith.GetReligiousHeadTitle]"
                                visible = "[Title.IsValid]"
                            }
                        }
                    }
                }
            }
        }
    }
    
    ### VANILLA MODE WIDGET ###
    
    widget = {
        visible = "[GetVariableSystem.Exists('ocr')]"
        using = Window_Size_Sidebar
        using = Window_Background_Sidebar
        
        vbox = {
            using = Window_Margins_Sidebar
            
            widget_header_with_picture = {
                name = "header"
                datacontext = "[GetIllustration('religion_interior')]"
                size = { 0 130 }
                layoutpolicy_horizontal = expanding
                layoutpolicy_vertical = fixed
                blockoverride "size" {
                    size = { 100% 143 }
                }
                blockoverride "header_text" {
                    text = "FAITH_VIEW_HEADING"
                    using = tooltip_es
                    state = {
                        name = "faith_view_refresh"
                        using = Animation_Refresh_FadeOut
                    }
                    state = {
                        using = Animation_Refresh_FadeIn
                    }
                }
                blockoverride "button_close" {
                    onclick = "[FaithWindow.Close]"
                }
                blockoverride "button_back" {
                    visible = "[HasViewHistory]"
                    onclick = "[OpenFromViewHistory]"
                    tooltip = "[GetViewHistoryTooltip]"
                }
                blockoverride "button_me" {
                    onclick = "[DefaultOnCharacterClick(GetPlayer.GetID)]"
                }
                blockoverride "illustration_texture" {
                    texture = "[Illustration.GetTexture(FaithWindow.GetFaith.MakeScope)]"
                    spriteType = stretched
                    fittype = centercrop
                    alpha = 0.35
                }
                hbox = {
                    datacontext = "[FaithWindow.GetFaith]"
                    watch_window_button = {
                        size = { 60 40 }
                        onclick = "[AddWatchWindow(FaithWindow.GetFaith.MakeScope)]"
                    }
                    vbox = {
                        margin_top = 30
                        margin_left = 10
                        icon = {
                            name = "faith_icon"
                            size = { 100 100 }
                            texture = "[Faith.GetIcon]"
                            using = tooltip_se
                            tooltipwidget = {
                                faith_tooltip = {}
                            }
                            state = {
                                name = "faith_view_refresh"
                                using = Animation_Refresh_FadeOut
                            }
                            state = {
                                using = Animation_Refresh_FadeIn
                            }
                        }
                    }
                    vbox = {
                        layoutpolicy_horizontal = expanding
                        layoutpolicy_vertical = expanding
                        expand = {}
                        hbox = {
                            layoutpolicy_horizontal = expanding
                            expand = {}
                            vbox = {
                                layoutpolicy_vertical = expanding
                                margin_bottom = 4
                                margin_left = 25
                                spacing = 1
                                text_single = {
                                    name = "your_faith"
                                    visible = "[ObjectsEqual(GetPlayer.GetFaith, Faith.Self)]"
                                    text = "FAITH_VIEW_YOUR_FAITH"
                                    align = nobaseline|center
                                }
                                expand = {}
                                text_single = {
                                    name = "our_view"
                                    visible = "[Not(ObjectsEqual(GetPlayer.GetFaith, Faith.Self))]"
                                    layoutpolicy_horizontal = expanding
                                    text = "FAITH_VIEW_OUR_VIEW"
                                    align = nobaseline|center
                                }
                                text_single = {
                                    name = "their_view"
                                    visible = "[Not(ObjectsEqual(GetPlayer.GetFaith, Faith.Self))]"
                                    layoutpolicy_horizontal = expanding
                                    text = "FAITH_VIEW_THEIR_VIEW"
                                    align = nobaseline|center
                                }
                            }
                            expand = {}
                            vbox = {
                                margin = { 10 0 }
                                spacing = 2
                                fervor_container_vbox = {}
                                button_sidepanel_right = {
                                    name = "religion_information"
                                    datacontext = "[Faith.GetReligion]"
                                    onclick = "[FaithWindow.ToggleReligionWindow]"
                                    tooltip = "TOGGLE_RELIGION_VIEW_TOOLTIP"
                                    using = tooltip_nw
                                    blockoverride "button_text" {
                                        text = "TOGGLE_RELIGION_VIEW"
                                    }
                                }
                            }
                        }
                    }
                }
                text_single = {
                    visible = "[And(Not(Faith.GetReligion.HasPaganRoots), Not(Faith.IsUnreformed))]"
                    text = "FAITH_VIEW_SUBHEADING"
                    align = center
                    parentanchor = top|hcenter
                    position = { 0 40 }
                    alpha = 0.9
                }
                text_label_center = {
                    visible = "[Faith.IsUnreformed]"
                    text = "FAITH_VIEW_UNREFORMED_SUBHEADING"
                    align = center
                    parentanchor = top|hcenter
                    position = { 0 40 }
                    alpha = 0.8
                }
                text_label_center = {
                    visible = "[And(Faith.GetReligion.HasPaganRoots, Not(Faith.IsUnreformed))]"
                    text = "FAITH_VIEW_REFORMED_SUBHEADING"
                    align = center
                    parentanchor = top|hcenter
                    position = { 0 40 }
                    alpha = 0.8
                }
            }
            
            hbox = {
                layoutpolicy_horizontal = expanding
                name = "tabs"
                button_tab = {
                    layoutpolicy_horizontal = expanding
                    onclick = "[GetVariableSystem.Set('faith_view_tabs', 'beliefs')]"
                    down = "[GetVariableSystem.HasValue('faith_view_tabs', 'beliefs')]"
                    text = "FAITH_BELIEFS"
                    default_format = "#low"
                    using = tooltip_below
                }
                button_tab = {
                    layoutpolicy_horizontal = expanding
                    onclick = "[GetVariableSystem.Set('faith_view_tabs', 'holy_sites')]"
                    down = "[GetVariableSystem.HasValue('faith_view_tabs', 'holy_sites')]"
                    text = "FAITH_HOLY_SITES"
                    default_format = "#low"
                    using = tooltip_below
                }
            }
            
            vbox = {
                name = "tab_beliefs"
                visible = "[GetVariableSystem.HasValue('faith_view_tabs', 'beliefs')]"
                layoutpolicy_horizontal = expanding
                layoutpolicy_vertical = expanding
                state = {
                    name = "_show"
                    using = Animation_FadeIn_Quick
                }
                state = {
                    name = "_hide"
                    alpha = 0
                }
                vbox = {
                    layoutpolicy_horizontal = expanding
                    spacing = 8
                    margin = { 8 16 }
                    margin_bottom = 11
                    text_label_center = {
                        text = "FAITH_CORE_TENETS_HEADING"
                    }
                    hbox = {
                        name = "doctrines_grid_core_tenets"
                        datamodel = "[FaithWindow.GetGroupingHelper('core_tenets').GetGrouping]"
                        spacing = 52
                        state = {
                            name = "faith_view_refresh"
                            using = Animation_Refresh_FadeOut
                        }
                        state = {
                            using = Animation_Refresh_FadeIn
                        }
                        item = {
                            container_tenet_item = {
                                datacontext = "[GuiFaithDoctrineItem.GetDoctrine]"
                                datacontext = "[GuiFaithDoctrineItem.GetFaith]"
                                tooltip = "FAITH_WINDOW_DOCTRINE_TOOLTIP"
                            }
                        }
                    }
                }
                vbox = {
                    name = "doctrines"
                    layoutpolicy_horizontal = expanding
                    layoutpolicy_vertical = expanding
                    scrollbox = {
                        layoutpolicy_horizontal = expanding
                        layoutpolicy_vertical = expanding
                        blockoverride "scrollbox_content" {
                            spacing = 16
                            state = {
                                name = "faith_view_refresh"
                                using = Animation_Refresh_FadeOut
                            }
                            state = {
                                using = Animation_Refresh_FadeIn
                            }
                            hbox = {
                                name = "sins_and_virtues"
                                layoutpolicy_vertical = expanding
                                spacing = 15
                                expand = { layoutstretchfactor_horizontal = 1 }
                                vbox = {
                                    name = "sins"
                                    spacing = 3
                                    layoutpolicy_vertical = expanding
                                    layoutpolicy_horizontal = expanding
                                    hbox = {
                                        spacing = 5
                                        expand = {}
                                        icon = {
                                            texture = "gfx/interface/icons/traits/sin_big.dds"
                                        }
                                        text_single = {
                                            text = "FAITH_WINDOW_SINS"
                                            align = right|nobaseline
                                        }
                                    }
                                    vbox = {
                                        dynamicgridbox = {
                                            name = "virtues_grid"
                                            datamodel = "[FaithWindow.GetSins]"
                                            flipdirection = yes
                                            datamodel_wrap = 6
                                            item = {
                                                icon = {
                                                    datacontext = "[GuiVirtueOrSinItem.GetTrait]"
                                                    size = { 40 40 }
                                                    alwaystransparent = yes
                                                    texture = "[Trait.GetIcon(GetPlayer)]"
                                                    tooltipwidget = {
                                                        using = faith_window_trait_tooltip
                                                        block "tooltip_placement" {
                                                            using = tooltip_ne
                                                            tooltip_offset = { 0 20 }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    expand = {}
                                }
                                divider_light = {
                                    layoutpolicy_vertical = expanding
                                }
                                vbox = {
                                    name = "virtues"
                                    spacing = 3
                                    layoutpolicy_vertical = expanding
                                    layoutpolicy_horizontal = expanding
                                    hbox = {
                                        spacing = 5
                                        expand = {}
                                        icon = {
                                            texture = "gfx/interface/icons/traits/virtue_big.dds"
                                        }
                                        text_single = {
                                            text = "FAITH_WINDOW_VIRTUES"
                                            align = nobaseline
                                        }
                                    }
                                    vbox = {
                                        dynamicgridbox = {
                                            name = "virtues_grid"
                                            datamodel = "[FaithWindow.GetVirtues]"
                                            flipdirection = yes
                                            datamodel_wrap = 6
                                            item = {
                                                icon = {
                                                    datacontext = "[GuiVirtueOrSinItem.GetTrait]"
                                                    size = { 40 40 }
                                                    alwaystransparent = yes
                                                    texture = "[Trait.GetIcon(GetPlayer)]"
                                                    tooltipwidget = {
                                                        using = faith_window_trait_tooltip
                                                        block "tooltip_placement" {
                                                            using = tooltip_ne
                                                            tooltip_offset = { 0 20 }
                                                        }
                                                    }
                                                }
                                            }
                                        }
                                    }
                                    expand = {}
                                }
                                expand = { layoutstretchfactor_horizontal = 1 }
                            }
                            vbox = {
                                layoutpolicy_horizontal = expanding
                                spacing = 8
                                margin_bottom = -8
                                text_label_center = {
                                    layoutpolicy_horizontal = expanding
                                    text = "FAITH_DOCTRINES_IMPORTANT"
                                    default_format = "#low"
                                }
                                hbox = {
                                    layoutpolicy_horizontal = expanding
                                    hbox = {
                                        name = "important_doctrines"
                                        datamodel = "[FaithWindow.GetGroupingHelper('main_group').GetGrouping]"
                                        layoutpolicy_vertical = expanding
                                        minimumsize = { 0 108 }
                                        item = {
                                            vbox = {
                                                layoutpolicy_vertical = expanding
                                                minimumsize = { 100 0 }
                                                name = "doctrine_list_item"
                                                datacontext = "[GuiFaithDoctrineItem.GetDoctrine]"
                                                visible = "[FaithDoctrine.IsVisible]"
                                                tooltip = "FAITH_WINDOW_DOCTRINE_TOOLTIP"
                                                using = tooltip_se
                                                icon_doctrine = {
                                                    name = "doctrine_group_icon"
                                                    size = { 60 60 }
                                                    texture = "[FaithDoctrine.GetIcon]"
                                                }
                                                text_single = {
                                                    name = "doctrine_name"
                                                    align = center
                                                    text = "[FaithDoctrine.GetNameNoTooltip(GuiFaithDoctrineItem.GetFaith)]"
                                                    default_format = "#high"
                                                    multiline = yes
                                                    max_width = 101
                                                }
                                                expand = {}
                                            }
                                        }
                                    }
                                }
                            }
                            vbox = {
                                layoutpolicy_horizontal = expanding
                                spacing = 12
                                margin_bottom = -10
                                text_label_center = {
                                    layoutpolicy_horizontal = expanding
                                    text = "FAITH_DOCTRINES_MARRIAGE"
                                    default_format = "#low"
                                }
                                fixedgridbox = {
                                    datamodel = "[FaithWindow.GetGroupingHelper('marriage').GetGrouping]"
                                    flipdirection = yes
                                    addcolumn = 225
                                    addrow = 67
                                    datamodel_wrap = 2
                                    item = {
                                        widget_doctrine_item = {}
                                    }
                                }
                            }
                            vbox = {
                                layoutpolicy_horizontal = expanding
                                spacing = 12
                                margin_bottom = -10
                                text_label_center = {
                                    layoutpolicy_horizontal = expanding
                                    text = "FAITH_DOCTRINES_CRIMES"
                                    default_format = "#low"
                                }
                                fixedgridbox = {
                                    datamodel = "[FaithWindow.GetGroupingHelper('crimes').GetGrouping]"
                                    flipdirection = yes
                                    addcolumn = 225
                                    addrow = 67
                                    datamodel_wrap = 2
                                    item = {
                                        widget_doctrine_item = {}
                                    }
                                }
                            }
                            vbox = {
                                layoutpolicy_horizontal = expanding
                                spacing = 12
                                margin_bottom = -10
                                text_label_center = {
                                    layoutpolicy_horizontal = expanding
                                    text = "FAITH_DOCTRINES_CLERGY"
                                    default_format = "#low"
                                }
                                fixedgridbox = {
                                    datamodel = "[FaithWindow.GetGroupingHelper('clergy').GetGrouping]"
                                    flipdirection = yes
                                    addcolumn = 225
                                    addrow = 67
                                    datamodel_wrap = 2
                                    item = {
                                        widget_doctrine_item = {}
                                    }
                                }
                            }
                            vbox = {
                                visible = "[DataModelHasItems(FaithWindow.GetGroupingHelper('special').GetGrouping)]"
                                layoutpolicy_horizontal = expanding
                                spacing = 7
                                text_label_center = {
                                    layoutpolicy_horizontal = expanding
                                    text = "FAITH_DOCTRINES_SPECIAL"
                                    default_format = "#low"
                                }
                                vbox = {
                                    datamodel = "[FaithWindow.GetGroupingHelper('special').GetGrouping]"
                                    layoutpolicy_horizontal = expanding
                                    margin_left = 50
                                    margin_right = 66
                                    spacing = 8
                                    item = {
                                        text_single = {
                                            layoutpolicy_horizontal = expanding
                                            margin = { 17 0 }
                                            margin_top = 12
                                            margin_bottom = 13
                                            datacontext = "[GuiFaithDoctrineItem.GetDoctrine]"
                                            datacontext = "[GuiFaithDoctrineItem.GetFaith]"
                                            text = "[FaithDoctrine.GetNameNoTooltip(GuiFaithDoctrineItem.GetFaith)]"
                                            tooltip = "FAITH_WINDOW_DOCTRINE_TOOLTIP_WITH_FAITH"
                                            align = nobaseline
                                            using = tooltip_es
                                            background = {
                                                using = Background_Area
                                            }
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
                widget = {
                    size = { 0 8 }
                }
                vbox = {
                    name = "religious_head"
                    layoutpolicy_horizontal = expanding
                    state = {
                        name = "faith_view_refresh"
                        using = Animation_Refresh_FadeOut
                    }
                    state = {
                        using = Animation_Refresh_FadeIn
                    }
                    hbox = {
                        name = "current_hof"
                        layoutpolicy_horizontal = expanding
                        spacing = 5
                        background = {
                            using = Background_Area
                        }
                        portrait_head = {
                            name = "character_portrait"
                            datacontext = "[Faith.GetReligiousHead]"
                            visible = "[Faith.GetReligiousHead.IsValid]"
                            blockoverride "coa" {}
                            blockoverride "opinion_box" {}
                        }
                        hbox = {
                            layoutpolicy_horizontal = expanding
                            layoutpolicy_vertical = expanding
                            spacing = 3
                            margin = { 0 10 }
                            spacer = {
                                visible = "[Not(Faith.GetReligiousHead.IsValid)]"
                                size = { 10 3 }
                            }
                            vbox = {
                                layoutpolicy_horizontal = expanding
                                layoutpolicy_vertical = expanding
                                spacing = 5
                                text_label_left = {
                                    layoutpolicy_horizontal = expanding
                                    text = "RELIGIOUS_HEAD"
                                    default_format = "#low"
                                    fontsize_min = 14
                                }
                                hbox = {
                                    layoutpolicy_horizontal = expanding
                                    text_multi = {
                                        visible = "[Faith.GetReligiousHead.IsValid]"
                                        text = "RELIGIOUS_HEAD_WITH_NAME"
                                        default_format = "#high"
                                        layoutpolicy_horizontal = expanding
                                        fontsize_min = 10
                                    }
                                    text_multi = {
                                        visible = "[Not(Faith.GetReligiousHead.IsValid)]"
                                        text = "RELIGIOUS_HEAD_EMPTY_DESC"
                                        default_format = "#weak"
                                        layoutpolicy_horizontal = expanding
                                        align = left
                                        fontsize_min = 10
                                    }
                                    expand = {}
                                }
                                hbox = {
                                    layoutpolicy_horizontal = expanding
                                    button_round = {
                                        datacontext = "[Faith.GetReligiousHead]"
                                        visible = "[Faith.GetReligiousHead.IsValid]"
                                        tooltip = "HOF_INTERACTIONS_BUTTON_TOOLTIP"
                                        tooltip_visible = "[Not(IsInteractionMenuOpenForCharacterWithFilter(Character.Self, 'interaction_category_religion'))]"
                                        onclick = "[ToggleFilteredCharacterInteractionMenu(Character.Self, 'interaction_category_religion')]"
                                        button_icon = {
                                            alwaystransparent = yes
                                            parentanchor = center
                                            size = { 30 30 }
                                            texture = "gfx/interface/icons/flat_icons/character_interactions.dds"
                                        }
                                        text_single = {
                                            parentanchor = bottom|hcenter
                                            position = { 0 3 }
                                            text = "[GetNumberOfValidInteractionsWithFilter(Character.Self, 'interaction_category_religion')]"
                                            default_format = "#glow_color:{0.1,0.1,0.1,1.0}"
                                            background = {
                                                margin = { 5 0 }
                                                margin_top = -5
                                                using = Background_Area_Dark
                                            }
                                        }
                                    }
                                    expand = {}
                                }
                                expand = {}
                            }
                        }
                        vbox = {
                            layoutpolicy_vertical = expanding
                            margin = { 0 5 }
                            divider_light = {
                                layoutpolicy_vertical = expanding
                            }
                        }
                        vbox = {
                            layoutpolicy_vertical = expanding
                            margin = { 5 5 }
                            spacing = 5
                            widget_doctrine_item = {
                                visible = "[Faith.HasDoctrineByKey('doctrine_no_head')]"
                                blockoverride "background" {}
                                blockoverride "doctrine_icon" {
                                    texture = "[GetDoctrine('doctrine_no_head').GetIcon]"
                                }
                                blockoverride "wdi_context" {
                                    datacontext = "[GetDoctrine('doctrine_no_head')]"
                                    datacontext = "[Faith]"
                                }
                            }
                            widget_doctrine_item = {
                                visible = "[Faith.HasDoctrineByKey('doctrine_spiritual_head')]"
                                blockoverride "background" {}
                                blockoverride "doctrine_icon" {
                                    texture = "[GetDoctrine('doctrine_spiritual_head').GetIcon]"
                                }
                                blockoverride "wdi_context" {
                                    datacontext = "[GetDoctrine('doctrine_spiritual_head')]"
                                    datacontext = "[Faith]"
                                }
                            }
                            widget_doctrine_item = {
                                visible = "[Faith.HasDoctrineByKey('doctrine_temporal_head')]"
                                blockoverride "background" {}
                                blockoverride "doctrine_icon" {
                                    texture = "[GetDoctrine('doctrine_temporal_head').GetIcon]"
                                }
                                blockoverride "wdi_context" {
                                    datacontext = "[GetDoctrine('doctrine_temporal_head')]"
                                    datacontext = "[Faith]"
                                }
                            }
                            expand = {}
                            hbox = {
                                name = "hof_title"
                                layoutpolicy_horizontal = expanding
                                datacontext = "[Faith.GetReligiousHeadTitle]"
                                visible = "[Title.IsValid]"
                                spacing = 5
                                coa_title_tiny_crown = {
                                    name = "head_title"
                                }
                                hbox = {
                                    layoutpolicy_horizontal = expanding
                                    text_multi = {
                                        text = "[Title.GetNameNoTooltip|U]"
                                        layoutpolicy_horizontal = expanding
                                        autoresize = yes
                                        max_width = 160
                                    }
                                    expand = {}
                                }
                            }
                            expand = {}
                        }
                    }
                }
                hbox = {
                    spacing = 10
                    margin_bottom = 8
                    margin_top = 8
                    layoutpolicy_horizontal = expanding
                    expand = {}
                    button_standard = {
                        name = "convert_faith"
                        minimumsize = { 240 0 }
                        visible = "[NotEqualTo_uint32(Faith.GetID, GetPlayer.GetFaith.GetID)]"
                        text = "FAITH_CONVERSION_CONVERT"
                        onclick = "[ToggleGameViewData('faith_conversion', Faith.GetID)]"
                        using = tooltip_nw
                    }
                    button_standard = {
                        name = "create_faith"
                        minimumsize = { 240 0 }
                        visible = "[And(ObjectsEqual(Faith.Self, GetPlayer.GetFaith), GetVariableSystem.HasValue('faith_view_tabs', 'beliefs'))]"
                        text = "CREATE_REFORM_FAITH_TEXT"
                        onclick = "[OpenGameViewData('faith_creation', Faith.GetID)]"
                        tooltip = "CREATE_REFORM_FAITH_TOOLTIP"
                        using = tooltip_nw
                    }
                    button_standard = {
                        name = "create_head_of_faith"
                        minimumsize = { 240 0 }
                        visible = "[And(And(Not(Faith.HasDoctrineByKey('doctrine_no_head')), Not(Faith.GetReligiousHeadTitle.IsValid)), ObjectsEqual(GetPlayer.GetFaith, Faith.Self))]"
                        datacontext = "[GetScriptedGui('create_head_of_faith')]"
                        enabled = "[ScriptedGui.IsValid(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End)]"
                        onclick = "[ScriptedGui.Execute(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End)]"
                        tooltip = "[ScriptedGui.BuildTooltip(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End)]"
                        text = "CREATE_TEMPORAL_HEAD_OF_FAITH_TITLE"
                    }
                    button_standard = {
                        name = "recreate_head_of_faith"
                        minimumsize = { 240 0 }
                        visible = "[And(And(Not(Faith.HasDoctrineByKey('doctrine_no_head')), And(Faith.GetReligiousHeadTitle.IsValid, Not(Faith.GetReligiousHeadTitle.HasHolder))), ObjectsEqual(GetPlayer.GetFaith, Faith.Self))]"
                        datacontext = "[GetScriptedGui('recreate_head_of_faith')]"
                        enabled = "[ScriptedGui.IsValid(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End)]"
                        onclick = "[ScriptedGui.Execute(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End)]"
                        tooltip = "[ScriptedGui.BuildTooltip(GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('faith', Faith.MakeScope).End)]"
                        text = "RECREATE_TEMPORAL_HEAD_OF_FAITH_TITLE"
                    }
                    expand = {}
                }
            }
            
            scrollbox = {
                name = "tab_holy_sites"
                visible = "[GetVariableSystem.HasValue('faith_view_tabs', 'holy_sites')]"
                layoutpolicy_horizontal = expanding
                layoutpolicy_vertical = expanding
                datacontext = "[GetIllustration('religion_holding')]"
                blockoverride "scrollbox_background" {}
                blockoverride "scrollbox_background_fade" {}
                state = {
                    name = "_show"
                    using = Animation_FadeIn_Quick
                }
                state = {
                    name = "_hide"
                    alpha = 0
                }
                background = {
                    alpha = 0.5
                    fittype = end
                    texture = "[Illustration.GetTexture(FaithWindow.GetFaith.MakeScope)]"
                    modify_texture = {
                        mirror = vertical
                        blend_mode = alphamultiply
                        texture = "gfx/interface/component_masks/mask_fade_vertical.dds"
                    }
                }
                blockoverride "scrollbox_content" {
                    vbox = {
                        name = "holy_sites"
                        datamodel = "[FaithWindow.GetHolySites]"
                        layoutpolicy_horizontal = expanding
                        text_multi = {
                            datacontext = "[FaithWindow.GetFaith]"
                            layoutpolicy_horizontal = expanding
                            size = { 0 45 }
                            text = "FAITH_HOLY_SITE_EXPLANATION"
                            default_format = "#weak"
                            margin = { 0 5 }
                            margin_bottom = 15
                            align = center
                            max_width = 560
                            autoresize = yes
                            state = {
                                name = "faith_view_refresh"
                                using = Animation_Refresh_FadeOut
                            }
                            state = {
                                using = Animation_Refresh_FadeIn
                            }
                        }
                        item = {
                            vbox = {
                                layoutpolicy_horizontal = expanding
                                spacing = 3
                                divider_light = {
                                    layoutpolicy_horizontal = expanding
                                }
                                hbox = {
                                    name = "faith_list_item"
                                    datacontext = "[GuiHolySiteItem.GetHolySite]"
                                    datacontext = "[HolySite.GetBarony]"
                                    layoutpolicy_horizontal = expanding
                                    layoutpolicy_vertical = expanding
                                    margin_right = 15
                                    background = {
                                        using = Background_Area
                                        alpha = 0.2
                                    }
                                    vbox = {
                                        layoutpolicy_vertical = expanding
                                        min_width = 175
                                        spacing = 3
                                        state = {
                                            name = "faith_view_refresh"
                                            using = Animation_Refresh_FadeOut
                                        }
                                        state = {
                                            using = Animation_Refresh_FadeIn
                                        }
                                        hbox = {
                                            layoutpolicy_horizontal = expanding
                                            spacing = 10
                                            coa_title_tiny = {}
                                            text_single = {
                                                name = "name_notheld"
                                                visible = "[Not(GuiHolySiteItem.IsHeldByFaith)]"
                                                layoutpolicy_horizontal = expanding
                                                text = "[HolySite.GetName]"
                                                align = nobaseline
                                                autoresize = no
                                                default_format = "#low"
                                                using = Font_Size_Big
                                                margin_bottom = 5
                                            }
                                            text_single = {
                                                name = "name_held"
                                                visible = "[GuiHolySiteItem.IsHeldByFaith]"
                                                layoutpolicy_horizontal = expanding
                                                text = "[HolySite.GetName]"
                                                align = nobaseline
                                                autoresize = no
                                                default_format = "#high"
                                                using = Font_Size_Big
                                                margin_bottom = 5
                                            }
                                            expand = {}
                                        }
                                        hbox = {
                                            datacontext = "[Title.GetHolder]"
                                            tooltip = "FAITH_HOLY_SITE_HOLDER_TOOLTIP"
                                            background = {
                                                visible = "[Not(GuiHolySiteItem.IsHeldByFaith)]"
                                                using = Status_Bad
                                                margin_top = 3
                                                margin_bottom = -1
                                                alpha = 0.8
                                            }
                                            background = {
                                                visible = "[GuiHolySiteItem.IsHeldByFaith]"
                                                using = Background_Area
                                                margin_top = 3
                                                margin_bottom = -1
                                                alpha = 0.8
                                            }
                                            highlight_icon = {
                                                name = "faith_button"
                                                datacontext = "[Title.GetDeJureLiege.GetHolder.GetFaith]"
                                                size = { 45 45 }
                                                texture = "[Faith.GetIcon]"
                                            }
                                            coa_realm_small = {
                                                visible = "[Title.HasHolder]"
                                                datacontext = "[Title.GetHolder.GetTopLiege]"
                                            }
                                        }
                                        expand = {}
                                    }
                                    vbox = {
                                        layoutpolicy_horizontal = expanding
                                        layoutpolicy_vertical = expanding
                                        margin_top = 10
                                        hbox = {
                                            layoutpolicy_horizontal = expanding
                                            margin_left = 20
                                            vbox = {
                                                layoutpolicy_vertical = expanding
                                                state = {
                                                    name = "faith_view_refresh"
                                                    using = Animation_Refresh_FadeOut
                                                }
                                                state = {
                                                    using = Animation_Refresh_FadeIn
                                                }
                                                text_multi = {
                                                    name = "effects_notheld"
                                                    visible = "[Not(GuiHolySiteItem.IsHeldByFaith)]"
                                                    layoutpolicy_horizontal = expanding
                                                    text = "[HolySite.GetEffectDesc(GuiHolySiteItem.GetFaith)]"
                                                    default_format = "#low"
                                                    format_override = { P low }
                                                    format_override = { L low }
                                                    format_override = { E low }
                                                    format_override = { S low }
                                                    autoresize = yes
                                                    max_width = 315
                                                }
                                                text_multi = {
                                                    name = "effects_held"
                                                    visible = "[GuiHolySiteItem.IsHeldByFaith]"
                                                    layoutpolicy_horizontal = expanding
                                                    text = "[HolySite.GetEffectDesc(GuiHolySiteItem.GetFaith)]"
                                                    autoresize = yes
                                                    max_width = 315
                                                }
                                            }
                                            expand = { layoutpolicy_horizontal = expanding }
                                        }
                                        expand = {}
                                    }
                                    button_go_to_my_location = {
                                        onclick = "[DefaultOnCoatOfArmsRightClick(Title.GetID)]"
                                        tooltip = "GOTO_PROVINCE"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}

### RELIGION WINDOW (Dual Mode) ###

window = {
    name = "religion_window"
    widgetid = "religion_window"
    datacontext = "[ReligionWindow.GetReligion]"
    datacontext = "[GetVariableSystem]"
    layer = top
    
    state = {
        name = "_show"
        using = Animation_FadeIn_Quick
        using = Sound_WindowShow_Standard
        on_start = "[GetVariableSystem.Set('hide_bottom_left_HUD', 'true')]"
    }
    
    state = {
        name = "_hide"
        using = Animation_FadeOut_Quick
        using = Sound_WindowHide_Standard
        on_start = "[GetVariableSystem.Clear('hide_bottom_left_HUD')]"
    }
    
    attachto = {
        widgetid = "faith_window"
        inherit_visibility = no
    }
    
    ### OCR MODE ###
    window_ocr = {
        visible = "[Not(GetVariableSystem.Exists('ocr'))]"
        blockoverride "show_window" {}
        blockoverride "ocr_header" {
            button = {
                using = close_window_ocr
                onclick = "[ReligionWindow.Close]"
            }
            hbox = {
                layoutpolicy_horizontal = expanding
                text_single = {
                    raw_text = "[GetDataModelSize(ReligionWindow.GetFaiths)] [AddTextIf(ReligionWindow.ShowOnlyReligionFaiths, ReligionWindow.GetReligion.GetAdjectiveNoTooltip)][AddTextIf(ReligionWindow.ShowOnlyReligionFaiths, ' ')]faiths."
                }
                expand = {}
            }
            hbox = {
                visible = no
                layoutpolicy_horizontal = expanding
                name = "tabs"
                text_single = {
                    raw_text = "Menus:"
                }
                button_text = {
                    blockoverride "pre" {
                        text_single = { raw_text = "1," }
                    }
                    blockoverride "text" {
                        raw_text = "FAITH_BELIEFS"
                    }
                    blockoverride "dot" {}
                    onclick = "[Set('faith_view_tabs', 'beliefs')]"
                    onclick = "[ReligionWindow.Close]"
                    shortcut = "speed_1"
                }
                button_text = {
                    blockoverride "pre" {
                        text_single = { raw_text = "2," }
                    }
                    blockoverride "text" {
                        raw_text = "FAITH_HOLY_SITES"
                    }
                    blockoverride "dot" {}
                    onclick = "[GetVariableSystem.Set('faith_view_tabs', 'holy sites')]"
                    onclick = "[ReligionWindow.Close]"
                    shortcut = "speed_2"
                }
                button_text = {
                    blockoverride "pre" {
                        text_single = { raw_text = "4," }
                    }
                    blockoverride "text" {
                        raw_text = "Followers."
                    }
                    shortcut = "speed_4"
                    onclick = "[Set('faith_view_tabs', 'followers')]"
                    onclick = "[ReligionWindow.Close]"
                }
                agot_patron_tab_button = {}
                expand = {}
            }
            vbox = {
                layoutpolicy_horizontal = expanding
                spacing = -3
                hbox = {
                    layoutpolicy_horizontal = expanding
                    button_text = {
                        blockoverride "text" {
                            raw_text = "[Select_CString(ReligionWindow.ShowOnlyReligionFaiths, 'Show all existing faiths', 'Show only fiaths of this religion')]."
                        }
                        onclick = "[ReligionWindow.OnShowOnlyReligionFaiths]"
                    }
                    expand = {}
                    using = tooltip_ne
                }
                hbox = {
                    spacing = 0
                    layoutpolicy_horizontal = expanding
                    text_single = {
                        text = "SORT_BY"
                        align = left
                    }
                    dropdown_sort_characterlist = {
                        datamodel = "[ReligionWindow.GetOrderByOptions]"
                        onselectionchanged = "[ReligionWindow.OnOrderBySelectionChanged]"
                        selectedindex = "[ReligionWindow.GetOrderBySelectedIndex]"
                        blockoverride "text_button_drop" {
                            text = "[OrderFaithOption.GetName]"
                        }
                    }
                    expand = {}
                }
            }
        }
        blockoverride "ocr_content" {
            vbox = {
                datamodel = "[ReligionWindow.GetFaiths]"
                layoutpolicy_horizontal = expanding
                item = {
                    button_standard = {
                        name = "show_faith_info"
                        layoutpolicy_horizontal = expanding
                        size = { 0 20 }
                        shortcuts_list = {
                            blockoverride "click" {
                                onclick = "[OpenGameViewData('faith', Faith.GetID)]"
                                onclick = "[ReligionWindow.Close]"
                            }
                        }
                        state = {
                            name = "_mouse_click"
                            on_finish = "[OpenGameViewData('faith', Faith.GetID)]"
                            on_finish = "[ReligionWindow.Close]"
                        }
                        background = {
                            visible = "[Faith.IsSelected]"
                            using = Background_Area
                        }
                        vbox = {
                            layoutpolicy_horizontal = expanding
                            spacing = -2
                            resize_parent = yes
                            hbox = {
                                layoutpolicy_horizontal = expanding
                                layoutpolicy_vertical = expanding
                                text_single = {
                                    raw_text = "[IndexNumber], "
                                }
                                text_single = {
                                    name = "faith_name"
                                    raw_text = "FAITH_COOLTIP_GETNAME"
                                    max_width = 300
                                }
                                dot = {}
                                hbox = {
                                    visible = "[Not(ReligionWindow.ShowOnlyReligionFaiths)]"
                                    space = {}
                                    text_single = {
                                        name = "religion_faith_name"
                                        text = "FAITH_RELIGION"
                                        max_width = 300
                                    }
                                    dot = {}
                                }
                                hbox = {
                                    visible = "[GreaterThan_int32(Faith.GetNumberOfCountiesOfFaith, (int32)0)]"
                                    space = {}
                                    text_single = {
                                        name = "fervor"
                                        text = "FAITH_WINDOW_FERVOR"
                                    }
                                }
                                hbox = {
                                    layoutpolicy_horizontal = expanding
                                    visible = "[EqualTo_int32(Faith.GetNumberOfCountiesOfFaith, (int32)0)]"
                                    spacing = 3
                                    text_single = {
                                        name = "counties"
                                        raw_text = " [Faith.GetNumberOfCountiesOfFaith] counties,"
                                    }
                                    text_single = {
                                        raw_text = "[GuiScope.SetRoot(Faith.MakeScope).ScriptValue('faith_followers')] total followers."
                                    }
                                    expand = {}
                                }
                                expand = {}
                            }
                            hbox = {
                                layoutpolicy_horizontal = expanding
                                spacing = 3
                                visible = "[GreaterThan_int32(Faith.GetNumberOfCountiesOfFaith, (int32)0)]"
                                text_single = {
                                    name = "counties"
                                    raw_text = "[Faith.GetNumberOfCountiesOfFaith] counties,"
                                }
                                text_single = {
                                    raw_text = "[GuiScope.SetRoot(Faith.MakeScope).ScriptValue('faith_rulers')] rulers."
                                    visible = "[GreaterThan_CFixedPoint(GuiScope.SetRoot(Faith.MakeScope).ScriptValue('faith_rulers'), CFixedPoint('0'))]"
                                }
                                text_single = {
                                    raw_text = "[GuiScope.SetRoot(Faith.MakeScope).ScriptValue('faith_followers')] total followers."
                                }
                                expand = {}
                            }
                        }
                    }
                }
            }
        }
    }
    
    ### VANILLA MODE ###
    widget = {
        visible = "[GetVariableSystem.Exists('ocr')]"
        size = { 590 80% }
        position = { 620 75 }
        using = Window_Movable
        using = Window_Background_Subwindow
        vbox = {
            margin = { 4 4 }
            header_pattern = {
                layoutpolicy_horizontal = expanding
                blockoverride "header_text" {
                    text = "RELIGION_WINDOW_TITLE"
                }
                blockoverride "button_close" {
                    onclick = "[ReligionWindow.Close]"
                }
                blockoverride "button_back" {
                    visible = no
                }
            }
            hbox = {
                layoutpolicy_horizontal = expanding
                margin = { 15 0 }
                margin_bottom = 5
                spacing = 5
                hbox = {
                    spacing = 5
                    text_single = {
                        text = "SORT_BY"
                        align = nobaseline
                    }
                    dropdown_sort_characterlist = {
                        datamodel = "[ReligionWindow.GetOrderByOptions]"
                        onselectionchanged = "[ReligionWindow.OnOrderBySelectionChanged]"
                        selectedindex = "[ReligionWindow.GetOrderBySelectedIndex]"
                        blockoverride "text_button_drop" {
                            text = "[OrderFaithOption.GetName]"
                        }
                    }
                }
                expand = {}
                hbox = {
                    layoutpolicy_horizontal = expanding
                    max_width = 550
                    spacing = 5
                    expand = {}
                    button_checkbox_label = {
                        onclick = "[ReligionWindow.OnShowOnlyReligionFaiths]"
                        blockoverride "text" {
                            text = "RELIGION_SHOW_ONLY"
                            max_width = 180
                        }
                        blockoverride "checkbox" {
                            checked = "[ReligionWindow.ShowOnlyReligionFaiths]"
                        }
                    }
                    tooltip = "[ReligionWindow.GetShowOnlyReligionFaithsTooltip]"
                    using = tooltip_ne
                }
            }
            scrollbox = {
                name = "faiths_scroll_area"
                layoutpolicy_horizontal = expanding
                layoutpolicy_vertical = expanding
                blockoverride "scrollbox_content" {
                    vbox = {
                        datamodel = "[ReligionWindow.GetFaiths]"
                        layoutpolicy_horizontal = expanding
                        item = {
                            button_standard_hover = {
                                name = "show_faith_info"
                                layoutpolicy_horizontal = expanding
                                size = { 0 80 }
                                tooltipwidget = { faith_tooltip_click = {} }
                                onclick = "[PdxGuiTriggerAllAnimations('faith_view_refresh')]"
                                using = tooltip_es
                                state = {
                                    name = "_mouse_click"
                                    on_finish = "[OpenGameViewData('faith', Faith.GetID)]"
                                }
                                background = {
                                    visible = "[Faith.IsSelected]"
                                    using = Background_Area
                                }
                                divider_light = {
                                    alpha = "[Select_float(GreaterThan_int32(Faith.GetNumberOfCountiesOfFaith,(int32)0), (float)1.0,(float)0.5)]"
                                    size = { 100% 3 }
                                    parentanchor = bottom
                                    position = { 0 1 }
                                }
                                hbox = {
                                    margin = { 10 5 }
                                    alpha = "[Select_float(GreaterThan_int32(Faith.GetNumberOfCountiesOfFaith,(int32)0), (float)1.0,(float)0.5)]"
                                    icon = {
                                        name = "faith_icon"
                                        texture = "[Faith.GetIcon]"
                                        size = { 60 60 }
                                    }
                                    vbox = {
                                        layoutpolicy_horizontal = expanding
                                        layoutpolicy_vertical = expanding
                                        margin_left = 10
                                        hbox = {
                                            layoutpolicy_horizontal = expanding
                                            layoutpolicy_vertical = expanding
                                            text_single = {
                                                name = "faith_name"
                                                align = left|nobaseline
                                                text = "FAITH_COOLTIP_GETNAME"
                                                using = Font_Size_Medium
                                                default_format = "#high"
                                                max_width = 240
                                            }
                                            expand = {}
                                            text_single = {
                                                min_width = 160
                                                name = "religion_faith_name"
                                                align = right|nobaseline
                                                text = "FAITH_RELIGION"
                                                margin_right = 5
                                            }
                                        }
                                        hbox = {
                                            layoutpolicy_horizontal = expanding
                                            layoutpolicy_vertical = expanding
                                            icon = {
                                                texture = "gfx/interface/icons/icon_fervor.dds"
                                                size = { 22 22 }
                                            }
                                            text_single = {
                                                name = "fervor"
                                                text = "FAITH_WINDOW_FERVOR"
                                                using = Font_Size_Small
                                                align = left|nobaseline
                                            }
                                            expand = {}
                                        }
                                        text_single = {
                                            layoutpolicy_horizontal = expanding
                                            name = "counties"
                                            align = left|nobaseline
                                            text = "FAITH_WINDOW_COUNTIES"
                                            default_format = "#low"
                                            autoresize = no
                                        }
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    }
}