######################################################
################### COUNTY VIEW ######################
######################################################

## DUAL-MODE COUNTY VIEW - COMPLETE RECONSTRUCTION
## Phase 1: ✅ Types Definitions (16 types: 11 OCR + 5 Vanilla)
## Phase 2: ✅ Secondary Windows (holding_tracks_view, holding_type_selection_view)
## Phase 3: ✅ Main Window (holding_view dual-mode) - RECOVERED FROM COMMITS
##   ├─ COMMIT 1/4: ✅ Skeleton and States
##   ├─ COMMIT 2/4: ✅ OCR Widget Content (RECOVERED)
##   ├─ COMMIT 3/4: ✅ Vanilla Widget Header (RECOVERED)
##   ├─ COMMIT 4A/4: ✅ County Info Tab (RECOVERED)
##   ├─ COMMIT 4B/4: ✅ County Stats & Holder (RECOVERED)
##   ├─ COMMIT 4C/4: ⏳ Holdings Navigation (pending - to be added)
##   └─ COMMIT 4D/4: ⏳ Holdings & Buildings (pending - to be added)
## Toggle: GetVariableSystem.Exists('ocr')
## Default: OCR mode (accessible)
## 
## THIS IS A RECOVERY FILE - Created to restore lost code from commits
## Once verified, this should replace window_county_view.gui

######################################################
############### MAIN WINDOW (HOLDING VIEW) ###########
######################################################

window = {
	name = "holding_view"
	widgetid = "holding_view"
	parentanchor = bottom|left
	allow_outside = yes
	movable = no
	layer = windows_layer
	maximumsize = { 700 -1 }
	scissor = yes
	size = { 700 100% }
	
	# DUAL-MODE TOGGLE VARIABLE (MUST BE FIRST)
	datacontext = "[GetVariableSystem]"
	
	# HOLDING VIEW DATA CONTEXTS
	datacontext = "[HoldingView.GetProvince]"
	datacontext = "[HoldingView.GetHolding]"
	datacontext = "[HoldingView.GetHolder]"
	datacontext = "[Province.GetCounty]"
	
	######################################################
	# ANIMATION STATES (COMMON TO BOTH MODES)
	######################################################
	
	state = {
		name = pan_to_previous_county
		delay = 0.1
		on_start = "[HoldingView.PanToCountyCapital]"
		on_finish = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
		on_start = "[GetVariableSystem.Clear( 'window_ruins_confirm' )]"
	}
	
	state = {
		name = _show
		on_start = "[HoldingView.PanToCountyCapital]"
		on_start = "[GetVariableSystem.Set( 'county_view_open', 'true' )]"
		on_start = "[GetVariableSystem.Set( 'hide_bottom_left_HUD', 'true' )]"
		on_finish = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
		on_start = "[GetVariableSystem.Clear( 'window_ruins_confirm' )]"
		
		using = Animation_FadeIn_Standard
		using = Sound_WindowShow_Standard
		using = Animation_FadeIn_BottomLeft
	}
	
	state = {
		name = adjacent_counties
		trigger_on_create = yes
		on_finish = "[Click('reset_lootable_sort')]"
		on_finish = "[GetScriptedGui('province_adjacencies').Execute( GuiScope.SetRoot( Province.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).End )]"
		on_finish = "[PdxGuiTriggerAllAnimations('adjacent_counties_land')]"
	}
	
	state = {
		name = _hide
		on_start = "[GetVariableSystem.Clear( 'county_view_open' )]"
		on_start = "[GetVariableSystem.Clear( 'hide_bottom_left_HUD' )]"
		on_finish = "[Clear('county_tabs')]"
		on_finish = "[Clear('holding_tabs')]"
		on_finish = "[Clear('ocr_section')]"
		on_finish = "[ClickAdd('last_view', GetPlayer, Province)]"
		on_finish = "[Clear('hide_grant_titles')]"
		
		using = Animation_FadeOut_Standard
		using = Sound_WindowHide_Standard
		using = Animation_FadeOut_BottomLeft
	}
	
	######################################################
	# WINDOW CONTROL BUTTONS (ACCESSIBILITY)
	# Common to both OCR and Vanilla modes
	######################################################
	
	widget = {
		size = { 0 0 }
		scissor = yes

		buttons_window_control = {
			blockoverride "button_go_to" {
				onclick = "[HoldingView.PanToCountyCapital]"
				tooltip = "Go to county capital"
			}

			blockoverride "button_back" {
				visible = "[HasViewHistory]"
				onclick = "[OpenFromViewHistory]"
				onclick = "[PdxGuiTriggerAllAnimations('pan_to_previous_county')]"
				tooltip = "Return to previous view"
			}
			
			blockoverride "button_close" {
				onclick = "[HoldingView.Close]"
				tooltip = "Close county view"
			}
		}
	}
	
	######################################################
	# WIDGET OCR (ACCESSIBLE MODE - DEFAULT)
	# Visible when: Not(GetVariableSystem.Exists('ocr'))
	# RECOVERED FROM COMMIT 2/4
	######################################################

	widget = {
		name = "ocr_holding_view"
		visible = "[Not(GetVariableSystem.Exists('ocr'))]"
		size = { 605 750 }
		parentanchor = bottom|left
		alwaystransparent = yes
		
		# Initialize default section on show (clear first to avoid stale state)
		state = {
			name = _show
			on_start = "[GetVariableSystem.Clear('ocr_section')]"
			on_start = "[GetVariableSystem.Set('ocr_section', 'overview')]"
		}
		
		vbox = {
			expand = {}
			ignoreinvisible = yes
			layoutpolicy_vertical = expanding
			
			vbox = {
				name = "window_content_ocr"
				margin_right = 40
				margin_top = 35
				margin_left = 20
				margin_bottom = 20
				alwaystransparent = no
				spacing = 10
				
				datacontext = "[HoldingView.GetHolding]"
				datacontext = "[HoldingView.GetProvince]"
				datacontext = "[HoldingView.GetHolder]"
				datacontext = "[Province.GetCounty]"
				
				### BACKGROUND ###
				background = {
					texture = "gfx/interface/component/tiles/tile_window_background_subwindow.dds"
					spritetype = Corneredtiled
					spriteborder = { 18 18 }
					margin = { -23 -17 }
					margin_left = 20
					margin_bottom = 20
					texture_density = 2

					modify_texture = {
						name = "overlay"
						texture = "gfx/interface/component/overlay/overlay_effect.dds"
						spritetype = Corneredstretched
						spriteborder = { 0 0 }
						blendmode = overlay
					}
				}
				
				### ERROR BUTTON (ACCESSIBILITY) ###
				error_button = {
					layoutpolicy_horizontal = expanding
				}
				
				### HEADER SECTION ###
				vbox = {
					name = "ocr_header"
					layoutpolicy_horizontal = expanding
					spacing = 5
					
					# Main title with full hierarchy
					hbox = {
						layoutpolicy_horizontal = expanding
						spacing = 3
						
						text_single = {
							raw_text = "[HoldingView.GetProvince.GetTitle.GetNameNoTier],"
							using = Font_Size_Medium
						}
						text_single = {
							raw_text = "[HoldingView.GetCountyTitle.GetNameNoTier],"
							using = Font_Size_Medium
						}
						text_single = {
							raw_text = "held by [HoldingView.GetTopLiege.GetPrimaryTitle.GetNameNoTierNoTooltip]."
							using = Font_Size_Small
						}
					}
					
					# De jure hierarchy
					hbox = {
						layoutpolicy_horizontal = expanding
						spacing = 3
						margin_left = 3
						
						text_single = {
							raw_text = "De jure"
							using = Font_Size_Small
						}
						text_single = {
							raw_text = "[HoldingView.GetCountyTitle.GetDeJureLiege.GetNameNoTierNoTooltip],"
							using = Font_Size_Small
						}
						text_single = {
							raw_text = "[HoldingView.GetCountyTitle.GetDeJureLiege.GetDeJureLiege.GetNameNoTierNoTooltip]."
							using = Font_Size_Small
						}
					}
					
					# Coordinates
					hbox = {
						layoutpolicy_horizontal = expanding
						spacing = 3
						
						text_single = {
							raw_text = "Position X Y:"
							using = Font_Size_Small
						}
						text_single = {
							raw_text = "[FixedPointToInt(Divide_CFixedPoint(County.GetCapital.MakeScope.Var('pos_x').GetValue, '(CFixedPoint)100'))|0],"
							using = Font_Size_Small
						}
						text_single = {
							raw_text = "[FixedPointToInt(Divide_CFixedPoint(County.GetCapital.MakeScope.Var('pos_y').GetValue, '(CFixedPoint)100'))|0]."
							using = Font_Size_Small
						}
					}
					
					# Holding type and terrain info
					hbox = {
						layoutpolicy_horizontal = expanding
						spacing = 3
						
						# Capital indicator
						container = {
							ignoreinvisible = yes
							visible = "[ObjectsEqual(HoldingView.GetProvince, GetPlayer.GetCapitalLocation)]"
							
							text_single = {
								visible = "[Not( GetPlayer.IsLandlessRuler )]"
								raw_text = "Your Capital,"
								using = Font_Size_Small
								default_format = "#high"
							}
						}
						
						# Your holding indicator
						text_single = {
							raw_text = "Your"
							visible = "[And(And(HoldingView.GetTitle.GetLesseeOrHolder.IsLocalPlayer, Not( ObjectsEqual( HoldingView.GetProvince, GetPlayer.GetCapitalLocation ) ) ), Not(GetPlayer.IsLandlessRuler))]"
							using = Font_Size_Small
							default_format = "#high"
						}
						
						# Hostile indicator
						text_single = {
							raw_text = "Hostile"
							visible = "[GetScriptedGui('is_hostile_barony').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope( 'target', Province.MakeScope ).End )]"
							using = Font_Size_Small
							default_format = "#weak"
						}
						
						# Border indicator
						text_single = {
							raw_text = "border"
							visible = "[GetScriptedGui('is_border_province').IsShown( GuiScope.SetRoot( Province.MakeScope ).End )]"
							using = Font_Size_Small
						}
						
						# Terrain/Holding type
						text_single = {
							visible = "[HoldingView.GetHolding.IsEmpty]"
							raw_text = "[HoldingView.GetProvince.GetTerrain.GetNameNoTooltip] of"
							using = Font_Size_Small
						}
						text_single = {
							visible = "[Not(HoldingView.GetHolding.IsEmpty)]"
							raw_text = "[HoldingView.GetHolding.GetType.GetName] of"
							using = Font_Size_Small
						}
						
						# Province/Holding name
						text_single = {
							visible = "[Not(HoldingView.GetProvince.GetTitle.IsValid)]"
							raw_text = "[HoldingView.GetHolding.GetNameNoTooltip]"
							using = Font_Size_Small
						}
						text_single = {
							visible = "[HoldingView.GetProvince.GetTitle.IsValid]"
							raw_text = "[HoldingView.GetProvince.GetTitle.GetNameNoTier]"
							using = Font_Size_Small
						}
					}
					
					# Holder information
					text_label_left = {
						name = "header_holder_info"
						text = "HOLDING_VIEW_RULER_INFO"
						using = Font_Size_Small
						layoutpolicy_horizontal = expanding
					}
				}

				divider_light = {
					layoutpolicy_horizontal = expanding
					margin_top = 5
				}
				
				### LAND PROVINCE CONTENT (SCRIPTED GUI INTEGRATION) ###
				vbox = {
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					visible = "[GetScriptedGui('is_land').IsShown( GuiScope.SetRoot( Province.MakeScope ).End )]"
					
					# Scripted GUI state triggers for dynamic data
					state = {
						name = "adjacent_counties_land"
						on_finish = "[GetScriptedGui('adjacent_counties').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).AddScope('target', HoldingView.GetProvince.MakeScope).End )]"
						on_finish = "[GetScriptedGui('county_holding_list').Execute( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).End )]"
						on_finish = "[GetScriptedGui('find_closest').Execute( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target', HoldingView.GetProvince.MakeScope).End )]"
					}

				divider_light = {
					layoutpolicy_horizontal = expanding
					margin_top = 5
				}

				### SINGLE-FLOW SCROLLABLE CONTENT (OCR SUPPORT STYLE) ###
				scrollbox = {
					name = "ocr_content"
					layoutpolicy_horizontal = expanding
					layoutpolicy_vertical = expanding
					size = { 0 600 }
					
					blockoverride "scrollbox_content" {
						vbox = {
							layoutpolicy_horizontal = expanding
							spacing = 3
							margin = { 5 5 }

							######################################
							# SECTION: OVERVIEW (Press E)
							######################################
							
							# Summary row - always visible
							button_standard = {
								name = "overview_summary"
								layoutpolicy_horizontal = expanding
								size = { 0 30 }
								onclick = "[GetVariableSystem.Set('ocr_section', 'overview')]"
								shortcut = "map_mode_1"
								
								hbox = {
									layoutpolicy_horizontal = expanding
									spacing = 5
									margin = { 8 5 }
									
									text_single = {
										raw_text = "Overview (E):"
										using = Font_Size_Small
										default_format = "#high"
									}
									
									text_single = {
										raw_text = "[HoldingView.GetCountyTitle.GetNameNoTier]"
										using = Font_Size_Small
									}
									
									expand = {}
								}
							}
							
							# Detail block - visible when section is expanded
							vbox = {
								name = "overview_details"
								visible = "[GetVariableSystem.HasValue('ocr_section', 'overview')]"
								spacing = 5
								layoutpolicy_horizontal = expanding
								margin_left = 10
								margin_bottom = 8
								
								# Infection Status (if applicable)
								hbox = {
									visible = "[GetScriptedGui('is_province_infected').IsShown( GuiScope.SetRoot( Province.MakeScope ).End )]"
									layoutpolicy_horizontal = expanding
									spacing = 5
									
									text_single = {
										raw_text = "WARNING: Infected province!"
										using = Font_Size_Small
										default_format = "#weak"
									}
								}
								
								# Terrain Information
								hbox = {
									visible = "[Not(HoldingView.GetHolding.IsEmpty)]"
									layoutpolicy_horizontal = expanding
									spacing = 3
									
									text_single = {
										raw_text = "Terrain:"
										using = Font_Size_Small
									}
									text_single = {
										datacontext = "[HoldingView.GetProvince]"
										raw_text = "[Province.GetTerrain.GetName]"
										using = Font_Size_Small
									}
								}
								
								# Distance from Capital
								hbox = {
									datacontext = "[HoldingView.GetProvince]"
									visible = "[Not(ObjectsEqual(HoldingView.GetProvince, GetPlayer.GetCapitalLocation))]"
									layoutpolicy_horizontal = expanding
									spacing = 3
									
									text_single = {
										raw_text = "From your capital:"
										using = Font_Size_Small
									}
									text_single = {
										raw_text = "[DistanceTo(MyCapital, Province)|0] distance,"
										using = Font_Size_Small
									}
									text_single = {
										raw_text = "[DaysTo(MyCapital, Province)] days,"
										using = Font_Size_Small
									}
									text_single = {
										raw_text = "[Direction(MyCapital, Province)]"
										using = Font_Size_Small
									}
								}
								
								# River/Sea Crossings
								hbox = {
									visible = "[DataModelHasItems(Province.MakeScope.GetList('sea_crossings'))]"
									layoutpolicy_horizontal = expanding
									spacing = 3
									
									text_single = {
										raw_text = "Strait crossing present"
										using = Font_Size_Small
									}
								}
								
								hbox = {
									visible = "[DataModelHasItems(Province.MakeScope.GetList('river_large_crossings'))]"
									layoutpolicy_horizontal = expanding
									spacing = 3
									
									text_single = {
										raw_text = "Major river crossing"
										using = Font_Size_Small
									}
								}
								
								hbox = {
									visible = "[DataModelHasItems(Province.MakeScope.GetList('river_crossings'))]"
									layoutpolicy_horizontal = expanding
									spacing = 3
									
									text_single = {
										raw_text = "River crossing"
										using = Font_Size_Small
									}
								}
								
								# Shores indicator
								hbox = {
									visible = "[DataModelHasItems(Province.MakeScope.GetList('adjacent_rivers'))]"
									layoutpolicy_horizontal = expanding
									spacing = 3
									
									text_single = {
										raw_text = "Adjacent to river"
										using = Font_Size_Small
									}
								}
								
								divider_light = {
									layoutpolicy_horizontal = expanding
									margin_top = 5
									margin_bottom = 5
								}
								
								# County Name
								text_label_left = {
									text = "HOLDING_VIEW_COUNTY_NAME"
									layoutpolicy_horizontal = expanding
									using = Font_Size_Small
								}
								
								# Holder Information
								text_label_left = {
									datacontext = "[HoldingView.GetCountyTitle.GetHolder]"
									text = "HOLDING_VIEW_HOLDER_INFO"
									layoutpolicy_horizontal = expanding
									using = Font_Size_Small
								}
								
								# Culture
								text_label_left = {
									text = "HOLDING_VIEW_CULTURE"
									layoutpolicy_horizontal = expanding
									using = Font_Size_Small
								}
								
								# Religion
								text_label_left = {
									text = "HOLDING_VIEW_FAITH"
									layoutpolicy_horizontal = expanding
									using = Font_Size_Small
								}
								
								# Development Level
								text_label_left = {
									text = "COUNTY_DEVELOPMENT"
									layoutpolicy_horizontal = expanding
									using = Font_Size_Small
								}
								
								# De Jure Hierarchy
								text_label_left = {
									datacontext = "[HoldingView.GetCountyTitle]"
									text = "HOLDING_VIEW_DE_JURE_HIERARCHY"
									layoutpolicy_horizontal = expanding
									using = Font_Size_Small
								}
								
								# County Status Indicators
								hbox = {
									layoutpolicy_horizontal = expanding
									spacing = 3
									
									text_single = {
										raw_text = "Your county"
										visible = "[And(HoldingView.GetCountyTitle.GetHolder.IsLocalPlayer, Not(HoldingView.GetTitle.GetLesseeOrHolder.IsLocalPlayer))]"
										using = Font_Size_Small
										default_format = "#high"
									}
									
									text_single = {
										raw_text = "Hostile county"
										visible = "[GetScriptedGui('is_hostile_county').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope( 'target', Province.MakeScope ).End )]"
										using = Font_Size_Small
										default_format = "#weak"
									}
									
									text_single = {
										raw_text = "Border county"
										visible = "[GetScriptedGui('is_border_county').IsShown( GuiScope.SetRoot( HoldingView.GetCountyTitle.MakeScope ).End )]"
										using = Font_Size_Small
									}
									
									text_single = {
										raw_text = "Capital county"
										visible = "[And(And(ObjectsEqual(HoldingView.GetCountyTitle, GetPlayer.GetCapitalLocation.GetCoATitle), Not( ObjectsEqual( HoldingView.GetProvince, GetPlayer.GetCapitalLocation ) ) ), Not(GetPlayer.IsLandlessRuler))]"
										using = Font_Size_Small
										default_format = "#high"
									}
								}
							}
							
							} # End overview_details vbox

							######################################
							# SECTION: HOLDINGS (Press H)
							######################################
							
							# Summary row - always visible  
							button_standard = {
								name = "holdings_summary"
								layoutpolicy_horizontal = expanding
								size = { 0 30 }
								onclick = "[GetVariableSystem.Set('ocr_section', 'holdings')]"
								shortcut = "map_mode_2"
								
								hbox = {
									layoutpolicy_horizontal = expanding
									spacing = 5
									margin = { 8 5 }
									
									text_single = {
										raw_text = "Holdings (H):"
										using = Font_Size_Small
										default_format = "#high"
									}
									
									text_single = {
										raw_text = "[GetDataModelSize(County.GetProvinces)] baronies"
										using = Font_Size_Small
									}
									
									expand = {}
								}
							}
							
							# Detail block - visible when section is expanded
							vbox = {
								name = "holdings_details"
								visible = "[GetVariableSystem.HasValue('ocr_section', 'holdings')]"
								spacing = 5
								layoutpolicy_horizontal = expanding
								margin_left = 10
								margin_bottom = 8
								
								# Stats section (control, development, modifiers)
								vbox = {
									name = "county_stats"
									spacing = 5
									layoutpolicy_horizontal = expanding
								
								# Control Level
								text_label_left = {
									text = "COUNTY_CONTROL_LABEL"
									layoutpolicy_horizontal = expanding
									using = Font_Size_Small
								}
								
								widget = {
									size = { 100% 25 }
									
									progressbar_standard = {
										name = "control_bar"
										size = { 100% 100% }
										
										blockoverride "values" {
											value = "[County.GetControl]"
											min = 0
											max = 1
										}
										
										text_single = {
											parentanchor = center
											text = "[Multiply_CFixedPoint(County.GetControl, '(CFixedPoint)100')|0]%"
											using = Font_Size_Small
											default_format = "#high"
										}
									}
								}
								
								# Development
								text_label_left = {
									text = "COUNTY_DEVELOPMENT_LABEL"
									layoutpolicy_horizontal = expanding
									using = Font_Size_Small
								}
								
								widget = {
									size = { 100% 25 }
									
									progressbar_standard = {
										name = "development_bar"
										size = { 100% 100% }
										
										blockoverride "values" {
											value = "[County.GetDevelopmentLevel]"
											min = 0
											max = 100
										}
										
										text_single = {
											parentanchor = center
											text = "[County.GetDevelopmentLevel|0]"
											using = Font_Size_Small
											default_format = "#high"
										}
									}
								}
								
								# Income
								text_label_left = {
									text = "HOLDING_VIEW_TAX_INCOME"
									layoutpolicy_horizontal = expanding
									using = Font_Size_Small
								}
								
								divider_light = {
									layoutpolicy_horizontal = expanding
									margin_top = 10
									margin_bottom = 5
								}
								
								# County Modifiers Section
								vbox = {
									visible = "[Not( IsDataModelEmpty(HoldingView.GetCountyModifiers))]"
									layoutpolicy_horizontal = expanding
									spacing = 5
									
									text_single = {
										layoutpolicy_horizontal = expanding
										raw_text = "[GetDataModelSize(HoldingView.GetCountyModifiers)] County modifiers:"
										using = Font_Size_Small
										default_format = "#high"
									}
									
									vbox = {
										datamodel = "[HoldingView.GetCountyModifiers]"
										layoutpolicy_horizontal = expanding
										spacing = 3
										
										item = {
											hbox = {
												layoutpolicy_horizontal = expanding
												spacing = 5
												margin_left = 10
												
												icon = {
													size = { 20 20 }
													texture = "[Modifier.GetIcon]"
												}
												
												text_single = {
													text = "[Modifier.GetNameNoTooltip]"
													layoutpolicy_horizontal = expanding
													using = Font_Size_Small
													align = left
												}
											}
										}
									}
								}
								
								# Province Modifiers
								vbox = {
									visible = "[Not( IsDataModelEmpty(HoldingView.GetProvinceModifiers))]"
									layoutpolicy_horizontal = expanding
									spacing = 5
									margin_top = 5
									
									text_single = {
										layoutpolicy_horizontal = expanding
										raw_text = "[GetDataModelSize(HoldingView.GetProvinceModifiers)] Province modifiers:"
										using = Font_Size_Small
										default_format = "#high"
									}
									
									vbox = {
										datamodel = "[HoldingView.GetProvinceModifiers]"
										layoutpolicy_horizontal = expanding
										spacing = 3
										
										item = {
											hbox = {
												layoutpolicy_horizontal = expanding
												spacing = 5
												margin_left = 10
												
												icon = {
													size = { 20 20 }
													texture = "[Modifier.GetIcon]"
												}
												
												text_single = {
													text = "[Modifier.GetNameNoTooltip]"
													layoutpolicy_horizontal = expanding
													using = Font_Size_Small
													align = left
												}
											}
										}
									}
								}
							}
							
							} # End county_stats vbox (was stats tab)
							
							divider_light = {
								layoutpolicy_horizontal = expanding
								margin_top = 5
								margin_bottom = 5
							}
							
							# Holdings List Header
							text_single = {
								raw_text = "Baronies in county:"
								using = Font_Size_Small
								default_format = "#high"
								layoutpolicy_horizontal = expanding
							}
							
							# Holdings List with detailed information
							vbox = {
								datacontext = "[HoldingView.GetCountyTitle]"
								datamodel = "[County.GetProvinces]"
								layoutpolicy_horizontal = expanding
								spacing = 5
									
									item = {
										vbox = {
											layoutpolicy_horizontal = expanding
											spacing = 3
											
											# Main holding button
											button_standard = {
												name = "holding_item"
												datacontext = "[Province.GetHolding]"
												layoutpolicy_horizontal = expanding
												size = { 0 40 }
												onclick = "[OpenGameViewData('holding_view', Province.Self)]"
												tooltip = "HOLDING_ITEM_TOOLTIP"
												
												hbox = {
													layoutpolicy_horizontal = expanding
													spacing = 10
													margin = { 10 5 }
													
													icon = {
														size = { 30 30 }
														texture = "[Select_CString(Holding.IsEmpty, 'gfx/interface/icons/holding_types/empty_holding.dds', Holding.GetPrimaryBuildingType.GetTypeIcon)]"
													}
													
													vbox = {
														layoutpolicy_horizontal = expanding
														spacing = 2
														
														# Holding name with status
														hbox = {
															layoutpolicy_horizontal = expanding
															spacing = 3
															
															text_single = {
																text = "[Holding.GetNameNoTooltip]"
																using = Font_Size_Small
																align = left
															}
															
															text_single = {
																visible = "[Holding.IsEmpty]"
																raw_text = "(Empty slot)"
																using = Font_Size_Small
																default_format = "#weak"
															}
														}
														
														# Holder info
														text_single = {
															datacontext = "[Province.GetTitle]"
															datacontext = "[Title.GetLesseeOrHolder]"
															visible = "[And(Not(Character.IsLocalPlayer), Not(Holding.IsEmpty))]"
															raw_text = "Held by [Character.GetFirstNameNoTooltip]"
															using = Font_Size_Small
															default_format = "#weak"
															align = left
														}
													}
												}
											}
											
											# Additional holding details
											hbox = {
												layoutpolicy_horizontal = expanding
												spacing = 5
												margin_left = 45
												
												# Terrain type
												text_single = {
													visible = "[Not(Holding.IsEmpty)]"
													raw_text = "[Province.GetTerrain.GetName]"
													using = Font_Size_Small
													default_format = "#weak"
												}
												
												# Building count
												text_single = {
													visible = "[Not(Holding.IsEmpty)]"
													raw_text = "• Buildings: [Holding.GetBuildingCount]"
													using = Font_Size_Small
													default_format = "#weak"
												}
											}
										}
									}
								}
							}
							
							} # End holdings_details vbox

							######################################
							# SECTION: BUILDINGS (Press B)
							######################################
							
							# Summary row - always visible
							button_standard = {
								name = "buildings_summary"
								layoutpolicy_horizontal = expanding
								size = { 0 30 }
								onclick = "[GetVariableSystem.Set('ocr_section', 'buildings')]"
								shortcut = "map_mode_3"
								
								hbox = {
									layoutpolicy_horizontal = expanding
									spacing = 5
									margin = { 8 5 }
									
									text_single = {
										raw_text = "Buildings (B):"
										using = Font_Size_Small
										default_format = "#high"
									}
									
									text_single = {
										raw_text = "[GetDataModelSize(HoldingView.GetBuildings)] total"
										using = Font_Size_Small
									}
									
									expand = {}
								}
							}
							
							# Detail block - visible when section is expanded
							vbox = {
								name = "buildings_details"
								visible = "[GetVariableSystem.HasValue('ocr_section', 'buildings')]"
								spacing = 5
								layoutpolicy_horizontal = expanding
								margin_left = 10
								margin_bottom = 8
								
								# Buildings List
								vbox = {
									datamodel = "[HoldingView.GetBuildings]"
									layoutpolicy_horizontal = expanding
									spacing = 3
									
									item = {
										button_standard = {
											visible = "[GUIBuildingItem.HasLevel]"
											layoutpolicy_horizontal = expanding
											size = { 0 35 }
											onclick = "[GUIBuildingItem.OnClick]"
											tooltip = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetNameNoTooltip]"
											
											hbox = {
												layoutpolicy_horizontal = expanding
												spacing = 10
												margin = { 5 3 }
												
												icon = {
													size = { 25 25 }
													texture = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetTypeIcon]"
												}
												
												text_single = {
													text = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetNameNoTooltip]"
													layoutpolicy_horizontal = expanding
													using = Font_Size_Small
													align = left
												}
												
												text_single = {
													text = "Lv [GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetLevel]"
													using = Font_Size_Small
												}
												
												expand = {}
											}
										}
									}
								}
							}
							
							} # End buildings_details vbox

							######################################
							# SECTION: BUILDABLE (Press U - "Upgrades/Unbuild")
							######################################
							
							# Summary row - always visible
			button_standard = {
								name = "buildable_summary"
								layoutpolicy_horizontal = expanding
								size = { 0 30 }
								onclick = "[GetVariableSystem.Set('ocr_section', 'buildable')]"
								shortcut = "map_mode_7"
								
								hbox = {
									layoutpolicy_horizontal = expanding
									spacing = 5
									margin = { 8 5 }
									
									text_single = {
										raw_text = "Buildable (U):"
										using = Font_Size_Small
										default_format = "#high"
									}
									
									text_single = {
										raw_text = "[GetDataModelSize(HoldingView.GetAvailableBuildings)] available"
										using = Font_Size_Small
									}
									
									expand = {}
								}
							}
							
							# Detail block - visible when section is expanded
							vbox = {
								name = "buildable_details"
								visible = "[GetVariableSystem.HasValue('ocr_section', 'buildable')]"
								spacing = 5
								layoutpolicy_horizontal = expanding
								margin_left = 10
								margin_bottom = 8
								
								# Buildable Buildings List
								vbox = {
									datamodel = "[HoldingView.GetAvailableBuildings]"
									layoutpolicy_horizontal = expanding
									spacing = 3
									
									item = {
										button_standard = {
											layoutpolicy_horizontal = expanding
											size = { 0 35 }
											onclick = "[GUIPotentialBuildingItem.ShowDetails]"
											tooltip = "[GUIPotentialBuildingItem.GetBuilding.GetNameNoTooltip]"
											
											hbox = {
												layoutpolicy_horizontal = expanding
												spacing = 10
												margin = { 5 3 }
												
												icon = {
													size = { 25 25 }
													texture = "[GUIPotentialBuildingItem.GetBuilding.GetTypeIcon]"
												}
												
												text_single = {
													text = "[GUIPotentialBuildingItem.GetBuilding.GetNameNoTooltip]"
													layoutpolicy_horizontal = expanding
													using = Font_Size_Small
													align = left
												}
												
												text_single = {
													visible = "[GUIPotentialBuildingItem.CanConstruct]"
													raw_text = "Can build"
													using = Font_Size_Small
													default_format = "#high"
												}
												
												text_single = {
													visible = "[Not(GUIPotentialBuildingItem.CanConstruct)]"
													raw_text = "Cannot build"
													using = Font_Size_Small
													default_format = "#weak"
												}
												
												expand = {}
											}
										}
									}
								}
							}
							
							} # End buildable_details vbox

							######################################
							# SECTION: ADJACENT (Press A)
							######################################
							
							# Summary row - always visible
							button_standard = {
								name = "adjacent_summary"
								layoutpolicy_horizontal = expanding
								size = { 0 30 }
								onclick = "[GetVariableSystem.Set('ocr_section', 'adjacent')]"
								shortcut = "map_mode_4"
								
								hbox = {
									layoutpolicy_horizontal = expanding
									spacing = 5
									margin = { 8 5 }
									
									text_single = {
										raw_text = "Adjacent (A):"
										using = Font_Size_Small
										default_format = "#high"
									}
									
									text_single = {
										datacontext = "[HoldingView.GetCountyTitle]"
										raw_text = "[GetDataModelSize(Title.GetAdjacentCounties)] counties"
										using = Font_Size_Small
									}
									
									expand = {}
								}
							}
							
							# Detail block - visible when section is expanded
							vbox = {
								name = "adjacent_details"
								visible = "[GetVariableSystem.HasValue('ocr_section', 'adjacent')]"
								spacing = 5
								layoutpolicy_horizontal = expanding
								margin_left = 10
								margin_bottom = 8
								
								# Adjacent Counties List
								vbox = {
									datacontext = "[HoldingView.GetCountyTitle]"
									datamodel = "[Title.GetAdjacentCounties]"
									layoutpolicy_horizontal = expanding
									spacing = 3
									
									item = {
										button_standard = {
											name = "adjacent_county_item"
											layoutpolicy_horizontal = expanding
											size = { 0 40 }
											onclick = "[OpenGameViewData('holding_view', Title.GetProvince.Self)]"
											tooltip = "ADJACENT_COUNTY_TOOLTIP"
											
											hbox = {
												layoutpolicy_horizontal = expanding
												spacing = 10
												margin = { 10 5 }
												
												coa_title_tiny = {
													datacontext = "[Title]"
												}
												
												text_single = {
													text = "[Title.GetNameNoTooltip]"
													layoutpolicy_horizontal = expanding
													using = Font_Size_Small
													align = left
												}
												
												text_single = {
													datacontext = "[Title.GetHolder]"
													text = "[Character.GetShortUINameNoTooltip]"
													using = Font_Size_Small
													default_format = "#weak"
												}
											}
										}
									}
								}
							}
							
							} # End adjacent_details vbox
							
							######################################
							# SECTION: TASKS (Press T)
							######################################
							
							# Summary row - always visible
							button_standard = {
								name = "tasks_summary"
								layoutpolicy_horizontal = expanding
								size = { 0 30 }
								onclick = "[GetVariableSystem.Set('ocr_section', 'tasks')]"
								shortcut = "map_mode_5"
								
								hbox = {
									layoutpolicy_horizontal = expanding
									spacing = 5
									margin = { 8 5 }
									
									text_single = {
										raw_text = "Tasks (T):"
										using = Font_Size_Small
										default_format = "#high"
									}
									
									text_single = {
										raw_text = "Councillor tasks"
										using = Font_Size_Small
									}
									
									expand = {}
								}
							}
							
							# Detail block - visible when section is expanded
							vbox = {
								name = "tasks_details"
								visible = "[GetVariableSystem.HasValue('ocr_section', 'tasks')]"
								spacing = 5
								layoutpolicy_horizontal = expanding
								margin_left = 10
								margin_bottom = 8
								
								hbox = {
									layoutpolicy_horizontal = expanding
									spacing = 3
									margin = { 5 3 }
									
									text_single = {
										raw_text = "Active council tasks:"
										using = Font_Size_Small
										default_format = "#high"
									}
								}
								
								text_single = {
									raw_text = "No tasks available for this holding"
									using = Font_Size_Small
									margin = { 5 3 }
								}
							}
							
							} # End tasks_details vbox
							
							######################################
							# SECTION: ACTIONS (Press G)
							######################################
							
							# Summary row - always visible
							button_standard = {
								name = "actions_summary"
								layoutpolicy_horizontal = expanding
								size = { 0 30 }
								onclick = "[GetVariableSystem.Set('ocr_section', 'actions')]"
								shortcut = "map_mode_6"
								
								hbox = {
									layoutpolicy_horizontal = expanding
									spacing = 5
									margin = { 8 5 }
									
									text_single = {
										raw_text = "Actions (G):"
										using = Font_Size_Small
										default_format = "#high"
									}
									
									text_single = {
										raw_text = "Grant Convert Demolish"
										using = Font_Size_Small
									}
									
									expand = {}
								}
							}
							
							# Detail block - visible when section is expanded
							vbox = {
								name = "actions_details"
								visible = "[GetVariableSystem.HasValue('ocr_section', 'actions')]"
								spacing = 5
								layoutpolicy_horizontal = expanding
								margin_left = 10
								margin_bottom = 8
								
								text_single = {
									raw_text = "Available actions:"
									using = Font_Size_Small
									default_format = "#high"
									margin = { 5 3 }
								}
								
								text_single = {
									raw_text = "Grant title, Convert holdings, Demolish buildings"
									using = Font_Size_Small
									margin = { 5 3 }
								}
							}
							
							} # End actions_details vbox
							
						} # End main content vbox
					} # End scrollbox_content blockoverride
				} # End scrollbox
				
				} # End land province vbox with scripted GUI integration
				
				### BOTTOM SPACER ###
				expand = {
					minimumsize = { 0 10 }
				}
			}
		}
	}





	######################################################
	# WIDGET VANILLA (GRAPHICAL MODE - Shift+F11)
	# Visible when: GetVariableSystem.Exists('ocr')
	# RECOVERED FROM COMMITS 3/4, 4A/4, 4B/4
	######################################################
	
	widget = {
		name = "vanilla_holding_view"
		visible = "[GetVariableSystem.Exists('ocr')]"
		size = { 605 750 }
		parentanchor = bottom|left
		alwaystransparent = yes
		
		vbox = {
			expand = {}
			ignoreinvisible = yes
			layoutpolicy_vertical = expanding
			
			vbox = {
				name = "window_content"
				margin_right = 40
				margin_top = 35
				alwaystransparent = no
				
				datacontext = "[HoldingView.GetHolding]"
				datacontext = "[HoldingView.GetProvince]"
				datacontext = "[HoldingView.GetHolder]"
				datacontext = "[Province.GetCounty]"
				
				### WINDOW BACKGROUND ###
				background = {
					texture = "gfx/interface/component/tiles/tile_window_background_subwindow.dds"
					spritetype = Corneredtiled
					spriteborder = { 18 18 }
					margin = { -23 -17 }
					margin_left = 20
					margin_bottom = 20
					texture_density = 2

					modify_texture = {
						name = "overlay"
						texture = "gfx/interface/component/overlay/overlay_effect.dds"
						spritetype = Corneredstretched
						spriteborder = { 0 0 }
						blendmode = overlay
					}
				}
				
				##################################################
				### COMMIT 3/4: COUNTY HEADER SECTION ###
				##################################################
				
				hbox = {
					name = "county_header"
					layoutpolicy_horizontal = expanding
					margin_right = 15
					margin_left = 5
					margin_top = 5
					margin_bottom = 5
					spacing = 10
					
					background = {
						using = Background_Area_Dark
						margin_left = 5
					}
					
					coa_title_small = {
						datacontext = "[HoldingView.GetCountyTitle]"
					}
					
					vbox = {
						layoutpolicy_horizontal = expanding
						
						hbox = {
							layoutpolicy_horizontal = expanding
							ignoreinvisible = yes
							spacing = 5
							
							text_single = {
								text = "[HoldingView.GetCountyTitle.GetNameNoTooltipU]"
								using = Font_Size_Big
								font = TitleFont
								maxwidth = 380
								fontsize_min = 16
							}
							
							button_edit_text = {
								visible = "[HoldingView.GetCountyTitle.CanPlayerCustomizeTitle]"
								onclick = "[OpenTitleCustomizationWindow(HoldingView.GetCountyTitle)]"
								tooltip = "CUSTOMIZE_TITLE"
							}
							
							expand = {}
						}
						
						vbox = {
							datacontext = "[HoldingView.GetCountyTitle.GetHolder]"
							layoutpolicy_horizontal = expanding
							
							text_single = {
								name = "your_county"
								visible = "[ObjectsEqual( Character.Self, GetPlayer )]"
								layoutpolicy_horizontal = expanding
								text = "HOLDING_VIEW_YOUR_COUNTY"
								margin_bottom = 5
								using = Font_Size_Small
								fontsize_min = 10
								maxwidth = 420
							}
							
							text_single = {
								name = "top_realm_county"
								visible = "[Character.IsOtherLiegeOrAbove( GetPlayer )]"
								layoutpolicy_horizontal = expanding
								text = "HOLDING_VIEW_TOP_REALM_COUNTY"
								margin_bottom = 5
								using = Font_Size_Small
								fontsize_min = 10
								maxwidth = 420
							}
							
							text_single = {
								name = "foreign_county"
								visible = "[Not(Or(ObjectsEqual( Character.Self, GetPlayer ),Character.IsOtherLiegeOrAbove( GetPlayer )))]"
								layoutpolicy_horizontal = expanding
								text = "HOLDING_VIEW_FOREIGN_COUNTY"
								margin_bottom = 5
								using = Font_Size_Small
								fontsize_min = 10
								maxwidth = 420
							}
						}
						
						expand = {}
					}
				}
				
				### WINDOW CONTROL BUTTONS ###
				buttons_window_control = {
					
					blockoverride "button_go_to" {
						tooltip = "GO_TO_PROVINCE_TT"
						using = tooltip_ne
						onclick = "[HoldingView.PanToCountyCapital]"
					}

					blockoverride "button_back" {
						visible = "[HasViewHistory]"
						onclick = "[OpenFromViewHistory]"
						tooltip = "[GetViewHistoryTooltip]"
					}
					
					blockoverride "button_close" {
						onclick = "[HoldingView.Close]"
					}
				}
				
				##################################################
				### COMMIT 4A/4: COUNTY INFO TAB ###
				##################################################
				
				vbox = {
					layoutpolicy_horizontal = expanding
					margin = { 10 5 }
					spacing = 5
					
					### DE JURE HIERARCHY ###
					vbox = {
						datacontext = "[HoldingView.GetCountyTitle]"
						layoutpolicy_horizontal = expanding
						spacing = 3
						
						fixedgridbox = {
							name = "dejure_hierarchy"
							datamodel = "[Title.GetDeJureLieges]"
							flipdirection = yes
							addcolumn = 40
							addrow = 40
							maxverticalslots = 1
							
							item = {
								coa_title_tiny_crown = {}
							}
						}
					}
					
					### COUNTY MODIFIERS ROW ###
					hbox = {
						layoutpolicy_horizontal = expanding
						spacing = 5
						margin_top = 5
						
						fixedgridbox = {
							name = "county_modifiers"
							datacontext = "[HoldingView.GetCountyTitle]"
							datamodel = "[Title.GetModifiers]"
							flipdirection = yes
							addcolumn = 30
							addrow = 30
							maxverticalslots = 1
							
							item = {
								icon_modifier = {
									blockoverride "icon_size" {
										size = { 30 30 }
									}
								}
							}
						}
						
						expand = {}
						
						button_standard = {
							name = "move_domicile_button"
							datacontext = "[GetPlayer]"
							visible = "[And(And(Character.IsDomicileInProvince(Province.Self), Not(Province.IsCapitalBarony)), Character.CanMoveDomicile)]"
							size = { 180 30 }
							text = "HOLDING_VIEW_MOVE_DOMICILE"
							tooltip = "HOLDING_VIEW_MOVE_DOMICILE_TOOLTIP"
							onclick = "[Character.MoveDomicile(Province.Self)]"
							using = Font_Size_Small
						}
					}
					
					### COUNTY FERTILITY BAR ###
					vbox = {
						name = "fertility_bar_section"
						layoutpolicy_horizontal = expanding
						spacing = 3
						margin_top = 5
						
						text_label_center = {
							text = "COUNTY_FERTILITY_LABEL"
							layoutpolicy_horizontal = expanding
							using = Font_Size_Small
						}
						
						widget = {
							size = { 100% 20 }
							
							progressbar_standard = {
								name = "fertility_bar"
								size = { 100% 100% }
								
								blockoverride "values" {
									value = "[FixedPointToFloat(Province.GetFertility)]"
									min = 0
									max = 100
								}
								
								blockoverride "color" {
									tintcolor = { 0.4 0.8 0.3 1.0 }
								}
							}
							
							text_single = {
								parentanchor = center
								text = "[Province.GetFertility|0]"
								using = Font_Size_Small
								default_format = "#high"
							}
						}
						
						text_multi = {
							name = "seasonal_info"
							layoutpolicy_horizontal = expanding
							autoresize = yes
							max_width = 550
							text = "COUNTY_FERTILITY_SEASONAL_DESC"
							using = Font_Size_Small
							margin = { 5 2 }
						}
					}
					
					### OCCUPATION OVERLAY ###
					widget = {
						visible = "[HoldingView.GetCountyTitle.IsOccupied]"
						size = { 100% 40 }
						
						background = {
							using = Background_Area_Dark
							tintcolor = { 0.8 0.2 0.2 0.5 }
						}
						
						text_label_center = {
							parentanchor = center
							text = "COUNTY_OCCUPIED"
							using = Font_Size_Medium
							default_format = "#high"
						}
					}
				}
				
				##################################################
				### COMMIT 4B/4: COUNTY STATS & HOLDER ###
				##################################################
				
				divider_light = {
					layoutpolicy_horizontal = expanding
					margin_top = 5
				}
				
				### HOLDER PORTRAIT SECTION ###
				vbox = {
					name = "holder_section"
					layoutpolicy_horizontal = expanding
					margin = { 10 5 }
					spacing = 5
					
					background = {
						using = Background_Area
						margin = { 5 5 }
					}
					
					hbox = {
						datacontext = "[HoldingView.GetCountyTitle.GetHolder]"
						spacing = 10
						margin = { 5 5 }
						
						portrait_head_small = {
							datacontext = "[HoldingView.GetCountyTitle.GetHolder]"
							
							blockoverride "portrait_button" {
								onclick = "[DefaultOnCharacterClick(Character.GetID)]"
								tooltip = "[Character.GetUINameNoTooltip]"
							}
						}
						
						vbox = {
							layoutpolicy_horizontal = expanding
							spacing = 2
							
							text_single = {
								text = "[Character.GetUINameNoTooltip]"
								using = Font_Size_Medium
								fontsize_min = 14
								max_width = 400
							}
							
							text_single = {
								text = "[Character.GetPrimaryTitle.GetNameNoTooltip]"
								using = Font_Size_Small
								fontsize_min = 10
								max_width = 400
								default_format = "#weak"
							}
							
							expand = {}
						}
					}
				}
				
				divider_light = {
					layoutpolicy_horizontal = expanding
					margin_top = 5
				}
				
				### COUNTY STATS ###
				vbox = {
					name = "county_stats"
					layoutpolicy_horizontal = expanding
					margin = { 10 5 }
					spacing = 8
					
					### CONTROL LEVEL ###
					vbox = {
						layoutpolicy_horizontal = expanding
						spacing = 3
						
						text_label_left = {
							text = "COUNTY_CONTROL_LABEL"
							using = Font_Size_Small
						}
						
						widget = {
							size = { 100% 25 }
							
							progressbar_standard = {
								name = "control_bar"
								size = { 100% 100% }
								
								blockoverride "values" {
									value = "[FixedPointToFloat(County.GetControl)]"
									min = 0
									max = 100
								}
								
								text_single = {
									parentanchor = center
									text = "[County.GetControl|0]%"
									using = Font_Size_Small
									default_format = "#high"
								}
							}
						}
						
						text_multi = {
							text = "COUNTY_CONTROL_DESC"
							autoresize = yes
							max_width = 550
							using = Font_Size_Small
							default_format = "#weak"
							margin = { 5 0 }
						}
					}
					
					### DEVELOPMENT LEVEL ###
					vbox = {
						layoutpolicy_horizontal = expanding
						spacing = 3
						
						text_label_left = {
							text = "COUNTY_DEVELOPMENT_LABEL"
							using = Font_Size_Small
						}
						
						hbox = {
							layoutpolicy_horizontal = expanding
							spacing = 5
							
							widget = {
								size = { 450 25 }
								
								progressbar_standard = {
									name = "development_bar"
									size = { 100% 100% }
									
									blockoverride "values" {
										value = "[FixedPointToFloat(County.GetDevelopmentLevel)]"
										min = 0
										max = 100
									}
									
									text_single = {
										parentanchor = center
										text = "[County.GetDevelopmentLevel|0]"
										using = Font_Size_Small
										default_format = "#high"
									}
								}
							}
							
							text_single = {
								text = "DEVELOPMENT_MONTHLY_PROGRESS"
								tooltip = "DEVELOPMENT_MONTHLY_TOOLTIP"
								using = Font_Size_Small
								default_format = "#weak"
							}
						}
						
						text_multi = {
							text = "COUNTY_DEVELOPMENT_DESC"
							autoresize = yes
							max_width = 550
							using = Font_Size_Small
							default_format = "#weak"
							margin = { 5 0 }
						}
					}
				}
				
				divider_light = {
					layoutpolicy_horizontal = expanding
					margin_top = 5
				}
				
				### COUNTY OPINION ###
				vbox = {
					name = "county_opinion_section"
					layoutpolicy_horizontal = expanding
					margin = { 10 5 }
					spacing = 5
					
					hbox = {
						layoutpolicy_horizontal = expanding
						spacing = 8
						
						icon = {
							size = { 30 30 }
							texture = "gfx/interface/icons/icon_opinion.dds"
						}
						
						text_single = {
							text = "COUNTY_OPINION_LABEL"
							using = Font_Size_Small
						}
						
						text_single = {
							text = "[County.GetOpinion|+]"
							using = Font_Size_Medium
							default_format = "#high"
						}
						
						expand = {}
						
						icon = {
							visible = "[County.IsInFaction]"
							size = { 30 30 }
							texture = "gfx/interface/icons/icon_faction.dds"
							tooltip = "COUNTY_IN_FACTION_TOOLTIP"
						}
					}
				}
				
				divider_light = {
					layoutpolicy_horizontal = expanding
					margin_top = 5
				}
				
				### CULTURE & FAITH ###
				hbox = {
					name = "culture_faith_section"
					layoutpolicy_horizontal = expanding
					margin = { 10 5 }
					spacing = 10
					
					vbox = {
						layoutpolicy_horizontal = expanding
						spacing = 5
						
						hbox = {
							spacing = 8
							
							icon = {
								size = { 40 40 }
								texture = "[County.GetCulture.GetIcon]"
							}
							
							vbox = {
								layoutpolicy_horizontal = expanding
								spacing = 2
								
								text_single = {
									text = "[County.GetCulture.GetNameNoTooltip]"
									using = Font_Size_Medium
									max_width = 200
								}
								
								text_single = {
									text = "CULTURE_ACCEPTANCE"
									using = Font_Size_Small
									default_format = "#weak"
								}
							}
						}
						
						widget = {
							size = { 100% 20 }
							
							progressbar_standard = {
								size = { 100% 100% }
								
								blockoverride "values" {
									value = "[FixedPointToFloat(County.GetCultureAcceptance)]"
									min = 0
									max = 100
								}
								
								text_single = {
									parentanchor = center
									text = "[County.GetCultureAcceptance|0]%"
									using = Font_Size_Small
									default_format = "#high"
								}
							}
						}
					}
					
					vbox = {
						layoutpolicy_horizontal = expanding
						spacing = 5
						
						hbox = {
							spacing = 8
							
							icon = {
								size = { 40 40 }
								texture = "[County.GetFaith.GetIcon]"
							}
							
							vbox = {
								layoutpolicy_horizontal = expanding
								spacing = 2
								
								text_single = {
									text = "[County.GetFaith.GetNameNoTooltip]"
									using = Font_Size_Medium
									max_width = 200
								}
								
								text_single = {
									text = "FAITH_LABEL"
									using = Font_Size_Small
									default_format = "#weak"
								}
							}
						}
					}
				}



				##################################################
				### COMMIT 4C/4: HOLDINGS NAVIGATION TABS ###
				##################################################
				
				divider_light = {
					layoutpolicy_horizontal = expanding
					margin_top = 5
				}

				### HOLDINGS TABS NAVIGATION ###
				vbox = {
					name = "holdings_tabs_section"
					layoutpolicy_horizontal = expanding
					margin = { 10 5 }
					spacing = 5
					
					### SECTION HEADER ###
					text_label_left = {
						text = "HOLDINGS_IN_COUNTY"
						using = Font_Size_Medium
						margin_bottom = 5
					}
					
					### TABS CONTAINER ###
					hbox = {
						name = "holding_tabs_container"
						layoutpolicy_horizontal = expanding
						spacing = 5
						
						# Dynamic tabs for each holding in the county
						fixedgridbox = {
							name = "holdings_tabs_grid"
							datacontext = "[HoldingView.GetCountyTitle]"
							datamodel = "[County.GetProvinces]"
							layoutpolicy_horizontal = expanding
							addcolumn = 110
							addrow = 45
							maxverticalslots = 1
							
							item = {
								button_tab = {
									name = "holding_tab"
									datacontext = "[Province.GetHolding]"
									size = { 105 40 }
									down = "[ObjectsEqual(Province.Self, HoldingView.GetProvince)]"
									onclick = "[OpenGameViewData('holding_view', Province.Self)]"
									tooltip = "HOLDING_TAB_TOOLTIP"
									
									### TAB CONTENT ###
									vbox = {
										size = { 100% 100% }
										spacing = 2
										margin = { 3 3 }
										
										# Holding type icon (Castle/City/Temple/Empty)
										icon = {
											name = "holding_type_icon"
											size = { 24 24 }
											parentanchor = hcenter
											texture = "[Select_CString(Holding.IsEmpty, 'gfx/interface/icons/holding_types/empty_holding.dds', Holding.GetPrimaryBuildingType.GetTypeIcon)]"
											alpha = "[Select_float(Holding.IsEmpty, '0.5', '1.0')]"
										}
										
										# Holding name
										text_single = {
											name = "holding_name"
											text = "[Holding.GetNameNoTooltip]"
											using = Font_Size_Small
											fontsize_min = 10
											max_width = 95
											align = center|nobaseline
											parentanchor = hcenter
											default_format = "#low"
										}
									}
									
									### ACTIVE INDICATOR ###
									widget = {
										visible = "[ObjectsEqual(Province.Self, HoldingView.GetProvince)]"
										size = { 100% 3 }
										parentanchor = bottom|hcenter
										
										background = {
											using = Color_Blue
											margin = { 2 0 }
										}
									}
									
									### CONSTRUCTION IN PROGRESS INDICATOR ###
									icon = {
										name = "construction_indicator"
										visible = "[Province.HasConstructions]"
										size = { 20 20 }
										parentanchor = top|right
										position = { -2 2 }
										texture = "gfx/interface/icons/flat_icons/construction.dds"
										tooltip = "HOLDING_TAB_CONSTRUCTION_IN_PROGRESS"
									}
								}
							}
						}
						
						### ADD NEW HOLDING BUTTON ###
						button_standard = {
							name = "construct_new_holding_button"
							visible = "[HoldingView.CanConstructNewHolding]"
							size = { 105 40 }
							onclick = "[HoldingView.OpenHoldingConstruction]"
							tooltip = "CONSTRUCT_NEW_HOLDING_TOOLTIP"
							enabled = "[HoldingView.CanConstructNewHolding]"
							
							vbox = {
								parentanchor = center
								spacing = 2
								
								icon = {
									size = { 24 24 }
									texture = "gfx/interface/icons/flat_icons/plus.dds"
									parentanchor = hcenter
								}
								
								text_single = {
									text = "BUILD_NEW"
									using = Font_Size_Small
									fontsize_min = 10
									parentanchor = hcenter
								}
							}
						}
						
						expand = {}
					}
					
					### HOLDING INFO STRIP ###
					hbox = {
						name = "holding_info_strip"
						layoutpolicy_horizontal = expanding
						margin_top = 5
						spacing = 10
						
						background = {
							using = Background_Area
							margin = { 5 3 }
						}
						
						# Current holding type
						hbox = {
							spacing = 5
							margin = { 5 3 }
							
							icon = {
								size = { 20 20 }
								texture = "[Select_CString(Holding.IsEmpty, 'gfx/interface/icons/holding_types/empty_holding.dds', Holding.GetPrimaryBuildingType.GetTypeIcon)]"
							}
							
							text_single = {
								text = "[Select_CString(Holding.IsEmpty, 'EMPTY_HOLDING', Holding.GetPrimaryBuildingType.GetTypeName)]"
								using = Font_Size_Small
							}
						}
						
						# Building slots used
						hbox = {
							visible = "[Not(Holding.IsEmpty)]"
							spacing = 5
							
							icon = {
								size = { 20 20 }
								texture = "gfx/interface/icons/building_slot.dds"
							}
							
							text_single = {
								text = "BUILDING_SLOTS_USED"
								using = Font_Size_Small
								tooltip = "BUILDING_SLOTS_TOOLTIP"
							}
						}
						
						expand = {}
						
						# Special buildings indicator
						hbox = {
							visible = "[Holding.HasSpecialBuilding]"
							spacing = 5
							margin = { 5 3 }
							
							icon = {
								size = { 20 20 }
								texture = "gfx/interface/icons/flat_icons/special_building.dds"
							}
							
							text_single = {
								text = "SPECIAL_BUILDING_PRESENT"
								using = Font_Size_Small
								default_format = "#high"
							}
						}
					}
				}
				
				divider_light = {
					layoutpolicy_horizontal = expanding
					margin_top = 5
				}


				##################################################
				### COMMIT 4D/4: BUILDINGS GRID & ACTIONS ###
				##################################################
				
				### BUILDINGS SECTION ###
				vbox = {
					name = "buildings_section"
					layoutpolicy_horizontal = expanding
					margin = { 10 5 }
					spacing = 8
					
					### SECTION HEADER WITH BUILD NEW BUTTON ###
					hbox = {
						layoutpolicy_horizontal = expanding
						spacing = 10
						
						text_label_left = {
							text = "BUILDINGS_LABEL"
							using = Font_Size_Medium
						}
						
						expand = {}
						
						### BUILD NEW BUILDING BUTTON ###
						button_standard = {
							name = "build_new_building_button"
							visible = "[Not(Holding.IsEmpty)]"
							size = { 140 30 }
							onclick = "[HoldingView.OpenBuildingConstructionView]"
							tooltip = "BUILD_NEW_BUILDING_TOOLTIP"
							enabled = "[HoldingView.CanBuildNewBuilding]"
							
							hbox = {
								parentanchor = center
								spacing = 5
								
								icon = {
									size = { 20 20 }
									texture = "gfx/interface/icons/flat_icons/plus.dds"
								}
								
								text_single = {
									text = "BUILD_NEW"
									using = Font_Size_Small
								}
							}
						}
					}
					
					### EMPTY HOLDING MESSAGE ###
					vbox = {
						visible = "[Holding.IsEmpty]"
						layoutpolicy_horizontal = expanding
						spacing = 10
						margin = { 10 20 }
						
						background = {
							using = Background_Area_Dark
							margin = { 10 10 }
						}
						
						icon = {
							size = { 60 60 }
							parentanchor = hcenter
							texture = "gfx/interface/icons/holding_types/empty_holding.dds"
							alpha = 0.5
						}
						
						text_multi = {
							layoutpolicy_horizontal = expanding
							autoresize = yes
							max_width = 500
							text = "EMPTY_HOLDING_DESC"
							using = Font_Size_Small
							align = center
							margin = { 10 5 }
						}
						
						button_primary = {
							name = "construct_holding_button"
							size = { 200 35 }
							parentanchor = hcenter
							text = "CONSTRUCT_HOLDING"
							onclick = "[HoldingView.OpenHoldingConstruction]"
							tooltip = "CONSTRUCT_HOLDING_TOOLTIP"
							enabled = "[HoldingView.CanConstructNewHolding]"
						}
					}
					
					### BUILDINGS GRID ###
					scrollbox = {
						name = "buildings_scrollbox"
						visible = "[Not(Holding.IsEmpty)]"
						layoutpolicy_horizontal = expanding
						size = { 0 350 }
						autoresizescrollarea = yes
						maximumsize = { -1 500 }
						
						blockoverride "scrollbox_content" {
							fixedgridbox = {
								name = "buildings_grid"
								datamodel = "[HoldingView.GetBuildings]"
								layoutpolicy_horizontal = expanding
								addcolumn = 75
								addrow = 75
								maxverticalslots = 1
								flipdirection = yes
								setparentsizetominimum = yes
								margin = { 10 10 }
								spacing = 8
								
								item = {
									widget = {
										size = { 70 70 }
										
										### BUILDING BUTTON ###
										button_standard = {
											name = "building_button"
											size = { 100% 100% }
											onclick = "[GUIBuildingItem.OnClick]"
											down = "[GUIBuildingItem.IsHighlighted]"
											enabled = "[GUIBuildingItem.IsBuildingButtonEnabled]"
											tooltip = "[GUIBuildingItem.GetTooltip]"
											
											### BUILDING ICON ###
											icon = {
												name = "building_icon"
												visible = "[GUIBuildingItem.HasLevel]"
												parentanchor = center
												size = { 55 50 }
												texture = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetTypeIcon]"
											}
											
											### BUILD NEW ICON ###
											icon = {
												name = "build_new_icon"
												visible = "[And(And(GUIBuildingItem.IsBuildNewIconShown, GUIBuildingItem.IsBuildingButtonEnabled), Not(GUIBuildingItem.HasLevel))]"
												parentanchor = center
												size = { 35 35 }
												alpha = 0.7
												texture = "gfx/interface/icons/flat_icons/plus.dds"
												alwaystransparent = yes
											}
											
											### BUILDING LEVEL ###
											text_single = {
												visible = "[And(GUIBuildingItem.HasLevel, Not(GUIBuildingItem.IsConstructing))]"
												text = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetLevel]"
												parentanchor = bottom|right
												position = { -6 -2 }
												fontsize = 16
												default_format = "#low;bold"
												align = nobaseline
												
												background = {
													using = Background_Area_ExtraDark
													margin = { 5 0 }
												}
											}
											
											### CONSTRUCTION PROGRESS BAR ###
											widget = {
												visible = "[And(GUIBuildingItem.HasLevel, GUIBuildingItem.IsConstructing)]"
												parentanchor = bottom|hcenter
												position = { 0 -3 }
												
												vbox = {
													spacing = 2
													
													text_single = {
														text = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetLevel]"
														parentanchor = right
														position = { -1 0 }
														fontsize = 15
														default_format = "#low;bold"
														align = nobaseline
														
														background = {
															using = Background_Area_ExtraDark
															margin = { 5 0 }
														}
													}
													
													progressbar_standard = {
														name = "construct_progressbar"
														parentanchor = hcenter
														alwaystransparent = yes
														size = { 60 10 }
														
														blockoverride "values" {
															value = "[GUIBuildingItem.GetConstructingProgress]"
															min = 0
															max = 100
														}
													}
												}
											}
											
											### BUILDING DISABLED WARNING ###
											warning_icon = {
												name = "reduced_by_fixable_situation"
												visible = "[GUIBuildingItem.IsBuildingDisabled]"
												position = { 3 3 }
												size = { 22 22 }
												tooltip = "BUILDING_DISABLED_TOOLTIP"
											}
										}
										
										### EMPTY BUILDING SLOT ###
										icon = {
											name = "building_slot"
											size = { 100% 100% }
											using = Background_Area
											visible = "[GUIBuildingItem.IsBuildingSlotShown]"
										}
									}
								}
							}
						}
					}
					
					### BUILDINGS LEGEND (optional) ###
					hbox = {
						visible = "[Not(Holding.IsEmpty)]"
						layoutpolicy_horizontal = expanding
						spacing = 15
						margin_top = 5
						
						hbox = {
							spacing = 5
							
							icon = {
								size = { 16 16 }
								texture = "gfx/interface/icons/flat_icons/construction.dds"
							}
							
							text_single = {
								text = "UNDER_CONSTRUCTION"
								using = Font_Size_Small
								default_format = "#weak"
							}
						}
						
						expand = {}
						
						hbox = {
							spacing = 5
							
							icon = {
								size = { 16 16 }
								using = Background_Area
							}
							
							text_single = {
								text = "EMPTY_SLOT"
								using = Font_Size_Small
								default_format = "#weak"
							}
						}
					}
				}
				
				divider_light = {
					layoutpolicy_horizontal = expanding
					margin_top = 8
				}
				
				##################################################
				### HOLDING ACTIONS SECTION ###
				##################################################
				
				vbox = {
					name = "holding_actions_section"
					layoutpolicy_horizontal = expanding
					margin = { 10 5 }
					spacing = 5
					
					text_label_left = {
						text = "HOLDING_ACTIONS_LABEL"
						using = Font_Size_Medium
						margin_bottom = 5
					}
					
					### ACTIONS GRID ###
					fixedgridbox = {
						name = "holding_actions_grid"
						layoutpolicy_horizontal = expanding
						addcolumn = 270
						addrow = 35
						maxverticalslots = 1
						spacing = 8
						
						item = {
							### CONVERT HOLDING TYPE ###
							button_standard = {
								name = "convert_holding_button"
								visible = "[HoldingView.CanConvertHolding]"
								size = { 265 32 }
								onclick = "[HoldingView.OpenConvertHoldingView]"
								tooltip = "CONVERT_HOLDING_TOOLTIP"
								enabled = "[HoldingView.CanConvertHolding]"
								
								hbox = {
									spacing = 8
									margin = { 8 0 }
									
									icon = {
										size = { 24 24 }
										texture = "gfx/interface/icons/flat_icons/convert.dds"
									}
									
									text_single = {
										text = "CONVERT_HOLDING"
										using = Font_Size_Small
									}
								}
							}
						}
						
						item = {
							### DEMOLISH HOLDING ###
							button_standard = {
								name = "demolish_holding_button"
								visible = "[HoldingView.CanDemolishHolding]"
								size = { 265 32 }
								onclick = "[HoldingView.DemolishHolding]"
								tooltip = "DEMOLISH_HOLDING_TOOLTIP"
								enabled = "[HoldingView.CanDemolishHolding]"
								
								hbox = {
									spacing = 8
									margin = { 8 0 }
									
									icon = {
										size = { 24 24 }
										texture = "gfx/interface/icons/flat_icons/demolish.dds"
									}
									
									text_single = {
										text = "DEMOLISH_HOLDING"
										using = Font_Size_Small
									}
								}
							}
						}
						
						item = {
							### MOVE REALM CAPITAL ###
							button_standard = {
								name = "move_realm_capital_button"
								visible = "[HoldingView.CanMoveRealmCapital]"
								size = { 265 32 }
								onclick = "[HoldingView.MoveRealmCapital]"
								tooltip = "MOVE_REALM_CAPITAL_TOOLTIP"
								enabled = "[HoldingView.CanMoveRealmCapital]"
								
								hbox = {
									spacing = 8
									margin = { 8 0 }
									
									icon = {
										size = { 24 24 }
										texture = "gfx/interface/icons/flat_icons/capital.dds"
									}
									
									text_single = {
										text = "MOVE_REALM_CAPITAL"
										using = Font_Size_Small
									}
								}
							}
						}
						
						item = {
							### GRANT TITLE ###
							button_standard = {
								name = "grant_title_button"
								visible = "[HoldingView.CanGrantTitle]"
								size = { 265 32 }
								onclick = "[HoldingView.OpenGrantTitleView]"
								tooltip = "GRANT_TITLE_TOOLTIP"
								enabled = "[HoldingView.CanGrantTitle]"
								
								hbox = {
									spacing = 8
									margin = { 8 0 }
									
									icon = {
										size = { 24 24 }
										texture = "gfx/interface/icons/flat_icons/grant.dds"
									}
									
									text_single = {
										text = "GRANT_TITLE"
										using = Font_Size_Small
									}
								}
							}
						}
					}
				}
				
				### BOTTOM SPACER ###
				expand = {
					minimumsize = { 0 10 }
				}


			}
		}
	}
}

######################################################
############ SECONDARY WINDOWS (DUAL-MODE) ###########
######################################################

## CONSTRUCT NEW BUILDING WINDOW (holding_tracks_view)
## Finestra per selezionare e costruire nuovi edifici
## OCR: Lista testuale semplice
## Vanilla: Griglia grafica con icone

window = {
	name = "holding_tracks_view"
	size = { 100% 100% }
	movable = no
	layer = top
	datacontext = "[HoldingView.GetHolder]"
	datacontext = "[GetVariableSystem]"
	
	state = {
		name = _show
		using = Animation_FadeIn_Quick
		position_x = 0
	}
	
	state = {
		name = _hide
		using = Animation_FadeOut_Quick
		position_x = -50
	}
	
	alwaystransparent = yes
	
	hbox = {
		expand = {}
		maxwidth = 610
		
		widget = {
			layoutpolicy_vertical = expanding
			size = { 725 0 }
			
			vbox = {
				margin_top = 170
				margin_bottom = 10
				expand = {}
				
				vbox = {
					layoutpolicy_horizontal = expanding
					minimumsize = { 0 730 }



					##############################################
					# WIDGET OCR (Modalità NON VEDENTE)
					##############################################

					vbox = {
						layoutpolicy_vertical = expanding
						layoutpolicy_horizontal = expanding
						name = "window_content_ocr"
						margin_left = 20
						margin_right = 20
						margin_top = 20
						margin_bottom = 20
						spacing = 10

						# ✅ Datacontexts already defined in parent window (not duplicating)
						# (HoldingView.GetProvince, HoldingView.GetHolding, HoldingView.GetHolder, Province.GetCounty)

						### HEADER SECTION ###
						vbox = {
							name = "ocr_header"
							spacing = 5
							
							# County/Holding Title
							text_label_left = {
								name = "header_county_name"
								text = "[County.GetName]"
								align = left
							}
							
							# Holder info line
							text_label_left = {
								name = "header_holder_info"
								text = "Ruled by [Holder.GetFirstName] [Holder.GetHouse.GetName]"
								align = left
							}
						}

						### TAB MENU ###
						hbox = {
							name = "ocr_tab_menu"
							spacing = 8
							layoutpolicy_horizontal = expanding
							
							# Info Tab Button
							button = {
								name = "tab_btn_info"
								text = "Info (E)"
								tooltip = "County general information: name, holder, culture, religion, development level"
								onclick = "[GetVariableSystem.Set('county_tabs', 'info')]"
								onclick = "[PdxGuiUpdateLocalizationOnLocaleChanged('tab_btn_info')]"
								size = { 100 32 }
							}
							
							# Stats Tab Button
							button = {
								name = "tab_btn_stats"
								text = "Stats (S)"
								tooltip = "County statistics: population, development, income, culture diversity, religion breakdown"
								onclick = "[GetVariableSystem.Set('county_tabs', 'stats')]"
								onclick = "[PdxGuiUpdateLocalizationOnLocaleChanged('tab_btn_stats')]"
								size = { 100 32 }
							}
							
							# Holdings Tab Button
							button = {
								name = "tab_btn_holdings"
								text = "Holdings (H)"
								tooltip = "Baronies in this county: primary holding, invested holdings, vassals"
								onclick = "[GetVariableSystem.Set('county_tabs', 'holdings')]"
								onclick = "[PdxGuiUpdateLocalizationOnLocaleChanged('tab_btn_holdings')]"
								size = { 100 32 }
							}
							
							# Buildings Tab Button
							button = {
								name = "tab_btn_buildings"
								text = "Buildings (B)"
								tooltip = "Constructions in each holding: completed buildings, under construction, available builds"
								onclick = "[GetVariableSystem.Set('county_tabs', 'buildings')]"
								onclick = "[PdxGuiUpdateLocalizationOnLocaleChanged('tab_btn_buildings')]"
								size = { 100 32 }
							}
							
							# Adjacent Tab Button
							button = {
								name = "tab_btn_adjacent"
								text = "Adjacent (A)"
								tooltip = "Neighboring counties: list of adjacent counties with holders"
								onclick = "[GetVariableSystem.Set('county_tabs', 'adjacent')]"
								onclick = "[PdxGuiUpdateLocalizationOnLocaleChanged('tab_btn_adjacent')]"
								size = { 100 32 }
							}
							
							# Council/Actions Tab Button
							button = {
								name = "tab_btn_actions"
								text = "Council (C)"
								tooltip = "Councillor tasks: available actions and ongoing council assignments"
								onclick = "[GetVariableSystem.Set('county_tabs', 'actions')]"
								onclick = "[PdxGuiUpdateLocalizationOnLocaleChanged('tab_btn_actions')]"
								size = { 100 32 }
							}
						}

						### TAB CONTENT CONTAINER ###
						vbox = {
							name = "ocr_tab_content"
							spacing = 10
							layoutpolicy_vertical = expanding
							layoutpolicy_horizontal = expanding

							######################################
							# TAB 1: INFO TAB
							######################################
							vbox = {
								name = "ocr_info_tab"
								visible = "[GetVariableSystem.HasValue('county_tabs', 'info')]"
								spacing = 8
								layoutpolicy_vertical = expanding
								
								# County Name
								text_label_left = {
									text = "County: [County.GetName]"
									align = left
								}
								
								# Holder Information
								text_label_left = {
									text = "Holder: [Holder.GetFirstName] [Holder.GetHouse.GetName]"
									align = left
								}
								
								# Culture
								text_label_left = {
									text = "Culture: [County.GetCulture.GetName]"
									align = left
								}
								
								# Religion
								text_label_left = {
									text = "Religion: [County.GetReligion.GetName]"
									align = left
								}
								
								# Development Level
								text_label_left = {
									text = "Development: [County.GetDevelopmentLevel]"
									align = left
								}
								
								# Capital Barony
								text_label_left = {
									text = "Capital: [County.GetCapitalBarony.GetName]"
									align = left
								}
								
								# De Jure Kingdom
								text_label_left = {
									text = "De Jure Kingdom: [County.GetDeJureKingdom.GetName]"
									align = left
								}
								
								# Terrain Type
								text_label_left = {
									text = "Terrain: [County.GetTerrain.GetName]"
									align = left
								}
								
								# Coastal Status
								text_label_left = {
									text = "Coastal: [County.IsCoastal]"
									align = left
								}
								
								# Special Notes Spacer
								text_label_left = {
									text = "---"
									align = left
								}
								
								# Holder Title if vassal
								text_label_left = {
									text = "Holder Title: [Holder.GetTitledName]"
									align = left
								}
							}

							######################################
							# TAB 2: STATS TAB
							######################################
							vbox = {
								name = "ocr_stats_tab"
								visible = "[GetVariableSystem.HasValue('county_tabs', 'stats')]"
								spacing = 8
								layoutpolicy_vertical = expanding
								
								# Population
								text_label_left = {
									text = "Population: [County.GetTotalPopulation]"
									align = left
								}
								
								# Development
								text_label_left = {
									text = "Development Level: [County.GetDevelopmentLevel]"
									align = left
								}
								
								# Development Progress to next level
								text_label_left = {
									text = "Development Progress: [County.GetDevelopmentProgress]%"
									align = left
								}
								
								# Income
								text_label_left = {
									text = "Monthly Income: [County.GetMonthlyIncome]"
									align = left
								}
								
								# Culture Acceptance
								text_label_left = {
									text = "Culture Acceptance: [County.GetCultureAcceptance]%"
									align = left
								}
								
								# Religion Acceptance
								text_label_left = {
									text = "Religion Acceptance: [County.GetReligionAcceptance]%"
									align = left
								}
								
								# Stability
								text_label_left = {
									text = "Stability: [County.GetStabilityLevel]"
									align = left
								}
								
								# Divider
								text_label_left = {
									text = "---"
									align = left
								}
								
								# Culture Breakdown Header
								text_label_left = {
									text = "Culture Breakdown:"
									align = left
								}
								
								# Main Culture
								text_label_left = {
									text = "[County.GetCulture.GetName]: [County.GetCulturePercentage]%"
									align = left
								}
								
								# Religion Breakdown Header
								text_label_left = {
									text = "Religion Breakdown:"
									align = left
								}
								
								# Main Religion
								text_label_left = {
									text = "[County.GetReligion.GetName]: [County.GetReligionPercentage]%"
									align = left
								}
							}

							######################################
							# TAB 3: HOLDINGS TAB
							######################################
							vbox = {
								name = "ocr_holdings_tab"
								visible = "[GetVariableSystem.HasValue('county_tabs', 'holdings')]"
								spacing = 8
								layoutpolicy_vertical = expanding
								
								# Holdings Header
								text_label_left = {
									text = "Holdings in [County.GetName]:"
									align = left
								}
								
								# Primary Holding
								text_label_left = {
									text = "PRIMARY: [County.GetCapitalBarony.GetName]"
									align = left
								}
								
								text_label_left = {
									text = "  Type: [County.GetCapitalBarony.GetHoldingType]"
									align = left
								}
								
								text_label_left = {
									text = "  Holder: [County.GetCapitalBarony.GetHolder.GetFirstName] [County.GetCapitalBarony.GetHolder.GetHouse.GetName]"
									align = left
								}
								
								text_label_left = {
									text = "  Level: [County.GetCapitalBarony.GetLevel]"
									align = left
								}
								
								# Other Holdings Placeholder
								text_label_left = {
									text = "---"
									align = left
								}
								
								text_label_left = {
									text = "Other Holdings:"
									align = left
								}
								
								text_label_left = {
									text = "[Explanation: Use scrollable list or multiple individual vbox entries for each holding]"
									align = left
								}
								
								# De Facto Vassal Info
								text_label_left = {
									text = "---"
									align = left
								}
								
								text_label_left = {
									text = "Invested Holdings / De Facto Vassals:"
									align = left
								}
								
								text_label_left = {
									text = "[Explanation: List all invested or vassal holdings with holder info]"
									align = left
								}
							}

							######################################
							# TAB 4: BUILDINGS TAB
							######################################
							vbox = {
								name = "ocr_buildings_tab"
								visible = "[GetVariableSystem.HasValue('county_tabs', 'buildings')]"
								spacing = 8
								layoutpolicy_vertical = expanding
								
								# Buildings Header
								text_label_left = {
									text = "Buildings in [County.GetName]:"
									align = left
								}
								
								# Primary Holding Buildings
								text_label_left = {
									text = "[County.GetCapitalBarony.GetName] ([County.GetCapitalBarony.GetHoldingType]):"
									align = left
								}
								
								# Completed Buildings Placeholder
								text_label_left = {
									text = "  Completed:"
									align = left
								}
								
								text_label_left = {
									text = "  [List completed buildings or 'None']"
									align = left
								}
								
								# Under Construction
								text_label_left = {
									text = "  Under Construction:"
									align = left
								}
								
								text_label_left = {
									text = "  [List building + completion date or 'None']"
									align = left
								}
								
								# Available Builds
								text_label_left = {
									text = "  Available Builds:"
									align = left
								}
								
								text_label_left = {
									text = "  [List 3-5 highest priority builds + cost]"
									align = left
								}
								
								# Other Holdings Building Summary
								text_label_left = {
									text = "---"
									align = left
								}
								
								text_label_left = {
									text = "Other Holdings Summary:"
									align = left
								}
								
								text_label_left = {
									text = "[Explanation: For each other holding, show main building status]"
									align = left
								}
							}

							######################################
							# TAB 5: ADJACENT COUNTIES TAB
							######################################
							vbox = {
								name = "ocr_adjacent_tab"
								visible = "[GetVariableSystem.HasValue('county_tabs', 'adjacent')]"
								spacing = 8
								layoutpolicy_vertical = expanding
								
								# Adjacent Header
								text_label_left = {
									text = "Adjacent Counties to [County.GetName]:"
									align = left
								}
								
								text_label_left = {
									text = "[Use Tab to navigate, Enter to focus on adjacent county]"
									align = left
								}
								
								# Adjacent 1
								text_label_left = {
									text = "---"
									align = left
								}
								
								text_label_left = {
									text = "[Adjacent County 1 Name]"
									align = left
								}
								
								text_label_left = {
									text = "  Holder: [Holder Name]"
									align = left
								}
								
								text_label_left = {
									text = "  Relation: [De Jure Kingdom info or independent]"
									align = left
								}
								
								# Adjacent 2
								text_label_left = {
									text = "---"
									align = left
								}
								
								text_label_left = {
									text = "[Adjacent County 2 Name]"
									align = left
								}
								
								text_label_left = {
									text = "  Holder: [Holder Name]"
									align = left
								}
								
								text_label_left = {
									text = "  Relation: [De Jure Kingdom info or independent]"
									align = left
								}
								
								text_label_left = {
									text = "[etc for all adjacent counties]"
									align = left
								}
							}

							######################################
							# TAB 6: COUNCIL/ACTIONS TAB
							######################################
							vbox = {
								name = "ocr_actions_tab"
								visible = "[GetVariableSystem.HasValue('county_tabs', 'actions')]"
								spacing = 8
								layoutpolicy_vertical = expanding
								
								# Council Header
								text_label_left = {
									text = "Council Tasks and Available Actions:"
									align = left
								}
								
								# Active Council Tasks
								text_label_left = {
									text = "Active Council Tasks:"
									align = left
								}
								
								text_label_left = {
									text = "[Show assigned councillor tasks with progress if any]"
									align = left
								}
								
								# Available Direct Actions
								text_label_left = {
									text = "---"
									align = left
								}
								
								text_label_left = {
									text = "Available Actions:"
									align = left
								}
								
								text_label_left = {
									text = "• Develop County (Costs: gold/prestige)"
									align = left
								}
								
								text_label_left = {
									text = "• Construct Building (Primary holding only)"
									align = left
								}
								
								text_label_left = {
									text = "• Grant Holdings to Vassal"
									align = left
								}
								
								text_label_left = {
									text = "• Appoint Councillor Tasks"
									align = left
								}
								
								text_label_left = {
									text = "---"
									align = left
								}
								
								text_label_left = {
									text = "[Note: Actual action buttons/links to be implemented]"
									align = left
								}
							}
						}
					}



					
					##############################################
					# WIDGET VANILLA (Modalità VEDENTE)
					##############################################
					
					vbox = {
						visible = "[GetVariableSystem.Exists('ocr')]"
						name = "vanilla_tracks_content"
						layoutpolicy_horizontal = expanding
						alwaystransparent = no
						margin = { 3 3 }
						margin_bottom = 5
						using = Window_Background_Subwindow
						
						header_pattern = {
							layoutpolicy_horizontal = expanding
							
							blockoverride "header_text" {
								text = "[HoldingView.GetTracksViewLabel]"
							}
							
							blockoverride "button_close" {
								onclick = "[HoldingView.CloseSubwindows]"
							}
						}
						
						building_in_vassal_warning_hbox_vanilla = {}
						
						text_single = {
							name = "prompt"
							layoutpolicy_horizontal = shrinking
							text = "[HoldingView.GetTracksViewPrompt]"
							margin_bottom = 10
						}
						
						text_single = {
							name = "no_potential_buildings_text"
							visible = "[IsDataModelEmpty(HoldingView.GetPotentialBuildings)]"
							layoutpolicy_horizontal = shrinking
							text = "NO_POTENTIAL_BUILDINGS_WARNING"
							margin_bottom = 10
						}
						
						# Griglia grafica Vanilla per edifici
						container = {
							visible = "[Not(IsDataModelEmpty(HoldingView.GetPotentialBuildings))]"
							layoutpolicy_vertical = expanding
							
							scrollbox = {
								visible = "[Not(HoldingView.IsSelectingBuildingToConstruct)]"
								size = { 700 300 }
								autoresizescrollarea = yes
								maximumsize = { -1 800 }
								
								blockoverride "scrollbox_content" {
									name = "tracks_grid"
									datamodel = "[HoldingView.GetPotentialBuildings]"
									datacontext = "[HoldingView.GetProvince]"
									visible = "[HoldingView.IsSelectingNewBuilding]"
									spacing = 10
									setparentsizetominimum = yes
									
									block "scrollbox_margins" {
										using = Scrollbox_Margins
										margin_right = 15
										margin_top = 5
									}
									
									item = {
										vbox = {
											layoutpolicy_horizontal = expanding
											background = {
												using = Background_Area_Light
											}
											
											hbox = {
												name = "header"
												layoutpolicy_horizontal = expanding
												background = {
													using = Background_Area
												}
												
												hbox = {
													layoutpolicy_horizontal = expanding
													margin = { 10 10 }
													spacing = 10
													
													icon_building = {
														name = "building_icon"
														size = { 75 65 }
														texture = "[GUIPotentialBuildingItem.GetBuilding.GetTypeIcon]"
													}
													
													vbox = {
														spacing = 5
														layoutpolicy_horizontal = expanding
														
														text_single = {
															layoutpolicy_horizontal = expanding
															text = "[GUIPotentialBuildingItem.GetBuilding.GetTypeName]"
															using = Font_Size_Medium
															align = left
															autoresize = no
														}
														
														hbox = {
															button_tertiary = {
																text = "CONSTRUCT_BUILDINGS_DETAILS"
																onclick = "[GUIPotentialBuildingItem.ShowDetails]"
																tooltip = "CONSTRUCT_BUILDINGS_DETAILS_TT"
																using = tooltip_es
															}
															expand = {}
														}
													}
													expand = {}
												}
											}
											
											hbox = {
												spacing = 5
												
												hbox = {
													margin = { 5 5 }
													min_width = 120
													spacing = 10
													background = {
														using = Background_Area
														margin_bottom = 4
														margin_left = 6
													}
													
													text_single = {
														datacontext = "[GUIPotentialBuildingItem.GetGoldCost]"
														visible = "[GUIPotentialBuildingItem.HasGoldCost]"
														layoutpolicy_horizontal = expanding
														text = "[ValueBreakdown.GetValue]"
														tooltipvisible = "[ValueBreakdown.HasTooltip]"
														tooltipwidget = {
															widget_value_breakdown_tooltip = {}
														}
														background = {
															visible = "[LessThan_CFixedPoint(GetPlayer.GetGold, ValueBreakdown.GetFixedPointValue)]"
															using = Status_Bad
														}
													}
													
													text_single = {
														datacontext = "[GUIPotentialBuildingItem.GetPrestigeCost]"
														visible = "[GUIPotentialBuildingItem.HasPrestigeCost]"
														layoutpolicy_horizontal = expanding
														text = "[ValueBreakdown.GetValue]"
														tooltipvisible = "[ValueBreakdown.HasTooltip]"
														tooltipwidget = {
															widget_value_breakdown_tooltip = {}
														}
														background = {
															visible = "[LessThan_CFixedPoint(GetPlayer.GetPrestige, ValueBreakdown.GetFixedPointValue)]"
															using = Status_Bad
														}
													}
													
													text_single = {
														layoutpolicy_horizontal = expanding
														datacontext = "[GUIPotentialBuildingItem.GetPietyCost]"
														visible = "[GUIPotentialBuildingItem.HasPietyCost]"
														text = "[ValueBreakdown.GetValue]"
														tooltipvisible = "[ValueBreakdown.HasTooltip]"
														tooltipwidget = {
															widget_value_breakdown_tooltip = {}
														}
														background = {
															visible = "[LessThan_CFixedPoint(GetPlayer.GetPiety, ValueBreakdown.GetFixedPointValue)]"
															using = Status_Bad
														}
													}
													
													text_single = {
														layoutpolicy_horizontal = expanding
														datacontext = "[GUIPotentialBuildingItem.GetConstructionTime]"
														text = "[ValueBreakdown.GetValue]"
														tooltipvisible = "[ValueBreakdown.HasTooltip]"
														tooltipwidget = {
															widget_value_breakdown_tooltip = {}
														}
													}
												}
												
												expand = {}
												
												button_standard = {
													layoutpolicy_horizontal = expanding
													layoutpolicy_vertical = expanding
													size = { 100 53 }
													enabled = "[GUIPotentialBuildingItem.CanConstruct]"
													tooltip = "[GUIPotentialBuildingItem.GetTooltip]"
													onclick = "[GUIPotentialBuildingItem.Construct]"
													onclick = "[HoldingView.CloseSubwindows]"
													text = "CONSTRUCT"
													using = tooltip_es
												}
											}
										}
									}
								}
							}
						}
					}
				}
			}
		}
	}
}

## HOLDING TYPE SELECTION VIEW
## Finestra per cambiare tipo di insediamento (Castle/City/Temple)
## OCR: Bottoni testuali semplici "Convert to X"
## Vanilla: Schede grafiche con illustrazioni

window = {
	name = "holding_type_selection_view"
	movable = no
	layer = windows_layer
	parentanchor = bottom|hcenter
	position = { 40 -50 }
	datacontext = "[GetVariableSystem]"
	
	using = Animation_ShowHide_Quick
	using = Window_Background_Subwindow
	
	vbox = {
		set_parent_size_to_minimum = yes
		margin = { 4 4 }
		margin_bottom = 15
		spacing = 15
		
		header_pattern = {
			layoutpolicy_horizontal = expanding
			
			blockoverride "header_text" {
				text = "CREATE_NEW_HOLDING_HEADING"
			}
			
			blockoverride "button_close" {
				onclick = "[HoldingView.CloseHoldingConstruction]"
			}
		}
		
		building_in_vassal_warning_hbox_ocr = {
			visible = "[Not(GetVariableSystem.Exists('ocr'))]"
		}
		
		building_in_vassal_warning_hbox_vanilla = {
			visible = "[GetVariableSystem.Exists('ocr')]"
		}
		
		##############################################
		# WIDGET OCR (Modalità NON VEDENTE)
		##############################################
		
		vbox = {
			visible = "[Not(GetVariableSystem.Exists('ocr'))]"
			name = "ocr_holding_types"
			layoutpolicy_horizontal = expanding
			spacing = 10
			margin = { 10 10 }
			
			datamodel = "[HoldingView.GetHoldingTypeItems]"
			
			item = {
				button_text = {
					layoutpolicy_horizontal = expanding
					enabled = "[HoldingTypeItem.CanConstructBuilding]"
					onclick = "[HoldingTypeItem.OnClick]"
					tooltip = "[HoldingTypeItem.GetTooltip]"
					
					blockoverride "text" {
						text = "Convert to [HoldingTypeItem.GetHoldingType.GetName]"
					}
				}
			}
		}
		
		##############################################
		# WIDGET VANILLA (Modalità VEDENTE)
		##############################################
		
		hbox = {
			visible = "[GetVariableSystem.Exists('ocr')]"
			name = "holding_types"
			datamodel = "[HoldingView.GetHoldingTypeItems]"
			layoutpolicy_horizontal = expanding
			spacing = 10
			margin = { 10 10 }
			
			item = {
				vbox = {
					spacing = 5
					
					button_standard = {
						size = { 250 148 }
						enabled = "[HoldingTypeItem.CanConstructBuilding]"
						onclick = "[HoldingTypeItem.OnClick]"
						tooltip = "[HoldingTypeItem.GetTooltip]"
						datacontext = "[HoldingTypeItem.GetProvince]"
						
						widget = {
							scissor = yes
							size = { 247 146 }
							
							icon = {
								visible = "[HoldingTypeItem.CanConstructBuilding]"
								size = { 320 146 }
								texture = "[HoldingTypeItem.GetBuilding.GetIllustration(Province.Self)]"
								using = Mask_Rough_Edges
								alpha = 0.7
							}
							
							highlight_icon = {
								visible = "[Not(HoldingTypeItem.CanConstructBuilding)]"
								size = { 320 146 }
								texture = "[HoldingTypeItem.GetBuilding.GetIllustration(Province.Self)]"
								effectname = "GreyedOut"
								tintcolor = { 0.6 0.6 0.6 1 }
								using = Mask_Rough_Edges
							}
							
							flowcontainer = {
								parentanchor = bottom|right
								ignoreinvisible = yes
								margin = { 5 5 }
								
								warning_icon = {
									name = "wrong_type"
									visible = "[Not(HoldingTypeItem.IsValidForPlayer)]"
									size = { 35 35 }
									tooltip = "HOLDING_SELECTION_VIEW_WRONG_HOLDING_TYPE"
								}
							}
						}
					}
					
					text_label_center = {
						layoutpolicy_horizontal = expanding
						text = "[HoldingTypeItem.GetHoldingType.GetName]"
					}
				}
			}
		}
	}
}

######################################################
################ TYPES AND TEMPLATES #################
######################################################

types OCR_CountyView_Types {
	
	##############################################
	# TYPES OCR (per modalità accessibile)
	##############################################
	
	type widget_building_text_ocr = button {
		size = { @building_width 20 }
		allow_outside = yes
		onclick = "[GUIBuildingItem.OnClick]"
		down = "[GUIBuildingItem.IsHighlighted]"
		enabled = "[GUIBuildingItem.IsBuildingButtonEnabled]"
		
		vbox = {
			hbox = {
				layoutpolicy_horizontal = expanding
				spacing = 5
				
				text_single { 
					raw_text = "Upgrade" 
					visible = "[GUIBuildingItem.CanUpgrade]" 
				}
				
				text_single { 
					raw_text = "Empty. Preview." 
					visible = "[And(Not(GUIBuildingItem.IsBuildNewIconShown), Not(GUIBuildingItem.HasLevel))]" 
				}
				
				text_single { 
					text = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetNameNoTooltip]" 
					visible = "[GUIBuildingItem.HasLevel]" 
				}
				
				text_single { 
					visible = "[GUIBuildingItem.HasLevel]" 
					raw_text = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetLevel]." 
				}
				
				text_single { 
					raw_text = "Button disabled." 
					visible = "[Not(GUIBuildingItem.IsBuildingButtonEnabled)]" 
				}
				
				block "normal" {
					text_single = {
						raw_text = "Build new, Enter."
						visible = "[And(And(GUIBuildingItem.IsBuildNewIconShown, GUIBuildingItem.IsBuildingButtonEnabled), Not(GUIBuildingItem.HasLevel))]"
						button = { 
							onclick = "[GUIBuildingItem.OnClick]" 
							shortcut = confirm 
						}
					}
				}
				
				block "special" {
					text_single = {
						raw_text = "Build new."
						visible = "[And(And(GUIBuildingItem.IsBuildNewIconShown, GUIBuildingItem.IsBuildingButtonEnabled), Not(GUIBuildingItem.HasLevel))]"
					}
				}
				
				text_single { 
					raw_text = "Construction: [GUIBuildingItem.GetConstructingProgress|0]%." 
					tooltip = "[GUIBuildingItem.GetTooltip]" 
					visible = "[GUIBuildingItem.IsConstructing]" 
				}
				
				text_single { 
					raw_text = "Building disabled." 
					visible = "[GUIBuildingItem.IsBuildingDisabled]" 
				}
				
				text_single { 
					visible = "[GUIBuildingItem.HasLevel]" 
					raw_text = "Tooltip." 
					tooltip = "[GUIBuildingItem.GetTooltip]" 
				}
				
				expand = { }
			}
			expand = { }
		}
	}
	
	type button_sea_ocr = button_text {
		blockoverride "text" {
			raw_text = "[Scope.GetProvince.GetName],"
		}
		blockoverride "extra" {
			block "sea_info_pre" {}
			block "direction" {
				text_single = {
					visible = "[Not(ObjectsEqual(Province.Self, Scope.GetProvince))]"
					raw_text = "[DistanceTo(Province, Scope.GetProvince)|0] [DaysTo(Province, Scope.GetProvince)] [Direction(Province, Scope.GetProvince)][AddTextIf(IsIndexFirst, ' from here')],"
				}
				text_single = {
					visible = "[ObjectsEqual(Province.Self, Scope.GetProvince)]"
					raw_text = "here"
				}
			}
			block "sea_info" {}
		}
		block "click" {
			onclick = "[Scope.GetProvince.PanCameraTo]"
			onclick = "[GetVariableSystem.Clear(AddTextIf(Not(ShowAddFlag('sgui_flag', 'close_adjacencies')), 'county_tabs'))]"
			onclick = "[HoldingView.Close]"
			onclick = "[Set('extra_window', 'window_sea')]"
			onclick = "[ClickAdd('window_sea', GetPlayer, Scope.GetProvince)]"
			onclick = "[GetScriptedGui('province_adjacencies').Execute( GuiScope.SetRoot( Scope.GetProvince.MakeScope ).AddScope( 'player', GetPlayer.MakeScope).End )]"
			onclick = "[GetScriptedGui('find_closest').Execute( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target', Scope.GetProvince.MakeScope).End )]"
			onrightclick = "[Scope.GetProvince.PanCameraTo]"
		}
	}
	
	type button_sea_far_ocr = button_sea_ocr {
		blockoverride "direction" {
			text_single = {
				visible = "[Not(ObjectsEqual(Province.Self, Scope.GetProvince))]"
				raw_text = "[DistanceTo(Province, Scope.GetProvince)|0] [DaysTo(Province, Scope.GetProvince)] [Direction(Province, Scope.GetProvince)] [AddTextIf(IsIndexFirst, 'from here')]"
			}
			text_single = {
				visible = "[ObjectsEqual(Province.Self, Scope.GetProvince)]"
				raw_text = "here"
			}
		}
		blockoverride "dot" { }
	}
	
	type adjacent_county_button_ocr = button_text {
		block "datacontext" {
			datacontext = "[Scope.Title]"
		}
		blockoverride "extra" {
			spacing = 3
			
			text_single = {
				raw_text = "Hostile,"
				visible = "[GetScriptedGui('is_hostile_county').IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope( 'target', Title.GetProvince.MakeScope ).End )]"
			}
			
			text_single = {
				visible = "[GreaterThan_CFixedPoint( GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Title.GetProvince.MakeScope).ScriptValue('enemies_in_the_county'), '(CFixedPoint)0' )]"
				raw_text = "[GuiScope.SetRoot(GetPlayer.MakeScope).AddScope('province', Title.GetProvince.MakeScope).ScriptValue('enemies_in_the_county')] enemies,"
			}
			
			text_single = {
				raw_text = "[Title.GetBaseNameNoTierNoTooltip], "
			}
			
			block "distance" {}
			
			container = {
				ignoreinvisible = yes
				block "county_distance" {
					visible = no
				}
				text_single = {
					datacontext = "[HoldingView.GetProvince]"
					visible = "[Not(ObjectsEqual(HoldingView.GetCountyTitle, Scope.Title))]"
					raw_text = "[DistanceTo(Province, Scope.Title.GetProvince)|0] [DaysTo(Province, Scope.Title.GetProvince)]"
				}
			}
			
			text_single = {
				block "prov_context" {
					datacontext = "[HoldingView.GetProvince]"
				}
				raw_text = "[GuiScope.SetRoot(Province.MakeScope).AddScope('second', Title.GetProvince.MakeScope).Custom('province_direction')],"
			}
			
			text_single = {
				visible = "[Title.GetProvince.HasActiveSiege]"
				raw_text = "Sieged,"
			}
			
			text_single = {
				raw_text = "your county,"
				visible = "[ObjectsEqual(Title.GetHolder, GetPlayer)]"
			}
			
			text_single = {
				visible = "[And(ObjectsEqual(Title.GetHolder.GetTopLiege, GetPlayer), Not(ObjectsEqual(Title.GetHolder, GetPlayer)))]"
				raw_text = "in your realm,"
			}
			
			flowcontainer = {
				ignoreinvisible = yes
				using = not_wasteland_locr
				datacontext = "[Title.GetHolder]"
				spacing = 3
				
				flowcontainer = {
					ignoreinvisible = yes
					visible = "[Not(Or(ObjectsEqual(Title.GetHolder.GetTopLiege, GetPlayer), ObjectsEqual(Title.GetHolder, GetPlayer)))]"
					spacing = 3
					
					text_single = {
						raw_text = "in"
					}
					
					text_single = {
						raw_text = "[Title.GetHolder.GetTopLiege.GetPrimaryTitle.GetNameNoTierNoTooltip],"
					}
				}
				
				text_single = {
					block "holder" {
						visible = "[Not(ObjectsEqual(Title.GetHolder, GetPlayer))]"
					}
					raw_text = "held by [Title.GetHolder.GetFirstNameNoTooltip] of [Title.GetHolder.GetPrimaryTitle.GetNameNoTierNoTooltip]."
				}
				
				text_single = {
					visible = "[Is('culture_counties')]"
					raw_text = "[Title.GetCountyData.GetFaith.GetAdjective], [Title.GetCountyData.GetCulture.GetName]."
				}
			}
			
			text_wasteland_locr = {}
			
			block "county_extra" { }
		}
		block "click" {
			onclick = "[OpenGameViewData('holding_view', Scope.Title.GetProvince.Self)]"
			onclick = "[DefaultOnCoatOfArmsRightClick(Title.GetID)]"
			onclick = "[GetVariableSystem.ClearIf('county_tabs', Not(ShowAddFlag('sgui_flag', 'close_adjacencies')))]"
			onclick = "[PdxGuiTriggerAllAnimations('adjacent_counties')]"
			onrightclick = "[DefaultOnCoatOfArmsRightClick(Title.GetID)]"
		}
	}
	
	type county_task_button_ocr = button_text {
		layoutpolicy_horizontal = expanding
		datacontext = "[HoldingView.GetCountyTitle]"
		visible = "[ScriptedGui.IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
		
		blockoverride "disabled" {
			visible = "[Not(ScriptedGui.IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End ))]"
		}
		
		enabled = "[ScriptedGui.IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
		tooltip = "[ScriptedGui.BuildTooltip( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
		tooltip_visible = "[Not(ScriptedGui.IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End ))]"
		onclick = "[ScriptedGui.Execute( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
	}
	
	type court_task_button_ocr = button_text {
		layoutpolicy_horizontal = expanding
		visible = "[ScriptedGui.IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
		
		blockoverride "disabled" {
			visible = "[Not(ScriptedGui.IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End ))]"
		}
		
		enabled = "[ScriptedGui.IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
		tooltip = "[ScriptedGui.BuildTooltip( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
		tooltip_visible = "[Not(ScriptedGui.IsValid( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End ))]"
		onclick = "[ScriptedGui.Execute( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
	}
	
	type active_task_hbox_ocr = hbox {
		layoutpolicy_horizontal = expanding
		datacontext = "[HoldingView.GetCountyTitle]"
		datacontext = "[Character.GetActiveCouncilTask]"
		visible = "[ScriptedGui.IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
		spacing = 3
		
		tooltipwidget = {
			council_task_progress_breakdown_widget = { }
		}
		
		text_single = {
			block "task" {
				raw_text = "Converting [Title.GetCountyData.GetFaith.GetAdjective] faith."
			}
		}
		
		text_single = {
			raw_text = "[ActiveCouncilTask.GetETA],"
		}
		
		text_single = {
			raw_text = "[ActiveCouncilTask.GetProgress|0]%."
			visible = "[ActiveCouncilTask.GetTaskType.IsPercentageTask]"
		}
		
		text_single = {
			raw_text = "[Character.GetFirstNameNoTooltip],"
		}
		
		text_single = {
			block "skill" {
				raw_text = "[Character.GetSkill('learning')] learning."
			}
		}
		
		expand = { }
	}
	
	type active_court_task_hbox_ocr = hbox {
		layoutpolicy_horizontal = expanding
		datacontext = "[HoldingView.GetCountyTitle]"
		datacontext = "[Character.GetActiveCouncilTask]"
		visible = "[ScriptedGui.IsShown( GuiScope.SetRoot( GetPlayer.MakeScope ).AddScope('county', Title.MakeScope ).AddScope('target_character', HoldingView.GetCountyTitle.GetHolder.MakeScope).AddScope('councillor', Character.MakeScope).AddScope('councillor_liege', GetPlayer.MakeScope).End )]"
		spacing = 3
		
		tooltipwidget = {
			council_task_progress_breakdown_widget = { }
		}
		
		text_single = {
			block "task" {
				raw_text = "Finding secrets in [HoldingView.GetCountyTitle.GetHolder.GetFirstNamePossessiveOrMyNoTooltip] court."
			}
		}
		
		text_single = {
			raw_text = "[ActiveCouncilTask.GetETA],"
		}
		
		text_single = {
			raw_text = "[ActiveCouncilTask.GetProgress|0]%."
		}
		
		text_single = {
			raw_text = "[Character.GetFirstNameNoTooltip],"
		}
		
		text_single = {
			block "skill" {
				raw_text = "[Character.GetSkill('intrigue')] intrigue."
			}
		}
		
		expand = { }
	}
	
	type button_holding_ocr = button_text {
		datacontext = "[Scope.GetProvince.GetHolding]"
		onclick = "[Scope.GetProvince.PanCameraTo]"
		onclick = "[GetVariableSystem.Clear('county_tabs')]"
		onclick = "[GetVariableSystem.Clear('extra_window')]"
		onclick = "[OpenGameViewData('holding_view', Scope.GetProvince)]"
		onrightclick = "[Scope.GetProvince.PanCameraTo]"
		
		blockoverride "text" {
			raw_text = "[Select_CString(Holding.IsEmpty, Scope.GetProvince.GetTerrain.GetNameNoTooltip, Holding.GetPrimaryBuildingType.GetTypeName)] of [Holding.GetNameNoTooltip],"
		}
		
		blockoverride "extra" {
			block "direction" {
				text_single = {
					raw_text = "[GuiScope.SetRoot(Province.MakeScope).AddScope('second', Scope.GetProvince.MakeScope).Custom('province_direction')],"
				}
			}
			
			block "distance" {
				text_single = {
					datacontext = "[Scope.GetProvince]"
					visible = "[Not(ObjectsEqual(HoldingView.GetProvince, Province.Self))]"
					raw_text = "[DistanceTo(HoldingView.GetProvince, Province)|0] [DaysTo(HoldingView.GetProvince, Province)] [Direction(HoldingView.GetProvince, Province)]"
				}
			}
			
			text_single = {
				datacontext = "[Scope.GetProvince.GetCounty.GetTitle.GetHolder.GetTopLiege]"
				visible = "[Not(ObjectsEqual(Character.Self, GetPlayer))]"
				raw_text = "in [Character.GetPrimaryTitle.GetNameNoTierNoTooltip]."
			}
			
			block "held_by" {
				text_single = {
					datacontext = "[Scope.GetProvince.GetCounty.GetTitle]"
					visible = "[Not(ObjectsEqual(Title.GetHolder, GetPlayer))]"
					raw_text = "held by [Title.GetHolder.GetFirstNameNoTooltip]."
				}
			}
			
			text_single = {
				datacontext = "[Scope.GetProvince.GetCounty.GetTitle.GetHolder.GetTopLiege]"
				visible = "[ObjectsEqual(Character.Self, GetPlayer)]"
				raw_text = "in your realm."
			}
		}
	}
	
	type button_shores_ocr = button_text {
		visible = "[Or(DataModelHasItems( Province.MakeScope.GetList('adjacent_seas') ), DataModelHasItems( Province.MakeScope.GetList('adjacent_rivers') ))]"
		
		blockoverride "text" {
			margin_left = -3
			raw_text = "on shores of"
		}
		
		blockoverride "extra" {
			flowcontainer = {
				ignoreinvisible = yes
				visible = "[DataModelHasItems(Province.MakeScope.GetList('adjacent_seas'))]"
				spacing = 3
				
				flowcontainer = {
					datamodel = "[DataModelFirst(Province.MakeScope.GetList('adjacent_seas'), '(int32)1')]"
					visible = "[EqualTo_int32(GetDataModelSize(Province.MakeScope.GetList('adjacent_seas')), '(int32)1')]"
					
					item = {
						flowcontainer = {
							spacing = 3
							text_single = {
								raw_text = "[Scope.GetProvince.GetName]"
							}
						}
					}
				}
				
				text_single = {
					visible = "[GreaterThan_int32(GetDataModelSize(Province.MakeScope.GetList('adjacent_seas')), '(int32)1')]"
					raw_text = "[GetDataModelSize(Province.MakeScope.GetList('adjacent_seas'))] seas"
				}
				
				text_single = {
					block "and" {
						visible = "[Or(DataModelHasItems(Province.MakeScope.GetList('adjacent_counties')), DataModelHasItems(Province.MakeScope.GetList('adjacent_rivers')))]"
					}
					raw_text = "and"
				}
			}
			
			flowcontainer = {
				ignoreinvisible = yes
				visible = "[DataModelHasItems(Province.MakeScope.GetList('adjacent_rivers'))]"
				spacing = 3
				
				flowcontainer = {
					datamodel = "[DataModelFirst(Province.MakeScope.GetList('adjacent_rivers'), '(int32)1')]"
					visible = "[EqualTo_int32(GetDataModelSize(Province.MakeScope.GetList('adjacent_rivers')), '(int32)1')]"
					
					item = {
						flowcontainer = {
							spacing = 3
							text_single = {
								raw_text = "[Scope.GetProvince.GetName]"
							}
						}
					}
				}
				
				text_single = {
					visible = "[EqualTo_int32(GetDataModelSize(Province.MakeScope.GetList('adjacent_rivers')), '(int32)1')]"
					raw_text = "river"
				}
				
				text_single = {
					visible = "[GreaterThan_int32(GetDataModelSize(Province.MakeScope.GetList('adjacent_rivers')), '(int32)1')]"
					raw_text = "[GetDataModelSize(Province.MakeScope.GetList('adjacent_rivers'))] rivers"
				}
			}
			
			dot_l = { }
		}
	}
	
	type building_in_vassal_warning_hbox_ocr = hbox {
		name = "vassal_warning"
		visible = "[Not( ObjectsEqual( HoldingView.GetHolder, GetPlayer ) )]"
		layoutpolicy_horizontal = expanding
		margin = { 5 0 }
		
		text_single = {
			text = "HOLDING_VIEW_BUILDING_IN_VASSAL"
			layoutpolicy_horizontal = expanding
		}
	}
	
	##############################################
	# TYPES VANILLA (per modalità grafica)
	##############################################
	
	type widget_building_item_vanilla = widget {
		size = { 55 55 }
		enabled = "[GUIBuildingItem.IsBuildingButtonEnabled]"
		tooltip = "[GUIBuildingItem.GetTooltip]"
		using = tooltip_ne
		
		button_standard = {
			name = "building_button"
			size = { 100% 100% }
			onclick = "[GUIBuildingItem.OnClick]"
			down = "[GUIBuildingItem.IsHighlighted]"
			
			button_icon = {
				name = "build_new_icon"
				visible = "[And(And(GUIBuildingItem.IsBuildNewIconShown, GUIBuildingItem.IsBuildingButtonEnabled), Not(GUIBuildingItem.HasLevel))]"
				parentanchor = center
				size = { 28 28 }
				alpha = 0.7
				texture = "gfx/interface/icons/flat_icons/plus.dds"
				alwaystransparent = yes
			}
			
			icon_building = {
				name = "building_icon"
				visible = "[Not( GUIBuildingItem.CanUpgrade )]"
				parentanchor = center
				size = { 45 40 }
				texture = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetTypeIcon]"
			}
			
			highlight_icon_building = {
				name = "building_icon_can_upgrade"
				visible = "[GUIBuildingItem.CanUpgrade]"
				parentanchor = center
				size = { 45 40 }
				texture = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetTypeIcon]"
			}
			
			text_single = {
				visible = "[And( GUIBuildingItem.HasLevel, Not( GUIBuildingItem.IsConstructing ) ) ]"
				text = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetLevel]"
				parentanchor = bottom|right
				position = { -6 -2 }
				fontsize = 15
				default_format = "#low;bold"
				align = nobaseline
				
				background = { 
					using = Background_Area_ExtraDark 
					margin = { 5 0 } 
				}
			}
			
			warning_icon = {
				name = "reduced_by_fixable_situation"
				visible = "[GUIBuildingItem.IsBuildingDisabled]"
				position = { 3 3 }
				size = { 20 20 }
			}
		}
		
		icon = {
			name = "building_slot"
			size = { 100% 100% }
			using = Background_Area
			visible = "[GUIBuildingItem.IsBuildingSlotShown]"
		}
		
		flowcontainer = {
			visible = "[And( GUIBuildingItem.HasLevel, GUIBuildingItem.IsConstructing ) ]"
			parentanchor = bottom|hcenter
			position = { 0 -3 }
			direction = vertical
			ignoreinvisible = yes
			
			widget = {
				size = { 15 15 }
				parentanchor = right
				
				text_single = {
					visible = "[GUIBuildingItem.HasLevel]"
					parentanchor = center
					position = { -1 0 }
					text = "[GUIBuildingItem.GetCurrentOrConstrucingBuilding.GetLevel]"
					fontsize = 15
					default_format = "#low;bold"
					align = nobaseline
					
					background = { 
						using = Background_Area_ExtraDark 
						margin = { 5 0 } 
					}
				}
			}
			
			progressbar_standard = {
				name = "construct_progressbar"
				visible = "[GUIBuildingItem.IsConstructing]"
				parentanchor = hcenter
				alwaystransparent = yes
				size = { 51 10 }
				value = "[GUIBuildingItem.GetConstructingProgress]"
				direction = horizontal
			}
		}
	}
	
	type building_in_vassal_warning_hbox_vanilla = hbox {
		name = "vassal_warning"
		visible = "[Not( ObjectsEqual( HoldingView.GetHolder, GetPlayer ) )]"
		
		coa_title_tiny = { 
			datacontext = "[HoldingView.GetHolder.GetPrimaryTitle]" 
		}
		
		text_multi = { 
			autoresize = yes 
			text = "HOLDING_VIEW_BUILDING_IN_VASSAL" 
		}
	}
	
	type county_development_tooltip_container_vanilla = container {
		using = GeneralTooltipSetup
		alwaystransparent = no
		
		objecttooltippopout = {
			blockoverride "title_text" {
				margin = { 0 8 }
				text = "COUNTY_DEVELOPMENT_TOOLTIP_HEADER"
				default_format = "#T"
			}
			
			blockoverride "concept_link" {
				visible = no
			}
			
			blockoverride "main_description" {
				vbox = {
					layoutpolicy_horizontal = expanding
					datacontext = "[County.GetCount]"
					datacontext = "[Character.GetGovernment]"
					
					cooltip_paragraph = {
						visible = "[Not( GovernmentType.IsAffectedByDevelopment )]"
						text = "COUNTY_DEVELOPMENT_IGNORED_DESC"
					}
					
					cooltip_paragraph = {
						text = "[County.GetCountyDevelopmentEffectsDesc]"
					}
					
					spacer = {
						size = { 0 15 }
					}
					
					cooltip_paragraph = {
						text = "[County.GetDevelopmentProgressOutOfMax]"
					}
					
					cooltip_paragraph = {
						datacontext = "[CountyDataBreakdowns.AccessDevelopmentChange( County.Self )]"
						text = "VALUE_BREAKDOWN_TEXT_LINK"
						tooltipvisible = "[ValueBreakdown.HasTooltip]"
						tooltipwidget = {
							widget_value_breakdown_tooltip = {}
						}
					}
				}
			}
		}
	}
	
	type county_fertility_tooltip_container_vanilla = container {
		using = GeneralTooltipSetup
		alwaystransparent = no
		
		objecttooltippopout = {
			blockoverride "title_text" {
				margin = { 0 8 }
				text = "COUNTY_FERTILITY_TOOLTIP_HEADER"
				default_format = "#T"
			}
			
			blockoverride "concept_link" {
				visible = no
			}
			
			blockoverride "main_description" {
				vbox = {
					layoutpolicy_horizontal = expanding
					
					cooltip_paragraph = {
						text = "COUNTY_FERTILITY_DESC"
					}
					
					spacer = {
						size = { 0 15 }
					}
					
					cooltip_paragraph = {
						datacontext = "[CountyDataBreakdowns.AccessFertility( County.Self )]"
						text = "VALUE_BREAKDOWN_TEXT_LINK"
						tooltipvisible = "[ValueBreakdown.HasTooltip]"
						tooltipwidget = {
							widget_value_breakdown_tooltip = {}
						}
					}
				}
			}
		}
	}
	
	type county_control_tooltip_container_vanilla = container {
		using = GeneralTooltipSetup
		alwaystransparent = no
		
		objecttooltippopout = {
			blockoverride "title_text" {
				margin = { 0 8 }
				text = "COUNTY_CONTROL_TOOLTIP_HEADER"
				default_format = "#T"
			}
			
			blockoverride "concept_link" {
				visible = no
			}
			
			blockoverride "main_description" {
				vbox = {
					layoutpolicy_horizontal = expanding
					
					cooltip_paragraph = {
						text = "COUNTY_CONTROL_DESC"
					}
					
					spacer = {
						size = { 0 15 }
					}
					
					cooltip_paragraph = {
						datacontext = "[CountyDataBreakdowns.AccessControl( County.Self )]"
						text = "VALUE_BREAKDOWN_TEXT_LINK"
						tooltipvisible = "[ValueBreakdown.HasTooltip]"
						tooltipwidget = {
							widget_value_breakdown_tooltip = {}
						}
					}
				}
			}
		}
	}
}